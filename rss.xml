<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Abhik's Blog]]></title><description><![CDATA[A place to pen down and share what I learn]]></description><link>https://abhikmitra.github.io/blog</link><generator>GatsbyJS</generator><lastBuildDate>Mon, 25 May 2020 19:30:51 GMT</lastBuildDate><item><title><![CDATA[Azure Event Hub SDK Internals - Part 3 (Pumping Data & AMQP Link)]]></title><description><![CDATA[Azure Event Hub SDK Series This post is part 3 of a series of posts on Azure Event Hub SDK for Dot NET. Azure Event Hub SDK Internals - Part…]]></description><link>https://abhikmitra.github.io/blog/event-hub-3/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/event-hub-3/</guid><pubDate>Mon, 25 May 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Azure Event Hub SDK Series&lt;/h2&gt;
&lt;p&gt;This post is &lt;strong&gt;part 3&lt;/strong&gt; of a series of posts on Azure Event Hub SDK for Dot NET.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/event-hub/&quot;&gt;Azure Event Hub SDK Internals - Part 1 (Overview &amp;#x26; Control Flow)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/event-hub-2/&quot;&gt;Azure Event Hub SDK Internals - Part 2 (Partition Manager &amp;#x26; Lease Management)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/event-hub-3/&quot;&gt;Azure Event Hub SDK Internals - Part 3 (Pumping Data &amp;#x26; AMQP Links)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Do you think there is more that I should cover or something I should fix ? Please raise an &lt;a href=&quot;https://github.com/abhikmitra/blog/issues&quot;&gt;issue&lt;/a&gt; and let me know.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;In this section we will deep dive into the &lt;a href=&quot;https://github.com/Azure/azure-sdk-for-net/blob/6a73a945124f1e268a86d62a0e2ea5b4bd31c496/sdk/eventhub/Microsoft.Azure.EventHubs.Processor/src/EventHubPartitionPump.cs&quot;&gt;Event Hub Partition Pump&lt;/a&gt; in the Event Hub SDK. This is the part that deals with getting the actual data from the Event Hub.&lt;/p&gt;
&lt;h2&gt;Control Flow&lt;/h2&gt;
&lt;p&gt;The control flow starts in the partition Manager. Once the SDK has the proper leases to the partitions, it starts creating or updating the Partition Pumps.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;For every partition that is leased by the current host&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It checks and create pumps if necessary.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;For every partition that is &lt;strong&gt;not&lt;/strong&gt; leased by the current host&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We remove the pumps.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Creating Pumps&lt;/h2&gt;
&lt;p&gt;The partition manager keeps a map of partition id to pumps. . Every turn of the loop, the Partition manager renews/gets new leases and checks if the new pump needs to be created based on the &lt;code class=&quot;language-text&quot;&gt;partitionId-Pump&lt;/code&gt; map. So every PartitionId can have at most 1 pump.&lt;/p&gt;
&lt;h3&gt;Opening the Pump&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Each partition will have its Partition Pump&lt;/li&gt;
&lt;li&gt;After a pump is created its &lt;code class=&quot;language-text&quot;&gt;opened&lt;/code&gt; asynchronously&lt;/li&gt;
&lt;li&gt;It is in this step that an instance of the &lt;code class=&quot;language-text&quot;&gt;SimpleEventProcessor&lt;/code&gt; is created. Its a singleton, so only the first pump creates the instance, all pumps share the same instance.&lt;/li&gt;
&lt;li&gt;Then the pump calls into &lt;code class=&quot;language-text&quot;&gt;OpenAsync&lt;/code&gt; of &lt;code class=&quot;language-text&quot;&gt;SimpleEventProcessor&lt;/code&gt; and awaits it.&lt;/li&gt;
&lt;li&gt;Once &lt;code class=&quot;language-text&quot;&gt;SimpleEventProcessor&lt;/code&gt; returns we get the checkpoint information from the Lease Blob. The checkpoint is a combination of the Offset and Sequence Number.&lt;/li&gt;
&lt;li&gt;If there is no checkpoint information for that partition, we set the initial offset to -1&lt;/li&gt;
&lt;li&gt;Then we create the Partition Receiver which completes the opening of the pump. We set the pump status to Running.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Running the Pump&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Once the pump is marked as running, the code calls into  &lt;code class=&quot;language-text&quot;&gt;AmqpPartitionReceiver&lt;/code&gt; and sets the receiver which is just a callback into the Pump.&lt;/li&gt;
&lt;li&gt;This triggers the &lt;code class=&quot;language-text&quot;&gt;PartitionReceiver&lt;/code&gt; which starts polling the event hub asynchronously.&lt;/li&gt;
&lt;li&gt;The Partition receiver stops listening when the pump sets the ReceiveHandler to null.&lt;/li&gt;
&lt;li&gt;The receiver bit of the code can be seen &lt;a href=&quot;https://github.com/Azure/azure-sdk-for-net/blob/3db8feaa87d7e44eb91baf7812edb70fbc8042ad/sdk/eventhub/Microsoft.Azure.EventHubs/src/Amqp/AmqpPartitionReceiver.cs#L276&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;The Partition Receiver runs a while loop till the point it has an active ReceiveHandler.&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;The partition receiver creates a &lt;code class=&quot;language-text&quot;&gt;ReceivingAmqpLink&lt;/code&gt; that reads the offset from the blob store and creates filters that look like queries - &lt;code class=&quot;language-text&quot;&gt;amqp.annotation.x-opt-offset &amp;gt; 14832&lt;/code&gt;. This is a singleton the AMQP layer will create this once and keep the link alive.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;The receiver uses the link to wait for messages for a maximum of 30 seconds after which it restarts the loop and does the health checks on the pump.&lt;/li&gt;
&lt;li&gt;The link to the event hub does not get destroyed and is always on.&lt;/li&gt;
&lt;li&gt;In each iteration it gets data from the event hub, transforms it into &lt;code class=&quot;language-text&quot;&gt;EventData&lt;/code&gt;, and invokes &lt;code class=&quot;language-text&quot;&gt;ProcessEventsAsync&lt;/code&gt; of the simpleEventProcessor.&lt;/li&gt;
&lt;li&gt;The Pump stores the Sequence number, enqueued time, and retrieval time. The epoch is also set&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The overall flow looks like this.&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1590435048978&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1050px;&quot; viewBox=&quot;-50 -10 1050 441&quot;&gt;&lt;style&gt;#mermaid-1590435048978 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590435048978 .label text{fill:#333}#mermaid-1590435048978 .node rect,#mermaid-1590435048978 .node circle,#mermaid-1590435048978 .node ellipse,#mermaid-1590435048978 .node polygon,#mermaid-1590435048978 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590435048978 .node .label{text-align:center}#mermaid-1590435048978 .node.clickable{cursor:pointer}#mermaid-1590435048978 .arrowheadPath{fill:#333}#mermaid-1590435048978 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590435048978 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590435048978 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590435048978 .cluster text{fill:#333}#mermaid-1590435048978 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590435048978 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590435048978 text.actor{fill:#000;stroke:none}#mermaid-1590435048978 .actor-line{stroke:grey}#mermaid-1590435048978 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435048978 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435048978 #arrowhead{fill:#333}#mermaid-1590435048978 .sequenceNumber{fill:#fff}#mermaid-1590435048978 #sequencenumber{fill:#333}#mermaid-1590435048978 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590435048978 .messageText{fill:#333;stroke:none}#mermaid-1590435048978 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590435048978 .labelText{fill:#000;stroke:none}#mermaid-1590435048978 .loopText{fill:#000;stroke:none}#mermaid-1590435048978 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1590435048978 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435048978 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590435048978 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590435048978 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590435048978 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590435048978 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 .section{stroke:none;opacity:0.2}#mermaid-1590435048978 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590435048978 .section2{fill:#fff400}#mermaid-1590435048978 .section1,#mermaid-1590435048978 .section3{fill:#fff;opacity:0.2}#mermaid-1590435048978 .sectionTitle0{fill:#333}#mermaid-1590435048978 .sectionTitle1{fill:#333}#mermaid-1590435048978 .sectionTitle2{fill:#333}#mermaid-1590435048978 .sectionTitle3{fill:#333}#mermaid-1590435048978 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590435048978 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 .grid path{stroke-width:0}#mermaid-1590435048978 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590435048978 .task{stroke-width:2}#mermaid-1590435048978 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 .taskText:not([font-size]){font-size:11px}#mermaid-1590435048978 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590435048978 .task.clickable{cursor:pointer}#mermaid-1590435048978 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435048978 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435048978 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435048978 .taskText0,#mermaid-1590435048978 .taskText1,#mermaid-1590435048978 .taskText2,#mermaid-1590435048978 .taskText3{fill:#fff}#mermaid-1590435048978 .task0,#mermaid-1590435048978 .task1,#mermaid-1590435048978 .task2,#mermaid-1590435048978 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590435048978 .taskTextOutside0,#mermaid-1590435048978 .taskTextOutside2{fill:#000}#mermaid-1590435048978 .taskTextOutside1,#mermaid-1590435048978 .taskTextOutside3{fill:#000}#mermaid-1590435048978 .active0,#mermaid-1590435048978 .active1,#mermaid-1590435048978 .active2,#mermaid-1590435048978 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590435048978 .activeText0,#mermaid-1590435048978 .activeText1,#mermaid-1590435048978 .activeText2,#mermaid-1590435048978 .activeText3{fill:#000 !important}#mermaid-1590435048978 .done0,#mermaid-1590435048978 .done1,#mermaid-1590435048978 .done2,#mermaid-1590435048978 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590435048978 .doneText0,#mermaid-1590435048978 .doneText1,#mermaid-1590435048978 .doneText2,#mermaid-1590435048978 .doneText3{fill:#000 !important}#mermaid-1590435048978 .crit0,#mermaid-1590435048978 .crit1,#mermaid-1590435048978 .crit2,#mermaid-1590435048978 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590435048978 .activeCrit0,#mermaid-1590435048978 .activeCrit1,#mermaid-1590435048978 .activeCrit2,#mermaid-1590435048978 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590435048978 .doneCrit0,#mermaid-1590435048978 .doneCrit1,#mermaid-1590435048978 .doneCrit2,#mermaid-1590435048978 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590435048978 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590435048978 .milestoneText{font-style:italic}#mermaid-1590435048978 .doneCritText0,#mermaid-1590435048978 .doneCritText1,#mermaid-1590435048978 .doneCritText2,#mermaid-1590435048978 .doneCritText3{fill:#000 !important}#mermaid-1590435048978 .activeCritText0,#mermaid-1590435048978 .activeCritText1,#mermaid-1590435048978 .activeCritText2,#mermaid-1590435048978 .activeCritText3{fill:#000 !important}#mermaid-1590435048978 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590435048978 g.classGroup text .title{font-weight:bolder}#mermaid-1590435048978 g.clickable{cursor:pointer}#mermaid-1590435048978 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435048978 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435048978 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435048978 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590435048978 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435048978 .dashed-line{stroke-dasharray:3}#mermaid-1590435048978 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048978 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048978 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435048978 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435048978 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048978 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048978 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048978 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048978 .commit-id,#mermaid-1590435048978 .commit-msg,#mermaid-1590435048978 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048978 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590435048978 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590435048978 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435048978 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435048978 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435048978 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590435048978 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590435048978 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435048978 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590435048978 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435048978 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1590435048978 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Partition Manager&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Pump&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;SimpleEventProcessor&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;PartitionReceiver&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;AMQPLink&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Craetes 1 pump per partition&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OpenAsync&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;475&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Creates a Partition Receiver&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;170&quot; x2=&quot;675&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;475&quot; y=&quot;198&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;SetReceiveHandler&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;205&quot; x2=&quot;675&quot; y2=&quot;205&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;258&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Get Or Create&lt;/text&gt;&lt;line x1=&quot;675&quot; y1=&quot;265&quot; x2=&quot;875&quot; y2=&quot;265&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;293&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Receive maximum of 10 messages&lt;/text&gt;&lt;line x1=&quot;675&quot; y1=&quot;300&quot; x2=&quot;875&quot; y2=&quot;300&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;328&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ProcessEventsAsync&lt;/text&gt;&lt;line x1=&quot;675&quot; y1=&quot;335&quot; x2=&quot;475&quot; y2=&quot;335&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;465&quot; y1=&quot;215&quot; x2=&quot;885&quot; y2=&quot;215&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;885&quot; y1=&quot;215&quot; x2=&quot;885&quot; y2=&quot;345&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;465&quot; y1=&quot;345&quot; x2=&quot;885&quot; y2=&quot;345&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;465&quot; y1=&quot;215&quot; x2=&quot;465&quot; y2=&quot;345&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;465,215 515,215 515,228 506.6,235 465,235&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;472.5&quot; y=&quot;230&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;472.5&quot;&gt;loop&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;675&quot; y=&quot;230&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;675&quot;&gt;[ Every 30 seconds, ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Partition Manager&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Pump&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;SimpleEventProcessor&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;PartitionReceiver&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;AMQPLink&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;Though it looks like a poll, in essence what the code is polling is the Link which is persistent across all iterations. The code awaits and asks for the messages from the event hub. Once it gets a batch of messages, it quickly &lt;strong&gt;processes&lt;/strong&gt; it by sending it to the &lt;code class=&quot;language-text&quot;&gt;SimpleEventProcessor&lt;/code&gt; and gain comes back to process more. If there are no messages, it simply waits for a minute and continues with the next iteration.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Azure Event Hub SDK Internals - Part 2 (Partition Manager & Lease Management)]]></title><description><![CDATA[Azure Event Hub SDK Series This post is part 2 of a series of posts on Azure Event Hub SDK for Dot NET. Azure Event Hub SDK Internals - Part…]]></description><link>https://abhikmitra.github.io/blog/event-hub-2/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/event-hub-2/</guid><pubDate>Sun, 24 May 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Azure Event Hub SDK Series&lt;/h2&gt;
&lt;p&gt;This post is &lt;strong&gt;part 2&lt;/strong&gt; of a series of posts on Azure Event Hub SDK for Dot NET.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/event-hub/&quot;&gt;Azure Event Hub SDK Internals - Part 1 (Overview &amp;#x26; Control Flow)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/event-hub-2/&quot;&gt;Azure Event Hub SDK Internals - Part 2 (Partition Manager &amp;#x26; Lease Management)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/event-hub-3/&quot;&gt;Azure Event Hub SDK Internals - Part 3 (Pumping Data &amp;#x26; AMQP Links)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Do you think there is more that I should cover or something I should fix ? Please raise an &lt;a href=&quot;https://github.com/abhikmitra/blog/issues&quot;&gt;issue&lt;/a&gt; and let me know.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;In this section we will deep dive into the &lt;a href=&quot;https://github.com/Azure/azure-sdk-for-net/blob/5e30a0ca3873d54a310924925e35043dd9f3b6a0/sdk/eventhub/Microsoft.Azure.EventHubs.Processor/src/PartitionManager.cs&quot;&gt;Partition Manager&lt;/a&gt; in the Event Hub SDK. This is the part that has some of the business logic of the receiver built-in. Partition Manager is responsible for initializing the stores and managing the leases of the partition.&lt;/p&gt;
&lt;h2&gt;Control Flow&lt;/h2&gt;
&lt;p&gt;The control flow in the Partition Manager can be divided into 2 distinct parts.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Initialization Flow - In this flow partition managers initializes all the stores and get everything ready for receiving messages. This flow ends when the control flow is returned to &lt;code class=&quot;language-text&quot;&gt;RegisterEventProcessorAsync&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;RunAsync Flow - As the name suggests, this is an asynchronous &amp;#x26; long-running operation that triggers the &lt;code class=&quot;language-text&quot;&gt;SimpleEventProcessor&lt;/code&gt; and make sure the processor keeps receiving the messages&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Initialization flow&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;It initializes the stores. The Partition Manager checks if the lease-store and the checkpoint store exists.&lt;/li&gt;
&lt;li&gt;If they are not present it creates the appropriate Container in the Azure Blob Storage.&lt;/li&gt;
&lt;li&gt;Once the containers are created, we get the partition info from the event hub.&lt;/li&gt;
&lt;li&gt;Then we create &lt;code class=&quot;language-text&quot;&gt;Leases&lt;/code&gt; in the store. These are just blobs that have all the information needed to receive events.&lt;/li&gt;
&lt;li&gt;For each partition there will be 1 Lease Blobs.&lt;/li&gt;
&lt;li&gt;It also initializes the Checkpoint store and checkpoints which internally is the same as leases.&lt;/li&gt;
&lt;li&gt;In the current implementation a Checkpoint blob and the lease blob are one and same. The same blob represents both checkpoints and leases ownership.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1590435048934&quot; width=&quot;429.09375&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;322&quot; viewBox=&quot;0 0 429.09375 322&quot;&gt;&lt;style&gt;#mermaid-1590435048934 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590435048934 .label text{fill:#333}#mermaid-1590435048934 .node rect,#mermaid-1590435048934 .node circle,#mermaid-1590435048934 .node ellipse,#mermaid-1590435048934 .node polygon,#mermaid-1590435048934 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590435048934 .node .label{text-align:center}#mermaid-1590435048934 .node.clickable{cursor:pointer}#mermaid-1590435048934 .arrowheadPath{fill:#333}#mermaid-1590435048934 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590435048934 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590435048934 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590435048934 .cluster text{fill:#333}#mermaid-1590435048934 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590435048934 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590435048934 text.actor{fill:#000;stroke:none}#mermaid-1590435048934 .actor-line{stroke:grey}#mermaid-1590435048934 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435048934 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435048934 #arrowhead{fill:#333}#mermaid-1590435048934 .sequenceNumber{fill:#fff}#mermaid-1590435048934 #sequencenumber{fill:#333}#mermaid-1590435048934 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590435048934 .messageText{fill:#333;stroke:none}#mermaid-1590435048934 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590435048934 .labelText{fill:#000;stroke:none}#mermaid-1590435048934 .loopText{fill:#000;stroke:none}#mermaid-1590435048934 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1590435048934 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435048934 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590435048934 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590435048934 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590435048934 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590435048934 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 .section{stroke:none;opacity:0.2}#mermaid-1590435048934 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590435048934 .section2{fill:#fff400}#mermaid-1590435048934 .section1,#mermaid-1590435048934 .section3{fill:#fff;opacity:0.2}#mermaid-1590435048934 .sectionTitle0{fill:#333}#mermaid-1590435048934 .sectionTitle1{fill:#333}#mermaid-1590435048934 .sectionTitle2{fill:#333}#mermaid-1590435048934 .sectionTitle3{fill:#333}#mermaid-1590435048934 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590435048934 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 .grid path{stroke-width:0}#mermaid-1590435048934 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590435048934 .task{stroke-width:2}#mermaid-1590435048934 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 .taskText:not([font-size]){font-size:11px}#mermaid-1590435048934 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590435048934 .task.clickable{cursor:pointer}#mermaid-1590435048934 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435048934 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435048934 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435048934 .taskText0,#mermaid-1590435048934 .taskText1,#mermaid-1590435048934 .taskText2,#mermaid-1590435048934 .taskText3{fill:#fff}#mermaid-1590435048934 .task0,#mermaid-1590435048934 .task1,#mermaid-1590435048934 .task2,#mermaid-1590435048934 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590435048934 .taskTextOutside0,#mermaid-1590435048934 .taskTextOutside2{fill:#000}#mermaid-1590435048934 .taskTextOutside1,#mermaid-1590435048934 .taskTextOutside3{fill:#000}#mermaid-1590435048934 .active0,#mermaid-1590435048934 .active1,#mermaid-1590435048934 .active2,#mermaid-1590435048934 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590435048934 .activeText0,#mermaid-1590435048934 .activeText1,#mermaid-1590435048934 .activeText2,#mermaid-1590435048934 .activeText3{fill:#000 !important}#mermaid-1590435048934 .done0,#mermaid-1590435048934 .done1,#mermaid-1590435048934 .done2,#mermaid-1590435048934 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590435048934 .doneText0,#mermaid-1590435048934 .doneText1,#mermaid-1590435048934 .doneText2,#mermaid-1590435048934 .doneText3{fill:#000 !important}#mermaid-1590435048934 .crit0,#mermaid-1590435048934 .crit1,#mermaid-1590435048934 .crit2,#mermaid-1590435048934 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590435048934 .activeCrit0,#mermaid-1590435048934 .activeCrit1,#mermaid-1590435048934 .activeCrit2,#mermaid-1590435048934 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590435048934 .doneCrit0,#mermaid-1590435048934 .doneCrit1,#mermaid-1590435048934 .doneCrit2,#mermaid-1590435048934 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590435048934 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590435048934 .milestoneText{font-style:italic}#mermaid-1590435048934 .doneCritText0,#mermaid-1590435048934 .doneCritText1,#mermaid-1590435048934 .doneCritText2,#mermaid-1590435048934 .doneCritText3{fill:#000 !important}#mermaid-1590435048934 .activeCritText0,#mermaid-1590435048934 .activeCritText1,#mermaid-1590435048934 .activeCritText2,#mermaid-1590435048934 .activeCritText3{fill:#000 !important}#mermaid-1590435048934 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590435048934 g.classGroup text .title{font-weight:bolder}#mermaid-1590435048934 g.clickable{cursor:pointer}#mermaid-1590435048934 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435048934 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435048934 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435048934 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590435048934 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435048934 .dashed-line{stroke-dasharray:3}#mermaid-1590435048934 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048934 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048934 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435048934 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435048934 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048934 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048934 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048934 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435048934 .commit-id,#mermaid-1590435048934 .commit-msg,#mermaid-1590435048934 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435048934 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590435048934 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590435048934 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435048934 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435048934 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435048934 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590435048934 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590435048934 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435048934 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590435048934 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435048934 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1590435048934 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g transform=&quot;translate(0, 0)&quot;&gt;&lt;g class=&quot;output&quot;&gt;&lt;g class=&quot;clusters&quot;&gt;&lt;/g&gt;&lt;g class=&quot;edgePaths&quot;&gt;&lt;g class=&quot;edgePath&quot; style=&quot;opacity: 1;&quot;&gt;&lt;path class=&quot;path&quot; d=&quot;M139.7890625,47L139.7890625,72L139.7890625,97&quot; marker-end=&quot;url(#arrowhead18)&quot; style=&quot;fill:none&quot;&gt;&lt;/path&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead18&quot; viewBox=&quot;0 0 10 10&quot; refX=&quot;9&quot; refY=&quot;5&quot; markerUnits=&quot;strokeWidth&quot; markerWidth=&quot;8&quot; markerHeight=&quot;6&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0 0 L 10 5 L 0 10 z&quot; class=&quot;arrowheadPath&quot; style=&quot;stroke-width: 1; stroke-dasharray: 1, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;/g&gt;&lt;g class=&quot;edgePath&quot; style=&quot;opacity: 1;&quot;&gt;&lt;path class=&quot;path&quot; d=&quot;M139.7890625,136L139.7890625,161L139.7890625,186&quot; marker-end=&quot;url(#arrowhead19)&quot; style=&quot;fill:none&quot;&gt;&lt;/path&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead19&quot; viewBox=&quot;0 0 10 10&quot; refX=&quot;9&quot; refY=&quot;5&quot; markerUnits=&quot;strokeWidth&quot; markerWidth=&quot;8&quot; markerHeight=&quot;6&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0 0 L 10 5 L 0 10 z&quot; class=&quot;arrowheadPath&quot; style=&quot;stroke-width: 1; stroke-dasharray: 1, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;/g&gt;&lt;g class=&quot;edgePath&quot; style=&quot;opacity: 1;&quot;&gt;&lt;path class=&quot;path&quot; d=&quot;M139.7890625,225L139.7890625,250L139.7890625,275&quot; marker-end=&quot;url(#arrowhead20)&quot; style=&quot;fill:none&quot;&gt;&lt;/path&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead20&quot; viewBox=&quot;0 0 10 10&quot; refX=&quot;9&quot; refY=&quot;5&quot; markerUnits=&quot;strokeWidth&quot; markerWidth=&quot;8&quot; markerHeight=&quot;6&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0 0 L 10 5 L 0 10 z&quot; class=&quot;arrowheadPath&quot; style=&quot;stroke-width: 1; stroke-dasharray: 1, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;/g&gt;&lt;g class=&quot;edgePath&quot; style=&quot;opacity: 1;&quot;&gt;&lt;path class=&quot;path&quot; d=&quot;M218.03125,284.81879471883934L297.3854166666667,275L317.2239583333333,275L337.0625,294.5L317.2239583333333,314L297.3854166666667,314L218.03125,304.18120528116066&quot; marker-end=&quot;url(#arrowhead21)&quot; style=&quot;fill:none&quot;&gt;&lt;/path&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead21&quot; viewBox=&quot;0 0 10 10&quot; refX=&quot;9&quot; refY=&quot;5&quot; markerUnits=&quot;strokeWidth&quot; markerWidth=&quot;8&quot; markerHeight=&quot;6&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0 0 L 10 5 L 0 10 z&quot; class=&quot;arrowheadPath&quot; style=&quot;stroke-width: 1; stroke-dasharray: 1, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class=&quot;edgeLabels&quot;&gt;&lt;g class=&quot;edgeLabel&quot; transform=&quot;&quot; style=&quot;opacity: 1;&quot;&gt;&lt;g transform=&quot;translate(0,0)&quot; class=&quot;label&quot;&gt;&lt;foreignObject width=&quot;0&quot; height=&quot;0&quot;&gt;&lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot; style=&quot;display: inline-block; white-space: nowrap;&quot;&gt;&lt;span class=&quot;edgeLabel&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/foreignObject&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class=&quot;edgeLabel&quot; transform=&quot;&quot; style=&quot;opacity: 1;&quot;&gt;&lt;g transform=&quot;translate(0,0)&quot; class=&quot;label&quot;&gt;&lt;foreignObject width=&quot;0&quot; height=&quot;0&quot;&gt;&lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot; style=&quot;display: inline-block; white-space: nowrap;&quot;&gt;&lt;span class=&quot;edgeLabel&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/foreignObject&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class=&quot;edgeLabel&quot; transform=&quot;&quot; style=&quot;opacity: 1;&quot;&gt;&lt;g transform=&quot;translate(0,0)&quot; class=&quot;label&quot;&gt;&lt;foreignObject width=&quot;0&quot; height=&quot;0&quot;&gt;&lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot; style=&quot;display: inline-block; white-space: nowrap;&quot;&gt;&lt;span class=&quot;edgeLabel&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/foreignObject&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class=&quot;edgeLabel&quot; transform=&quot;translate(337.0625,294.5)&quot; style=&quot;opacity: 1;&quot;&gt;&lt;g transform=&quot;translate(-84.03125,-9.5)&quot; class=&quot;label&quot;&gt;&lt;foreignObject width=&quot;168.0625&quot; height=&quot;19&quot;&gt;&lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot; style=&quot;display: inline-block; white-space: nowrap;&quot;&gt;&lt;span class=&quot;edgeLabel&quot;&gt;loop for every partition&lt;/span&gt;&lt;/div&gt;&lt;/foreignObject&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class=&quot;nodes&quot;&gt;&lt;g class=&quot;node default&quot; id=&quot;StartAsync&quot; transform=&quot;translate(139.7890625,27.5)&quot; style=&quot;opacity: 1;&quot;&gt;&lt;rect rx=&quot;0&quot; ry=&quot;0&quot; x=&quot;-47.7421875&quot; y=&quot;-19.5&quot; width=&quot;95.484375&quot; height=&quot;39&quot; class=&quot;label-container&quot;&gt;&lt;/rect&gt;&lt;g class=&quot;label&quot; transform=&quot;translate(0,0)&quot;&gt;&lt;g transform=&quot;translate(-37.7421875,-9.5)&quot;&gt;&lt;foreignObject width=&quot;75.484375&quot; height=&quot;19&quot;&gt;&lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot; style=&quot;display: inline-block; white-space: nowrap;&quot;&gt;StartAsync&lt;/div&gt;&lt;/foreignObject&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class=&quot;node default&quot; id=&quot;Initialize_Stores&quot; transform=&quot;translate(139.7890625,116.5)&quot; style=&quot;opacity: 1;&quot;&gt;&lt;rect rx=&quot;0&quot; ry=&quot;0&quot; x=&quot;-67.5546875&quot; y=&quot;-19.5&quot; width=&quot;135.109375&quot; height=&quot;39&quot; class=&quot;label-container&quot;&gt;&lt;/rect&gt;&lt;g class=&quot;label&quot; transform=&quot;translate(0,0)&quot;&gt;&lt;g transform=&quot;translate(-57.5546875,-9.5)&quot;&gt;&lt;foreignObject width=&quot;115.109375&quot; height=&quot;19&quot;&gt;&lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot; style=&quot;display: inline-block; white-space: nowrap;&quot;&gt;Initialize_Stores&lt;/div&gt;&lt;/foreignObject&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class=&quot;node default&quot; id=&quot;Get_PartitionIds_from_Event_Hub&quot; transform=&quot;translate(139.7890625,205.5)&quot; style=&quot;opacity: 1;&quot;&gt;&lt;rect rx=&quot;0&quot; ry=&quot;0&quot; x=&quot;-131.7890625&quot; y=&quot;-19.5&quot; width=&quot;263.578125&quot; height=&quot;39&quot; class=&quot;label-container&quot;&gt;&lt;/rect&gt;&lt;g class=&quot;label&quot; transform=&quot;translate(0,0)&quot;&gt;&lt;g transform=&quot;translate(-121.7890625,-9.5)&quot;&gt;&lt;foreignObject width=&quot;243.578125&quot; height=&quot;19&quot;&gt;&lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot; style=&quot;display: inline-block; white-space: nowrap;&quot;&gt;Get_PartitionIds_from_Event_Hub&lt;/div&gt;&lt;/foreignObject&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class=&quot;node default&quot; id=&quot;Create_Lease_Blob&quot; transform=&quot;translate(139.7890625,294.5)&quot; style=&quot;opacity: 1;&quot;&gt;&lt;rect rx=&quot;0&quot; ry=&quot;0&quot; x=&quot;-78.2421875&quot; y=&quot;-19.5&quot; width=&quot;156.484375&quot; height=&quot;39&quot; class=&quot;label-container&quot;&gt;&lt;/rect&gt;&lt;g class=&quot;label&quot; transform=&quot;translate(0,0)&quot;&gt;&lt;g transform=&quot;translate(-68.2421875,-9.5)&quot;&gt;&lt;foreignObject width=&quot;136.484375&quot; height=&quot;19&quot;&gt;&lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot; style=&quot;display: inline-block; white-space: nowrap;&quot;&gt;Create_Lease_Blob&lt;/div&gt;&lt;/foreignObject&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;h3&gt;RunAsync Flow&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;This flow keeps looping until cancellation is requested by calling UnregisterEventProcessorAsync.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Renew owned Lease&lt;/li&gt;
&lt;li&gt;Check and Grab Expired/New Leases&lt;/li&gt;
&lt;li&gt;Steal leases if it is not load-balanced.&lt;/li&gt;
&lt;li&gt;Create or update pumps based on Leases.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;In case there is an error or unregister has been called, it removes all the pumps.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Lease Management&lt;/h2&gt;
&lt;p&gt;This is the most interesting aspect of the SDK on how it manages the leases. To understand lease management, we  will divide it into 3 parts&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Check and Grab Expired/New Leases&lt;/li&gt;
&lt;li&gt;Renew owned Leases - Leases that are already owned by the current host&lt;/li&gt;
&lt;li&gt;Steal Leases&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To understand how leases work in Azure Blobs, it will be good to read this &lt;a href=&quot;https://www.red-gate.com/simple-talk/cloud/platform-as-a-service/azure-blob-storage-part-8-blob-leases/&quot;&gt;article&lt;/a&gt;. The leasing mechanism of event hub is built on Azure Blobs.
Some of the points to remember are&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The lease on a blob can be acquired when the lease is in any state other than &lt;code class=&quot;language-text&quot;&gt;Leased&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Once the Lease is acquired, the Azure blob SDK returns a token.&lt;/li&gt;
&lt;li&gt;This token is like a key, whoever possesses the token can operate on the blob.&lt;/li&gt;
&lt;li&gt;If one host gives their token to another host, the new host can call &lt;code class=&quot;language-text&quot;&gt;ChangeLeaseAsync&lt;/code&gt; to acquire a new lease for itself.&lt;/li&gt;
&lt;li&gt;The previous host loses the lease.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Grab expired leases&lt;/h3&gt;
&lt;p&gt;When we first start the Event hub Receiver and create the lease blobs. The leases have no owner. This part of the code is responsible for taking up expired as well as new leases.&lt;/p&gt;
&lt;p&gt;Get capacity of the host&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Before the Partition manager can start acquiring new leases it needs to check the ideal lease per host.&lt;/li&gt;
&lt;li&gt;It can figure out the active hosts by simply iterating over the lease blobs which are not expired.&lt;/li&gt;
&lt;li&gt;Then the ideal leaser host should be &lt;code class=&quot;language-text&quot;&gt;number_of_lease_blob/number_of_active_hosts&lt;/code&gt;. Let’s call this number &lt;code class=&quot;language-text&quot;&gt;leaserPerHost&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Based on the existing leases that it already has, the number of leases the partition manager can own is &lt;code class=&quot;language-text&quot;&gt;leaserPerHost-leasesWeAlreadyOwn&lt;/code&gt;, lets call this number &lt;code class=&quot;language-text&quot;&gt;targetLeaseCount&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;If the &lt;code class=&quot;language-text&quot;&gt;targetLeaseCount&lt;/code&gt; is negative , its a no-operation. &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Grab Expired/New Leases&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Partition Manager starts iterating through the lease blobs and whenever it finds any expired blobs&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It re-fetches the blobs to see its latest status.&lt;/li&gt;
&lt;li&gt;If the lease is not acquired by some other host&lt;/li&gt;
&lt;li&gt;It makes an &lt;code class=&quot;language-text&quot;&gt;AcquireLeaseAsync&lt;/code&gt; call on the lease blob. It passes a lease Id and the lease duration is set to 30 seconds.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Then it modifies the lease blob’s metadata. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It the &lt;code class=&quot;language-text&quot;&gt;OWNINGHOST&lt;/code&gt; to the current host id in the metadata    &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It modifies the lease blob’s content. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It sets the &lt;code class=&quot;language-text&quot;&gt;Owner&lt;/code&gt; to the current host id &lt;/li&gt;
&lt;li&gt;It sets the &lt;code class=&quot;language-text&quot;&gt;Token&lt;/code&gt; to the token returned by the Azure blob.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;This entire process happens parallelly for the leases. As in if targetLeaseCount is 4, the code tries to get 4 leases parallelly.&lt;/li&gt;
&lt;li&gt;There is a possibility of race condition, so it re-queries the blob for its lease status. If the lease gets owned by some other host in between the code, it skips that lease and does not try to get access forcefully.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Renew leases&lt;/h3&gt;
&lt;p&gt;This part of the code deals with renewing leases for the leases which were already owned by the host. The code iterates through all the leases and figures out the ones that are owned by the current host.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;For each of the lease that is owned and not expired, Partition Manager queries the pumps to find an existing token.&lt;/li&gt;
&lt;li&gt;The token would mean that at some point we had the lease to the leaseBlob.While it is possible to query the leaseBlob text to get the token, getting it from in-memory guarantees that Partition Manager is not stealing some other Host’s lease.&lt;/li&gt;
&lt;li&gt;It uses the lease token to call into Azure Blob and renew the lease.&lt;/li&gt;
&lt;li&gt;If there is an exception, no retry is made. The in-memory lease array is marked appropriately to signify that the lease has been lost.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Steal Leases&lt;/h3&gt;
&lt;p&gt;This section only deals with leases that are owned by other hosts. If a leased blob does not have an owner, this section will not act on it.&lt;/p&gt;
&lt;p&gt;Finding a lease that can be stolen.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We create a &lt;code class=&quot;language-text&quot;&gt;countsByOwner&lt;/code&gt; map, which has the count of leases per host&lt;/li&gt;
&lt;li&gt;We find the biggest owner who has the most number of leases.&lt;/li&gt;
&lt;li&gt;The &lt;a href=&quot;https://github.com/Azure/azure-sdk-for-net/blob/5e30a0ca3873d54a310924925e35043dd9f3b6a0/sdk/eventhub/Microsoft.Azure.EventHubs.Processor/src/PartitionManager.cs#L641&quot;&gt;docs in the code&lt;/a&gt; do a good job of explaining how the code decides which leases to still.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The most important line here is &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In either case, if the difference between this host and the biggest owner is 2 or more, then the system is not in the most evenly-distributed configuration, so steal one lease from the biggest.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;So based on &lt;code class=&quot;language-text&quot;&gt;(biggestOwner.Value - haveLeaseCount) &amp;gt;= 2&lt;/code&gt; we find &lt;code class=&quot;language-text&quot;&gt;one&lt;/code&gt; lease that we can move. This is &lt;strong&gt;not parallel&lt;/strong&gt;, only one lease can be moved at a particular time.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Once the above code finds a lease, it starts the process of stealing the lease. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It checks if the lease was stolen by some other host. If it was stolen then we do no act on it.&lt;/li&gt;
&lt;li&gt;Refresh the lease and checks if it is not expired or ownership has already changed. as in the lease is stolen by someone else.&lt;/li&gt;
&lt;li&gt;Then we acquire the lease using the &lt;strong&gt;token that was present in the blob&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;The code calls into &lt;code class=&quot;language-text&quot;&gt;ChangeLeaseAsync&lt;/code&gt; using the token present in the blob to switch over the lease and generate a new token. &lt;/li&gt;
&lt;li&gt;The previous host now loses access to the lease.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Now all of this lease management keeps happening in a loop until Cancellation is requested by calling into &lt;code class=&quot;language-text&quot;&gt;Unregister&lt;/code&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Azure Event Hub SDK Internals - Part 1 (Overview & Control Flow)]]></title><description><![CDATA[Azure Event Hub SDK Series This post is part 1 of a series of posts on Azure Event Hub SDK for Dot NET. Azure Event Hub SDK Internals - Part…]]></description><link>https://abhikmitra.github.io/blog/event-hub/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/event-hub/</guid><pubDate>Sat, 23 May 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Azure Event Hub SDK Series&lt;/h2&gt;
&lt;p&gt;This post is &lt;strong&gt;part 1&lt;/strong&gt; of a series of posts on Azure Event Hub SDK for Dot NET.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/event-hub/&quot;&gt;Azure Event Hub SDK Internals - Part 1 (Overview &amp;#x26; Control Flow)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/event-hub-2/&quot;&gt;Azure Event Hub SDK Internals - Part 2 (Partition Manager &amp;#x26; Lease Management)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/event-hub-3/&quot;&gt;Azure Event Hub SDK Internals - Part 3 (Pumping Data &amp;#x26; AMQP Links)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Do you think there is more that I should cover or something I should fix ? Please raise an &lt;a href=&quot;https://github.com/abhikmitra/blog/issues&quot;&gt;issue&lt;/a&gt; and let me know.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Azure Event Hubs is a big data streaming platform and event ingestion service. It can receive and process millions of events per second. Data sent to an event hub can be transformed and stored by using any real-time analytics provider or batching/storage adapters. You can read more about Event Hubs &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The series focusses on &lt;a href=&quot;https://www.nuget.org/packages/Microsoft.Azure.EventHubs/&quot;&gt;Microsoft.Azure.EventHubs&lt;/a&gt; SDK - v4.2. This maps to &lt;a href=&quot;https://github.com/Azure/azure-sdk-for-net&quot;&gt;Azure SDK for net&lt;/a&gt; commit Id &lt;code class=&quot;language-text&quot;&gt;00d8f23cffe22afb0e574909039556d8ca891be9&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;Event processor&lt;/h2&gt;
&lt;p&gt;We will focus on the Event Hub Processor since that is the part which deals with checkpointing , leasing , etc. &lt;/p&gt;
&lt;p&gt;There are 2 broad steps to receiving an event and we will dive into the details of each of the areas.&lt;/p&gt;
&lt;h3&gt;RegisterEventProcessorAsync - Initialization&lt;/h3&gt;
&lt;p&gt;Here is a typical code that you would use for registering an event processor.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; eventProcessorHost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventProcessorHost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                EventHubName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                PartitionReceiver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DefaultConsumerGroupName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                EventHubConnectionString&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                StorageConnectionString&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                StorageContainerName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Registers the Event Processor Host and starts receiving messages&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; eventProcessorHost&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;RegisterEventProcessorAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SimpleEventProcessor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here is what happens as a part of the registration.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;An Azure Storage CloudBlobClient is created with max execution time of 2 minutes.&lt;/li&gt;
&lt;li&gt;The PartitionManager is started which initializes the blob store.&lt;/li&gt;
&lt;li&gt;As a part of the initialization, first, it checks if the container exists.&lt;/li&gt;
&lt;li&gt;If not it will create the Azure blob container.&lt;/li&gt;
&lt;li&gt;Then it gets the run time information through an AMQP request to the Event Hub.&lt;/li&gt;
&lt;li&gt;The run time information has the partition count and partition ids.&lt;/li&gt;
&lt;li&gt;The response of the AMQP request looks like &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/922f134cd28d52d54541aaa8e5fdaa47/9cea8/GetRuntimeInformation.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAkklEQVQY033LSwuCQBSG4fn//6V1N1u1bxNSBkFCi8isM+OoY46+mRAt0j54OIdzUU0LtW8G+W5Zuoo0vWNtjs0LtMkQbb5VZ713L2JQ9GlHgK9KzvGJxy0hN9KNPf+igkgTRDJoddAswoTJesd0EzPfXpiFab9bjvyou3Xo0iNF/cO4hqtYwv2RzHnss0VGbj9ezAEvjK4biQQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;this&quot;
        title=&quot;this&quot;
        src=&quot;/blog/static/922f134cd28d52d54541aaa8e5fdaa47/fcda8/GetRuntimeInformation.png&quot;
        srcset=&quot;/blog/static/922f134cd28d52d54541aaa8e5fdaa47/12f09/GetRuntimeInformation.png 148w,
/blog/static/922f134cd28d52d54541aaa8e5fdaa47/e4a3f/GetRuntimeInformation.png 295w,
/blog/static/922f134cd28d52d54541aaa8e5fdaa47/fcda8/GetRuntimeInformation.png 590w,
/blog/static/922f134cd28d52d54541aaa8e5fdaa47/efc66/GetRuntimeInformation.png 885w,
/blog/static/922f134cd28d52d54541aaa8e5fdaa47/c83ae/GetRuntimeInformation.png 1180w,
/blog/static/922f134cd28d52d54541aaa8e5fdaa47/9cea8/GetRuntimeInformation.png 1278w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It extracts the Partition Ids and then create the leases for each of the partitions.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The blobs get created under &lt;code class=&quot;language-text&quot;&gt;&amp;lt;containername&amp;gt;/$Default/&amp;lt;PartitonName&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The blob contents are &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-json line-numbers&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;Offset&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token null keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;SequenceNumber&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;PartitionId&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;Owner&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;Token&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;Epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Verify the checkpoint store exists. In this library checkpoints store is same as the lease store. So checkpoint operations turn into lease operations under the covers. Read the comment in the code &lt;a href=&quot;https://github.com/Azure/azure-sdk-for-net/blob/5e30a0ca3873d54a310924925e35043dd9f3b6a0/sdk/eventhub/Microsoft.Azure.EventHubs.Processor/src/AzureStorageCheckpointLeaseManager.cs#L106&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Similar to leases, it checks for the existence of checkpoints. Since it is the same as leases, it is marked as a no-op.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1590435049766&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:850px;&quot; viewBox=&quot;-50 -10 850 441&quot;&gt;&lt;style&gt;#mermaid-1590435049766 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590435049766 .label text{fill:#333}#mermaid-1590435049766 .node rect,#mermaid-1590435049766 .node circle,#mermaid-1590435049766 .node ellipse,#mermaid-1590435049766 .node polygon,#mermaid-1590435049766 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590435049766 .node .label{text-align:center}#mermaid-1590435049766 .node.clickable{cursor:pointer}#mermaid-1590435049766 .arrowheadPath{fill:#333}#mermaid-1590435049766 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590435049766 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590435049766 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590435049766 .cluster text{fill:#333}#mermaid-1590435049766 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590435049766 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590435049766 text.actor{fill:#000;stroke:none}#mermaid-1590435049766 .actor-line{stroke:grey}#mermaid-1590435049766 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435049766 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435049766 #arrowhead{fill:#333}#mermaid-1590435049766 .sequenceNumber{fill:#fff}#mermaid-1590435049766 #sequencenumber{fill:#333}#mermaid-1590435049766 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590435049766 .messageText{fill:#333;stroke:none}#mermaid-1590435049766 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590435049766 .labelText{fill:#000;stroke:none}#mermaid-1590435049766 .loopText{fill:#000;stroke:none}#mermaid-1590435049766 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1590435049766 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435049766 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590435049766 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590435049766 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590435049766 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590435049766 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 .section{stroke:none;opacity:0.2}#mermaid-1590435049766 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590435049766 .section2{fill:#fff400}#mermaid-1590435049766 .section1,#mermaid-1590435049766 .section3{fill:#fff;opacity:0.2}#mermaid-1590435049766 .sectionTitle0{fill:#333}#mermaid-1590435049766 .sectionTitle1{fill:#333}#mermaid-1590435049766 .sectionTitle2{fill:#333}#mermaid-1590435049766 .sectionTitle3{fill:#333}#mermaid-1590435049766 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590435049766 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 .grid path{stroke-width:0}#mermaid-1590435049766 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590435049766 .task{stroke-width:2}#mermaid-1590435049766 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 .taskText:not([font-size]){font-size:11px}#mermaid-1590435049766 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590435049766 .task.clickable{cursor:pointer}#mermaid-1590435049766 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049766 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049766 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049766 .taskText0,#mermaid-1590435049766 .taskText1,#mermaid-1590435049766 .taskText2,#mermaid-1590435049766 .taskText3{fill:#fff}#mermaid-1590435049766 .task0,#mermaid-1590435049766 .task1,#mermaid-1590435049766 .task2,#mermaid-1590435049766 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590435049766 .taskTextOutside0,#mermaid-1590435049766 .taskTextOutside2{fill:#000}#mermaid-1590435049766 .taskTextOutside1,#mermaid-1590435049766 .taskTextOutside3{fill:#000}#mermaid-1590435049766 .active0,#mermaid-1590435049766 .active1,#mermaid-1590435049766 .active2,#mermaid-1590435049766 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590435049766 .activeText0,#mermaid-1590435049766 .activeText1,#mermaid-1590435049766 .activeText2,#mermaid-1590435049766 .activeText3{fill:#000 !important}#mermaid-1590435049766 .done0,#mermaid-1590435049766 .done1,#mermaid-1590435049766 .done2,#mermaid-1590435049766 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590435049766 .doneText0,#mermaid-1590435049766 .doneText1,#mermaid-1590435049766 .doneText2,#mermaid-1590435049766 .doneText3{fill:#000 !important}#mermaid-1590435049766 .crit0,#mermaid-1590435049766 .crit1,#mermaid-1590435049766 .crit2,#mermaid-1590435049766 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590435049766 .activeCrit0,#mermaid-1590435049766 .activeCrit1,#mermaid-1590435049766 .activeCrit2,#mermaid-1590435049766 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590435049766 .doneCrit0,#mermaid-1590435049766 .doneCrit1,#mermaid-1590435049766 .doneCrit2,#mermaid-1590435049766 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590435049766 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590435049766 .milestoneText{font-style:italic}#mermaid-1590435049766 .doneCritText0,#mermaid-1590435049766 .doneCritText1,#mermaid-1590435049766 .doneCritText2,#mermaid-1590435049766 .doneCritText3{fill:#000 !important}#mermaid-1590435049766 .activeCritText0,#mermaid-1590435049766 .activeCritText1,#mermaid-1590435049766 .activeCritText2,#mermaid-1590435049766 .activeCritText3{fill:#000 !important}#mermaid-1590435049766 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590435049766 g.classGroup text .title{font-weight:bolder}#mermaid-1590435049766 g.clickable{cursor:pointer}#mermaid-1590435049766 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435049766 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435049766 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435049766 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590435049766 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435049766 .dashed-line{stroke-dasharray:3}#mermaid-1590435049766 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049766 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049766 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435049766 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435049766 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049766 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049766 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049766 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049766 .commit-id,#mermaid-1590435049766 .commit-msg,#mermaid-1590435049766 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049766 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590435049766 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590435049766 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435049766 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435049766 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435049766 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590435049766 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590435049766 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435049766 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590435049766 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435049766 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1590435049766 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Main()&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;EventProcessorHost&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Azure Blob Storage&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;EventHub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;RegisterEventProcessorAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Check If Container Exists for leases&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;475&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;AMQP: Gets Runtime Information&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;170&quot; x2=&quot;675&quot; y2=&quot;170&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;223&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Create Lease for Partition 0&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;230&quot; x2=&quot;475&quot; y2=&quot;230&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;258&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Create Lease for Partition 1&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;265&quot; x2=&quot;475&quot; y2=&quot;265&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;265&quot; y1=&quot;180&quot; x2=&quot;485&quot; y2=&quot;180&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;485&quot; y1=&quot;180&quot; x2=&quot;485&quot; y2=&quot;275&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;265&quot; y1=&quot;275&quot; x2=&quot;485&quot; y2=&quot;275&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;265&quot; y1=&quot;180&quot; x2=&quot;265&quot; y2=&quot;275&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;265,180 315,180 315,193 306.6,200 265,200&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;272.5&quot; y=&quot;195&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;272.5&quot;&gt;loop&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;375&quot; y=&quot;195&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;375&quot;&gt;[ For each Partition ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;303&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Check If Container Exists for Checkpoints&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;310&quot; x2=&quot;475&quot; y2=&quot;310&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;338&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Return&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;345&quot; x2=&quot;75&quot; y2=&quot;345&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Main()&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;EventProcessorHost&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Azure Blob Storage&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;EventHub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;Initialization is now complete.
Kicks off the run Async Processor and returns &lt;strong&gt;without&lt;/strong&gt; waiting for RunAsync to complete&lt;/p&gt;
&lt;h3&gt;RegisterEventProcessorAsync - Run Async&lt;/h3&gt;
&lt;p&gt;As mentioned above, RunAsync part of the process is done asynchronously after RegisterEventProcessorAsync returns.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The library checks the &lt;code class=&quot;language-text&quot;&gt;$Default&lt;/code&gt; blob directory and gets all the leases.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It tries to renew downloaded leases&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1590435049005&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:450px;&quot; viewBox=&quot;-50 -10 450 196&quot;&gt;&lt;style&gt;#mermaid-1590435049005 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590435049005 .label text{fill:#333}#mermaid-1590435049005 .node rect,#mermaid-1590435049005 .node circle,#mermaid-1590435049005 .node ellipse,#mermaid-1590435049005 .node polygon,#mermaid-1590435049005 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590435049005 .node .label{text-align:center}#mermaid-1590435049005 .node.clickable{cursor:pointer}#mermaid-1590435049005 .arrowheadPath{fill:#333}#mermaid-1590435049005 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590435049005 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590435049005 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590435049005 .cluster text{fill:#333}#mermaid-1590435049005 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590435049005 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590435049005 text.actor{fill:#000;stroke:none}#mermaid-1590435049005 .actor-line{stroke:grey}#mermaid-1590435049005 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435049005 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435049005 #arrowhead{fill:#333}#mermaid-1590435049005 .sequenceNumber{fill:#fff}#mermaid-1590435049005 #sequencenumber{fill:#333}#mermaid-1590435049005 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590435049005 .messageText{fill:#333;stroke:none}#mermaid-1590435049005 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590435049005 .labelText{fill:#000;stroke:none}#mermaid-1590435049005 .loopText{fill:#000;stroke:none}#mermaid-1590435049005 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1590435049005 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435049005 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590435049005 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590435049005 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590435049005 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590435049005 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 .section{stroke:none;opacity:0.2}#mermaid-1590435049005 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590435049005 .section2{fill:#fff400}#mermaid-1590435049005 .section1,#mermaid-1590435049005 .section3{fill:#fff;opacity:0.2}#mermaid-1590435049005 .sectionTitle0{fill:#333}#mermaid-1590435049005 .sectionTitle1{fill:#333}#mermaid-1590435049005 .sectionTitle2{fill:#333}#mermaid-1590435049005 .sectionTitle3{fill:#333}#mermaid-1590435049005 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590435049005 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 .grid path{stroke-width:0}#mermaid-1590435049005 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590435049005 .task{stroke-width:2}#mermaid-1590435049005 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 .taskText:not([font-size]){font-size:11px}#mermaid-1590435049005 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590435049005 .task.clickable{cursor:pointer}#mermaid-1590435049005 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049005 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049005 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049005 .taskText0,#mermaid-1590435049005 .taskText1,#mermaid-1590435049005 .taskText2,#mermaid-1590435049005 .taskText3{fill:#fff}#mermaid-1590435049005 .task0,#mermaid-1590435049005 .task1,#mermaid-1590435049005 .task2,#mermaid-1590435049005 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590435049005 .taskTextOutside0,#mermaid-1590435049005 .taskTextOutside2{fill:#000}#mermaid-1590435049005 .taskTextOutside1,#mermaid-1590435049005 .taskTextOutside3{fill:#000}#mermaid-1590435049005 .active0,#mermaid-1590435049005 .active1,#mermaid-1590435049005 .active2,#mermaid-1590435049005 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590435049005 .activeText0,#mermaid-1590435049005 .activeText1,#mermaid-1590435049005 .activeText2,#mermaid-1590435049005 .activeText3{fill:#000 !important}#mermaid-1590435049005 .done0,#mermaid-1590435049005 .done1,#mermaid-1590435049005 .done2,#mermaid-1590435049005 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590435049005 .doneText0,#mermaid-1590435049005 .doneText1,#mermaid-1590435049005 .doneText2,#mermaid-1590435049005 .doneText3{fill:#000 !important}#mermaid-1590435049005 .crit0,#mermaid-1590435049005 .crit1,#mermaid-1590435049005 .crit2,#mermaid-1590435049005 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590435049005 .activeCrit0,#mermaid-1590435049005 .activeCrit1,#mermaid-1590435049005 .activeCrit2,#mermaid-1590435049005 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590435049005 .doneCrit0,#mermaid-1590435049005 .doneCrit1,#mermaid-1590435049005 .doneCrit2,#mermaid-1590435049005 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590435049005 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590435049005 .milestoneText{font-style:italic}#mermaid-1590435049005 .doneCritText0,#mermaid-1590435049005 .doneCritText1,#mermaid-1590435049005 .doneCritText2,#mermaid-1590435049005 .doneCritText3{fill:#000 !important}#mermaid-1590435049005 .activeCritText0,#mermaid-1590435049005 .activeCritText1,#mermaid-1590435049005 .activeCritText2,#mermaid-1590435049005 .activeCritText3{fill:#000 !important}#mermaid-1590435049005 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590435049005 g.classGroup text .title{font-weight:bolder}#mermaid-1590435049005 g.clickable{cursor:pointer}#mermaid-1590435049005 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435049005 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435049005 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435049005 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590435049005 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435049005 .dashed-line{stroke-dasharray:3}#mermaid-1590435049005 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049005 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049005 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435049005 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435049005 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049005 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049005 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049005 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049005 .commit-id,#mermaid-1590435049005 .commit-msg,#mermaid-1590435049005 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049005 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590435049005 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590435049005 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435049005 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435049005 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435049005 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590435049005 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590435049005 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435049005 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590435049005 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435049005 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1590435049005 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;185&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;EventProcessorHost&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;185&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Azure Blob Storage&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ListBlobsSegmentedAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;120&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;152.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;EventProcessorHost&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;120&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;152.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Azure Blob Storage&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;Then start the lease management process. As a part of lease management, the Partition Manager downloads the Lease Blob, rechecks, and then acquires the lease. Sets the owner to the current hostId uploads it back&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1590435049066&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:450px;&quot; viewBox=&quot;-50 -10 450 441&quot;&gt;&lt;style&gt;#mermaid-1590435049066 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590435049066 .label text{fill:#333}#mermaid-1590435049066 .node rect,#mermaid-1590435049066 .node circle,#mermaid-1590435049066 .node ellipse,#mermaid-1590435049066 .node polygon,#mermaid-1590435049066 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590435049066 .node .label{text-align:center}#mermaid-1590435049066 .node.clickable{cursor:pointer}#mermaid-1590435049066 .arrowheadPath{fill:#333}#mermaid-1590435049066 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590435049066 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590435049066 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590435049066 .cluster text{fill:#333}#mermaid-1590435049066 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590435049066 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590435049066 text.actor{fill:#000;stroke:none}#mermaid-1590435049066 .actor-line{stroke:grey}#mermaid-1590435049066 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435049066 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435049066 #arrowhead{fill:#333}#mermaid-1590435049066 .sequenceNumber{fill:#fff}#mermaid-1590435049066 #sequencenumber{fill:#333}#mermaid-1590435049066 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590435049066 .messageText{fill:#333;stroke:none}#mermaid-1590435049066 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590435049066 .labelText{fill:#000;stroke:none}#mermaid-1590435049066 .loopText{fill:#000;stroke:none}#mermaid-1590435049066 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1590435049066 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435049066 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590435049066 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590435049066 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590435049066 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590435049066 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 .section{stroke:none;opacity:0.2}#mermaid-1590435049066 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590435049066 .section2{fill:#fff400}#mermaid-1590435049066 .section1,#mermaid-1590435049066 .section3{fill:#fff;opacity:0.2}#mermaid-1590435049066 .sectionTitle0{fill:#333}#mermaid-1590435049066 .sectionTitle1{fill:#333}#mermaid-1590435049066 .sectionTitle2{fill:#333}#mermaid-1590435049066 .sectionTitle3{fill:#333}#mermaid-1590435049066 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590435049066 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 .grid path{stroke-width:0}#mermaid-1590435049066 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590435049066 .task{stroke-width:2}#mermaid-1590435049066 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 .taskText:not([font-size]){font-size:11px}#mermaid-1590435049066 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590435049066 .task.clickable{cursor:pointer}#mermaid-1590435049066 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049066 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049066 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049066 .taskText0,#mermaid-1590435049066 .taskText1,#mermaid-1590435049066 .taskText2,#mermaid-1590435049066 .taskText3{fill:#fff}#mermaid-1590435049066 .task0,#mermaid-1590435049066 .task1,#mermaid-1590435049066 .task2,#mermaid-1590435049066 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590435049066 .taskTextOutside0,#mermaid-1590435049066 .taskTextOutside2{fill:#000}#mermaid-1590435049066 .taskTextOutside1,#mermaid-1590435049066 .taskTextOutside3{fill:#000}#mermaid-1590435049066 .active0,#mermaid-1590435049066 .active1,#mermaid-1590435049066 .active2,#mermaid-1590435049066 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590435049066 .activeText0,#mermaid-1590435049066 .activeText1,#mermaid-1590435049066 .activeText2,#mermaid-1590435049066 .activeText3{fill:#000 !important}#mermaid-1590435049066 .done0,#mermaid-1590435049066 .done1,#mermaid-1590435049066 .done2,#mermaid-1590435049066 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590435049066 .doneText0,#mermaid-1590435049066 .doneText1,#mermaid-1590435049066 .doneText2,#mermaid-1590435049066 .doneText3{fill:#000 !important}#mermaid-1590435049066 .crit0,#mermaid-1590435049066 .crit1,#mermaid-1590435049066 .crit2,#mermaid-1590435049066 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590435049066 .activeCrit0,#mermaid-1590435049066 .activeCrit1,#mermaid-1590435049066 .activeCrit2,#mermaid-1590435049066 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590435049066 .doneCrit0,#mermaid-1590435049066 .doneCrit1,#mermaid-1590435049066 .doneCrit2,#mermaid-1590435049066 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590435049066 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590435049066 .milestoneText{font-style:italic}#mermaid-1590435049066 .doneCritText0,#mermaid-1590435049066 .doneCritText1,#mermaid-1590435049066 .doneCritText2,#mermaid-1590435049066 .doneCritText3{fill:#000 !important}#mermaid-1590435049066 .activeCritText0,#mermaid-1590435049066 .activeCritText1,#mermaid-1590435049066 .activeCritText2,#mermaid-1590435049066 .activeCritText3{fill:#000 !important}#mermaid-1590435049066 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590435049066 g.classGroup text .title{font-weight:bolder}#mermaid-1590435049066 g.clickable{cursor:pointer}#mermaid-1590435049066 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435049066 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435049066 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435049066 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590435049066 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435049066 .dashed-line{stroke-dasharray:3}#mermaid-1590435049066 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049066 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049066 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435049066 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435049066 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049066 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049066 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049066 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049066 .commit-id,#mermaid-1590435049066 .commit-msg,#mermaid-1590435049066 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049066 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590435049066 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590435049066 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435049066 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435049066 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435049066 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590435049066 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590435049066 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435049066 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590435049066 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435049066 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1590435049066 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;EventProcessorHost&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;430&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Azure Blob Storage&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ListBlobsSegmentedAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;153&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;FetchAttributesAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;160&quot; x2=&quot;275&quot; y2=&quot;160&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;188&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;DownloadTextAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;195&quot; x2=&quot;275&quot; y2=&quot;195&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;223&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;FetchAttributesAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;230&quot; x2=&quot;275&quot; y2=&quot;230&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;258&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;AcquireLeaseAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;265&quot; x2=&quot;275&quot; y2=&quot;265&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;293&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;SetMetadataAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;300&quot; x2=&quot;275&quot; y2=&quot;300&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;328&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;UploadTextAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;335&quot; x2=&quot;275&quot; y2=&quot;335&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;65&quot; y1=&quot;110&quot; x2=&quot;285&quot; y2=&quot;110&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;285&quot; y1=&quot;110&quot; x2=&quot;285&quot; y2=&quot;345&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;345&quot; x2=&quot;285&quot; y2=&quot;345&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;110&quot; x2=&quot;65&quot; y2=&quot;345&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;65,110 115,110 115,123 106.6,130 65,130&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;72.5&quot; y=&quot;125&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;72.5&quot;&gt;loop&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;175&quot; y=&quot;125&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;175&quot;&gt;[ For each Partition - Lease Management ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;EventProcessorHost&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;365&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;397.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Azure Blob Storage&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;For each Lease that is owned by the host, Partition Manager creates a Pump. The pump is responsible for querying the event hub for messages and pushing it to the subscriber&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Refresh the Blob again so that we get the latest and check the hostname and check its expiry.&lt;/li&gt;
&lt;li&gt;If everything looks alright we create the pump&lt;/li&gt;
&lt;li&gt;We open the Pump using Open Async&lt;/li&gt;
&lt;li&gt;Then pump fetches the lease blob and checks for offset.&lt;/li&gt;
&lt;li&gt;The pump keeps checking for messages and keeps pushing them to the Event Processor&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1590435049006&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:850px;&quot; viewBox=&quot;-50 -10 850 616&quot;&gt;&lt;style&gt;#mermaid-1590435049006 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590435049006 .label text{fill:#333}#mermaid-1590435049006 .node rect,#mermaid-1590435049006 .node circle,#mermaid-1590435049006 .node ellipse,#mermaid-1590435049006 .node polygon,#mermaid-1590435049006 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590435049006 .node .label{text-align:center}#mermaid-1590435049006 .node.clickable{cursor:pointer}#mermaid-1590435049006 .arrowheadPath{fill:#333}#mermaid-1590435049006 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590435049006 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590435049006 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590435049006 .cluster text{fill:#333}#mermaid-1590435049006 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590435049006 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590435049006 text.actor{fill:#000;stroke:none}#mermaid-1590435049006 .actor-line{stroke:grey}#mermaid-1590435049006 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435049006 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590435049006 #arrowhead{fill:#333}#mermaid-1590435049006 .sequenceNumber{fill:#fff}#mermaid-1590435049006 #sequencenumber{fill:#333}#mermaid-1590435049006 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590435049006 .messageText{fill:#333;stroke:none}#mermaid-1590435049006 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590435049006 .labelText{fill:#000;stroke:none}#mermaid-1590435049006 .loopText{fill:#000;stroke:none}#mermaid-1590435049006 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1590435049006 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435049006 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590435049006 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590435049006 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590435049006 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590435049006 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 .section{stroke:none;opacity:0.2}#mermaid-1590435049006 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590435049006 .section2{fill:#fff400}#mermaid-1590435049006 .section1,#mermaid-1590435049006 .section3{fill:#fff;opacity:0.2}#mermaid-1590435049006 .sectionTitle0{fill:#333}#mermaid-1590435049006 .sectionTitle1{fill:#333}#mermaid-1590435049006 .sectionTitle2{fill:#333}#mermaid-1590435049006 .sectionTitle3{fill:#333}#mermaid-1590435049006 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590435049006 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 .grid path{stroke-width:0}#mermaid-1590435049006 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590435049006 .task{stroke-width:2}#mermaid-1590435049006 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 .taskText:not([font-size]){font-size:11px}#mermaid-1590435049006 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590435049006 .task.clickable{cursor:pointer}#mermaid-1590435049006 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049006 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049006 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590435049006 .taskText0,#mermaid-1590435049006 .taskText1,#mermaid-1590435049006 .taskText2,#mermaid-1590435049006 .taskText3{fill:#fff}#mermaid-1590435049006 .task0,#mermaid-1590435049006 .task1,#mermaid-1590435049006 .task2,#mermaid-1590435049006 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590435049006 .taskTextOutside0,#mermaid-1590435049006 .taskTextOutside2{fill:#000}#mermaid-1590435049006 .taskTextOutside1,#mermaid-1590435049006 .taskTextOutside3{fill:#000}#mermaid-1590435049006 .active0,#mermaid-1590435049006 .active1,#mermaid-1590435049006 .active2,#mermaid-1590435049006 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590435049006 .activeText0,#mermaid-1590435049006 .activeText1,#mermaid-1590435049006 .activeText2,#mermaid-1590435049006 .activeText3{fill:#000 !important}#mermaid-1590435049006 .done0,#mermaid-1590435049006 .done1,#mermaid-1590435049006 .done2,#mermaid-1590435049006 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590435049006 .doneText0,#mermaid-1590435049006 .doneText1,#mermaid-1590435049006 .doneText2,#mermaid-1590435049006 .doneText3{fill:#000 !important}#mermaid-1590435049006 .crit0,#mermaid-1590435049006 .crit1,#mermaid-1590435049006 .crit2,#mermaid-1590435049006 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590435049006 .activeCrit0,#mermaid-1590435049006 .activeCrit1,#mermaid-1590435049006 .activeCrit2,#mermaid-1590435049006 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590435049006 .doneCrit0,#mermaid-1590435049006 .doneCrit1,#mermaid-1590435049006 .doneCrit2,#mermaid-1590435049006 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590435049006 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590435049006 .milestoneText{font-style:italic}#mermaid-1590435049006 .doneCritText0,#mermaid-1590435049006 .doneCritText1,#mermaid-1590435049006 .doneCritText2,#mermaid-1590435049006 .doneCritText3{fill:#000 !important}#mermaid-1590435049006 .activeCritText0,#mermaid-1590435049006 .activeCritText1,#mermaid-1590435049006 .activeCritText2,#mermaid-1590435049006 .activeCritText3{fill:#000 !important}#mermaid-1590435049006 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590435049006 g.classGroup text .title{font-weight:bolder}#mermaid-1590435049006 g.clickable{cursor:pointer}#mermaid-1590435049006 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435049006 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435049006 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435049006 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590435049006 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435049006 .dashed-line{stroke-dasharray:3}#mermaid-1590435049006 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049006 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049006 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435049006 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590435049006 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049006 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049006 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049006 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590435049006 .commit-id,#mermaid-1590435049006 .commit-msg,#mermaid-1590435049006 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590435049006 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590435049006 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590435049006 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590435049006 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590435049006 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590435049006 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590435049006 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590435049006 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590435049006 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590435049006 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590435049006 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1590435049006 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;605&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;EventProcessorHost&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;605&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Azure Blob Storage&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;605&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;SimpleEventProcessor&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;605&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;AMQP&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;118&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;FetchAttributesAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;125&quot; x2=&quot;275&quot; y2=&quot;125&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;153&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;DownloadTextAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;160&quot; x2=&quot;275&quot; y2=&quot;160&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;213&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;FetchAttributesAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;220&quot; x2=&quot;275&quot; y2=&quot;220&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;248&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;DownloadTextAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;255&quot; x2=&quot;275&quot; y2=&quot;255&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;275&quot; y=&quot;283&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OpenAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;290&quot; x2=&quot;475&quot; y2=&quot;290&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;318&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;FetchAttributesAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;325&quot; x2=&quot;275&quot; y2=&quot;325&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;353&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;DownloadTextAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;360&quot; x2=&quot;275&quot; y2=&quot;360&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;413&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;BeginReceiveMessages&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;420&quot; x2=&quot;675&quot; y2=&quot;420&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;448&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;EndReceiveMessages&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;455&quot; x2=&quot;675&quot; y2=&quot;455&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;275&quot; y=&quot;483&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OnReceiveAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;490&quot; x2=&quot;475&quot; y2=&quot;490&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;65&quot; y1=&quot;370&quot; x2=&quot;685&quot; y2=&quot;370&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;685&quot; y1=&quot;370&quot; x2=&quot;685&quot; y2=&quot;500&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;500&quot; x2=&quot;685&quot; y2=&quot;500&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;370&quot; x2=&quot;65&quot; y2=&quot;500&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;65,370 115,370 115,383 106.6,390 65,390&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;72.5&quot; y=&quot;385&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;72.5&quot;&gt;loop&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;375&quot; y=&quot;385&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;375&quot;&gt;[ polls ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;55&quot; y1=&quot;170&quot; x2=&quot;695&quot; y2=&quot;170&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;695&quot; y1=&quot;170&quot; x2=&quot;695&quot; y2=&quot;510&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;55&quot; y1=&quot;510&quot; x2=&quot;695&quot; y2=&quot;510&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;55&quot; y1=&quot;170&quot; x2=&quot;55&quot; y2=&quot;510&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;55,170 105,170 105,183 96.6,190 55,190&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;62.5&quot; y=&quot;185&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;62.5&quot;&gt;opt&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;375&quot; y=&quot;185&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;375&quot;&gt;[ Open Pump ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;45&quot; y1=&quot;75&quot; x2=&quot;705&quot; y2=&quot;75&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;705&quot; y1=&quot;75&quot; x2=&quot;705&quot; y2=&quot;520&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;45&quot; y1=&quot;520&quot; x2=&quot;705&quot; y2=&quot;520&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;45&quot; y1=&quot;75&quot; x2=&quot;45&quot; y2=&quot;520&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;45,75 95,75 95,88 86.6,95 45,95&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;52.5&quot; y=&quot;90&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;52.5&quot;&gt;loop&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;375&quot; y=&quot;90&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;375&quot;&gt;[ For each Lease owned by Host ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;540&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;572.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;EventProcessorHost&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;540&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;572.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Azure Blob Storage&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;540&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;572.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;SimpleEventProcessor&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;540&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;572.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;AMQP&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;Overall there are 3 sections in Azure Event Hub&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Partition Manager - This takes care of Lease Management &amp;#x26; Creation of Pumps &lt;/li&gt;
&lt;li&gt;Event Hub Partition Pump - This is responsible for pushing the events to the Event Processor&lt;/li&gt;
&lt;li&gt;AMQPPartitionReceiver - This handles the AMQP side of things when receiving a message.&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)]]></title><description><![CDATA[Durable Task Framework Series This post is part 6 of a series of posts on DTF. Durable Task Framework Internals - Part 1 (Dataflow and…]]></description><link>https://abhikmitra.github.io/blog/durable-task-6/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/durable-task-6/</guid><pubDate>Mon, 27 Apr 2020 19:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;Durable Task Framework Series&lt;/h3&gt;
&lt;p&gt;This post is &lt;strong&gt;part 6&lt;/strong&gt; of a series of posts on DTF.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task/&quot;&gt;Durable Task Framework Internals - Part 1 (Dataflow and Reliability)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-2/&quot;&gt;Durable Task Framework Internals - Part 2 (The curious case of Orchestrations)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-3/&quot;&gt;Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-4/&quot;&gt;Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp;#x26; Middlewares)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 5 (Interesting usages of TPL in DTF)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Do you think there is more that I should cover or something I should fix ? Please raise an &lt;a href=&quot;https://github.com/abhikmitra/blog/issues&quot;&gt;issue&lt;/a&gt; and let me know.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;In this post, we are going to go do a walk-through the code for DTF. This post would be helpful if you need to look under the covers. Instead of starting from scratch, you can go straight to the exciting part.&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905564561&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1250px;&quot; viewBox=&quot;-50 -10 1250 694&quot;&gt;&lt;style&gt;#mermaid-1587905564561 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905564561 .label text{fill:#333}#mermaid-1587905564561 .node rect,#mermaid-1587905564561 .node circle,#mermaid-1587905564561 .node ellipse,#mermaid-1587905564561 .node polygon,#mermaid-1587905564561 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905564561 .node .label{text-align:center}#mermaid-1587905564561 .node.clickable{cursor:pointer}#mermaid-1587905564561 .arrowheadPath{fill:#333}#mermaid-1587905564561 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905564561 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905564561 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905564561 .cluster text{fill:#333}#mermaid-1587905564561 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905564561 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905564561 text.actor{fill:#000;stroke:none}#mermaid-1587905564561 .actor-line{stroke:grey}#mermaid-1587905564561 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905564561 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905564561 #arrowhead{fill:#333}#mermaid-1587905564561 .sequenceNumber{fill:#fff}#mermaid-1587905564561 #sequencenumber{fill:#333}#mermaid-1587905564561 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905564561 .messageText{fill:#333;stroke:none}#mermaid-1587905564561 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905564561 .labelText{fill:#000;stroke:none}#mermaid-1587905564561 .loopText{fill:#000;stroke:none}#mermaid-1587905564561 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905564561 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905564561 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905564561 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905564561 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905564561 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905564561 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 .section{stroke:none;opacity:0.2}#mermaid-1587905564561 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905564561 .section2{fill:#fff400}#mermaid-1587905564561 .section1,#mermaid-1587905564561 .section3{fill:#fff;opacity:0.2}#mermaid-1587905564561 .sectionTitle0{fill:#333}#mermaid-1587905564561 .sectionTitle1{fill:#333}#mermaid-1587905564561 .sectionTitle2{fill:#333}#mermaid-1587905564561 .sectionTitle3{fill:#333}#mermaid-1587905564561 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905564561 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 .grid path{stroke-width:0}#mermaid-1587905564561 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905564561 .task{stroke-width:2}#mermaid-1587905564561 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 .taskText:not([font-size]){font-size:11px}#mermaid-1587905564561 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905564561 .task.clickable{cursor:pointer}#mermaid-1587905564561 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905564561 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905564561 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905564561 .taskText0,#mermaid-1587905564561 .taskText1,#mermaid-1587905564561 .taskText2,#mermaid-1587905564561 .taskText3{fill:#fff}#mermaid-1587905564561 .task0,#mermaid-1587905564561 .task1,#mermaid-1587905564561 .task2,#mermaid-1587905564561 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905564561 .taskTextOutside0,#mermaid-1587905564561 .taskTextOutside2{fill:#000}#mermaid-1587905564561 .taskTextOutside1,#mermaid-1587905564561 .taskTextOutside3{fill:#000}#mermaid-1587905564561 .active0,#mermaid-1587905564561 .active1,#mermaid-1587905564561 .active2,#mermaid-1587905564561 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905564561 .activeText0,#mermaid-1587905564561 .activeText1,#mermaid-1587905564561 .activeText2,#mermaid-1587905564561 .activeText3{fill:#000 !important}#mermaid-1587905564561 .done0,#mermaid-1587905564561 .done1,#mermaid-1587905564561 .done2,#mermaid-1587905564561 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905564561 .doneText0,#mermaid-1587905564561 .doneText1,#mermaid-1587905564561 .doneText2,#mermaid-1587905564561 .doneText3{fill:#000 !important}#mermaid-1587905564561 .crit0,#mermaid-1587905564561 .crit1,#mermaid-1587905564561 .crit2,#mermaid-1587905564561 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905564561 .activeCrit0,#mermaid-1587905564561 .activeCrit1,#mermaid-1587905564561 .activeCrit2,#mermaid-1587905564561 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905564561 .doneCrit0,#mermaid-1587905564561 .doneCrit1,#mermaid-1587905564561 .doneCrit2,#mermaid-1587905564561 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905564561 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905564561 .milestoneText{font-style:italic}#mermaid-1587905564561 .doneCritText0,#mermaid-1587905564561 .doneCritText1,#mermaid-1587905564561 .doneCritText2,#mermaid-1587905564561 .doneCritText3{fill:#000 !important}#mermaid-1587905564561 .activeCritText0,#mermaid-1587905564561 .activeCritText1,#mermaid-1587905564561 .activeCritText2,#mermaid-1587905564561 .activeCritText3{fill:#000 !important}#mermaid-1587905564561 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905564561 g.classGroup text .title{font-weight:bolder}#mermaid-1587905564561 g.clickable{cursor:pointer}#mermaid-1587905564561 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905564561 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905564561 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905564561 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905564561 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905564561 .dashed-line{stroke-dasharray:3}#mermaid-1587905564561 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564561 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564561 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905564561 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905564561 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564561 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564561 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564561 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564561 .commit-id,#mermaid-1587905564561 .commit-msg,#mermaid-1587905564561 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564561 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905564561 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905564561 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905564561 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905564561 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905564561 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905564561 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905564561 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905564561 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905564561 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905564561 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905564561 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;683&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;main&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;683&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;TaskHubWorker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;683&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;ServiceBusOrchestrationService&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;683&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TaskOrchestrationDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;683&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;TaskActivityDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor5&quot; x1=&quot;1075&quot; y1=&quot;5&quot; x2=&quot;1075&quot; y2=&quot;683&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1000&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;WorkItemDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;275&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Create New Instance&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;475&quot; y2=&quot;100&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Create New Instance&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;135&quot; x2=&quot;1075&quot; y2=&quot;135&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;StartAsync()&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;170&quot; x2=&quot;275&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;475&quot; y=&quot;198&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Create New Instance&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;205&quot; x2=&quot;675&quot; y2=&quot;205&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;875&quot; y=&quot;233&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Create New Instance&lt;/text&gt;&lt;line x1=&quot;675&quot; y1=&quot;240&quot; x2=&quot;1075&quot; y2=&quot;240&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;268&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Create New Instance&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;275&quot; x2=&quot;875&quot; y2=&quot;275&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;975&quot; y=&quot;303&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Create New Instance&lt;/text&gt;&lt;line x1=&quot;875&quot; y1=&quot;310&quot; x2=&quot;1075&quot; y2=&quot;310&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;338&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;StartAsync()&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;345&quot; x2=&quot;475&quot; y2=&quot;345&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1000&quot; y=&quot;355&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;68&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;996&quot; y=&quot;379&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;1016&quot;&gt;3 instances of &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;996&quot; y=&quot;395&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;1016&quot;&gt; WorkItemDIspatcher&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;996&quot; y=&quot;411&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;1016&quot;&gt; is created&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;451&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;StartAsync()&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;458&quot; x2=&quot;1075&quot; y2=&quot;458&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;475&quot; y=&quot;486&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;StartAsync()&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;493&quot; x2=&quot;675&quot; y2=&quot;493&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;875&quot; y=&quot;521&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;StartAsync()&lt;/text&gt;&lt;line x1=&quot;675&quot; y1=&quot;528&quot; x2=&quot;1075&quot; y2=&quot;528&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;556&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;StartAsync()&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;563&quot; x2=&quot;875&quot; y2=&quot;563&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;975&quot; y=&quot;591&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;StartAsync()&lt;/text&gt;&lt;line x1=&quot;875&quot; y1=&quot;598&quot; x2=&quot;1075&quot; y2=&quot;598&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;618&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;650.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;main&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;618&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;650.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;TaskHubWorker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;618&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;650.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;ServiceBusOrchestrationService&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;618&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;650.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TaskOrchestrationDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;618&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;650.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;TaskActivityDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1000&quot; y=&quot;618&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;650.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;WorkItemDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;So whats happening here is , there are 3 interesting classes that get created&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ServiceBusOrchestrationService - Monitors the tracker Queue&lt;/li&gt;
&lt;li&gt;TaskOrchestrationDispatcher - Monitors Orchestrator Queue&lt;/li&gt;
&lt;li&gt;TaskActivityDispatcher - Monitors Worker Queue&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When you finally start the hub using &lt;code class=&quot;language-text&quot;&gt;StartAsync&lt;/code&gt;, all of these classes create their own  &lt;code class=&quot;language-text&quot;&gt;WorkItemDispatcher&lt;/code&gt; which is the starting point for all messages that your Receive.
WorkItem dispatcher has a while loop that keeps polling the respective QueueClient for new messages. So we have 3 WorkItemDispatchers polling three queues at regular intervals.
Whenever it gets any message, it creates a &lt;em&gt;new thread&lt;/em&gt; and passes it off, back to the respective dispatchers&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905564574&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1650px;&quot; viewBox=&quot;-50 -10 1650 538&quot;&gt;&lt;style&gt;#mermaid-1587905564574 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905564574 .label text{fill:#333}#mermaid-1587905564574 .node rect,#mermaid-1587905564574 .node circle,#mermaid-1587905564574 .node ellipse,#mermaid-1587905564574 .node polygon,#mermaid-1587905564574 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905564574 .node .label{text-align:center}#mermaid-1587905564574 .node.clickable{cursor:pointer}#mermaid-1587905564574 .arrowheadPath{fill:#333}#mermaid-1587905564574 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905564574 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905564574 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905564574 .cluster text{fill:#333}#mermaid-1587905564574 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905564574 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905564574 text.actor{fill:#000;stroke:none}#mermaid-1587905564574 .actor-line{stroke:grey}#mermaid-1587905564574 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905564574 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905564574 #arrowhead{fill:#333}#mermaid-1587905564574 .sequenceNumber{fill:#fff}#mermaid-1587905564574 #sequencenumber{fill:#333}#mermaid-1587905564574 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905564574 .messageText{fill:#333;stroke:none}#mermaid-1587905564574 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905564574 .labelText{fill:#000;stroke:none}#mermaid-1587905564574 .loopText{fill:#000;stroke:none}#mermaid-1587905564574 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905564574 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905564574 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905564574 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905564574 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905564574 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905564574 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 .section{stroke:none;opacity:0.2}#mermaid-1587905564574 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905564574 .section2{fill:#fff400}#mermaid-1587905564574 .section1,#mermaid-1587905564574 .section3{fill:#fff;opacity:0.2}#mermaid-1587905564574 .sectionTitle0{fill:#333}#mermaid-1587905564574 .sectionTitle1{fill:#333}#mermaid-1587905564574 .sectionTitle2{fill:#333}#mermaid-1587905564574 .sectionTitle3{fill:#333}#mermaid-1587905564574 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905564574 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 .grid path{stroke-width:0}#mermaid-1587905564574 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905564574 .task{stroke-width:2}#mermaid-1587905564574 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 .taskText:not([font-size]){font-size:11px}#mermaid-1587905564574 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905564574 .task.clickable{cursor:pointer}#mermaid-1587905564574 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905564574 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905564574 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905564574 .taskText0,#mermaid-1587905564574 .taskText1,#mermaid-1587905564574 .taskText2,#mermaid-1587905564574 .taskText3{fill:#fff}#mermaid-1587905564574 .task0,#mermaid-1587905564574 .task1,#mermaid-1587905564574 .task2,#mermaid-1587905564574 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905564574 .taskTextOutside0,#mermaid-1587905564574 .taskTextOutside2{fill:#000}#mermaid-1587905564574 .taskTextOutside1,#mermaid-1587905564574 .taskTextOutside3{fill:#000}#mermaid-1587905564574 .active0,#mermaid-1587905564574 .active1,#mermaid-1587905564574 .active2,#mermaid-1587905564574 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905564574 .activeText0,#mermaid-1587905564574 .activeText1,#mermaid-1587905564574 .activeText2,#mermaid-1587905564574 .activeText3{fill:#000 !important}#mermaid-1587905564574 .done0,#mermaid-1587905564574 .done1,#mermaid-1587905564574 .done2,#mermaid-1587905564574 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905564574 .doneText0,#mermaid-1587905564574 .doneText1,#mermaid-1587905564574 .doneText2,#mermaid-1587905564574 .doneText3{fill:#000 !important}#mermaid-1587905564574 .crit0,#mermaid-1587905564574 .crit1,#mermaid-1587905564574 .crit2,#mermaid-1587905564574 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905564574 .activeCrit0,#mermaid-1587905564574 .activeCrit1,#mermaid-1587905564574 .activeCrit2,#mermaid-1587905564574 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905564574 .doneCrit0,#mermaid-1587905564574 .doneCrit1,#mermaid-1587905564574 .doneCrit2,#mermaid-1587905564574 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905564574 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905564574 .milestoneText{font-style:italic}#mermaid-1587905564574 .doneCritText0,#mermaid-1587905564574 .doneCritText1,#mermaid-1587905564574 .doneCritText2,#mermaid-1587905564574 .doneCritText3{fill:#000 !important}#mermaid-1587905564574 .activeCritText0,#mermaid-1587905564574 .activeCritText1,#mermaid-1587905564574 .activeCritText2,#mermaid-1587905564574 .activeCritText3{fill:#000 !important}#mermaid-1587905564574 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905564574 g.classGroup text .title{font-weight:bolder}#mermaid-1587905564574 g.clickable{cursor:pointer}#mermaid-1587905564574 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905564574 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905564574 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905564574 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905564574 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905564574 .dashed-line{stroke-dasharray:3}#mermaid-1587905564574 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564574 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564574 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905564574 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905564574 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564574 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564574 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564574 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905564574 .commit-id,#mermaid-1587905564574 .commit-msg,#mermaid-1587905564574 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905564574 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905564574 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905564574 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905564574 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905564574 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905564574 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905564574 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905564574 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905564574 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905564574 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905564574 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905564574 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;527&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;WorkItemDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;527&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;TaskOrchestrationDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;527&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;TaskOrchestrationExecutor&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;527&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TaskActivityDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;527&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;TaskOrchestrationContext&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor5&quot; x1=&quot;1075&quot; y1=&quot;5&quot; x2=&quot;1075&quot; y2=&quot;527&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1000&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;DispatchMiddlewarePipeline&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor6&quot; x1=&quot;1275&quot; y1=&quot;5&quot; x2=&quot;1275&quot; y2=&quot;527&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1275&quot; dy=&quot;0&quot;&gt;TaskOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor7&quot; x1=&quot;1475&quot; y1=&quot;5&quot; x2=&quot;1475&quot; y2=&quot;527&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1475&quot; dy=&quot;0&quot;&gt;Testorchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OnProcessWorkItemSessionAsync&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Create new Instance&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Creates new instance&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;170&quot; x2=&quot;875&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;198&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Executes the Middlewares&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;205&quot; x2=&quot;1075&quot; y2=&quot;205&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;233&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Middlewares have reached the next() call&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;240&quot; x2=&quot;275&quot; y2=&quot;240&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;268&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Execute() - Not awaited&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;275&quot; x2=&quot;475&quot; y2=&quot;275&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;285&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;52&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;396&quot; y=&quot;309&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;416&quot;&gt;This is where &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;396&quot; y=&quot;325&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;416&quot;&gt; most of the logic is&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;875&quot; y=&quot;365&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Execute()&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;372&quot; x2=&quot;1275&quot; y2=&quot;372&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;1375&quot; y=&quot;400&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;RunTask&lt;/text&gt;&lt;line x1=&quot;1275&quot; y1=&quot;407&quot; x2=&quot;1475&quot; y2=&quot;407&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;435&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Decisions&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;442&quot; x2=&quot;275&quot; y2=&quot;442&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;462&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;494.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;WorkItemDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;462&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;494.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;TaskOrchestrationDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;462&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;494.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;TaskOrchestrationExecutor&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;462&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;494.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TaskActivityDispatcher&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;462&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;494.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;TaskOrchestrationContext&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1000&quot; y=&quot;462&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;494.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;DispatchMiddlewarePipeline&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1200&quot; y=&quot;462&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1275&quot; y=&quot;494.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1275&quot; dy=&quot;0&quot;&gt;TaskOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1400&quot; y=&quot;462&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1475&quot; y=&quot;494.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1475&quot; dy=&quot;0&quot;&gt;Testorchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;So the TaskOrchestrationExecutor is where most of the magic happens. It has multiple responsibilities.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Sets the SynchronizationContext&lt;/li&gt;
&lt;li&gt;Checks the event history and uses it to build up the current state of the orchestration.&lt;/li&gt;
&lt;li&gt;Figures out if the orchestration has already been terminated.&lt;/li&gt;
&lt;li&gt;Has various functions for handling different types of Orchestration start cases like &lt;code class=&quot;language-text&quot;&gt;TaskScheduled&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;TaskScheduled&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;SubOrchestrationInstanceCompleted&lt;/code&gt; etc.&lt;/li&gt;
&lt;li&gt;Handles Orchestration failures. &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When the TestOrchestration is invoked, all the calls to context (SchedulerWithRetry , timer, etc) get stored as an element in an array called decisions. The decision array is the messages that need to be put into the various Queues. The Dispatcher queues them back and marks the orchestration as complete.
This is the full flow right from the hub getting the message to executing it, figuring out the actions, and queueing them back.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Durable Task Framework Internals - Part 5 (Interesting usages of TPL in DTF)]]></title><description><![CDATA[Durable Task Framework Series This post is part 5 of a series of posts on DTF. Durable Task Framework Internals - Part 1 (Dataflow and…]]></description><link>https://abhikmitra.github.io/blog/durable-task-5/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/durable-task-5/</guid><pubDate>Mon, 27 Apr 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;Durable Task Framework Series&lt;/h3&gt;
&lt;p&gt;This post is &lt;strong&gt;part 5&lt;/strong&gt; of a series of posts on DTF.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task/&quot;&gt;Durable Task Framework Internals - Part 1 (Dataflow and Reliability)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-2/&quot;&gt;Durable Task Framework Internals - Part 2 (The curious case of Orchestrations)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-3/&quot;&gt;Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-4/&quot;&gt;Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp;#x26; Middlewares)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 5 (Interesting usages of TPL in DTF)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Do you think there is more that I should cover or something I should fix? Please raise an &lt;a href=&quot;https://github.com/abhikmitra/blog/issues&quot;&gt;issue&lt;/a&gt; and let me know.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;In this post, we are going to cover all the interesting Dot Net’s Task Parallel Library concepts that I found here. Some of them might not be advanced, but I have put them as I have not used these often in my regular code.&lt;/p&gt;
&lt;h3&gt;Thread Static&lt;/h3&gt;
&lt;p&gt;ThreadStatic is an attribute that marks a variable as static. You can read more about it &lt;a href=&quot;https://www.c-sharpcorner.com/article/overview-of-threadstatic-attribute-in-c-sharp/&quot;&gt;here&lt;/a&gt;. ThreadStatic is pretty simple to grasp. The &lt;code class=&quot;language-text&quot;&gt;OrchestrationContext&lt;/code&gt; has a &lt;em&gt;ThreadStatic&lt;/em&gt; variable to check any time during your orchestration to see if you are on the correct thread. Now, this usually is not required, as Orchestrations should not have async operations. But if Orchestration is executing a piece of code that you have no control over and you want to check that when control comes back to your code for illegal task continuations, this would be an excellent way to check. Based on the PR &lt;a href=&quot;https://github.com/Azure/durabletask/pull/171#discussion_r183195689&quot;&gt;here&lt;/a&gt;, this is precisely how it is used by the Azure Durable Functions team.&lt;/p&gt;
&lt;h3&gt;Synchronization Context&lt;/h3&gt;
&lt;p&gt;Synchronization Context is a little difficult to grasp. Here are the articles you should read with to understand SynchronizationContext.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://hamidmosalla.com/2018/06/24/what-is-synchronizationcontext/&quot;&gt;What is SynchronizationContext ?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://devblogs.microsoft.com/pfxteam/await-synchronizationcontext-and-console-apps/&quot;&gt;SynchronizationContext and Console Apps&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Thread {0}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CurrentThread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ManagedThreadId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; task1
Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Thread {0}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CurrentThread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ManagedThreadId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the above code, there is no guarantee that pre and post-task, both threads are going to be the same. What await is going to try and do is to bring back the back to control to the same SynchronizationContext. If it can find a SynchronizationContext, it will use the thread, if the &lt;code class=&quot;language-text&quot;&gt;SynchronizationContext.Current&lt;/code&gt; is null, it will choose any thread of the thread pool and continue on it.
Now there are cases where SynchronizationContext is not null, like in a WPF app or other UI facing apps. In case of console apps, the starting SynchronizationContext is  null. Durable Task Framework runs the orchestration on the same thread, irrespective of whether you are running the hub in a console app or in some other way. So to achieve this, in the &lt;code class=&quot;language-text&quot;&gt;TaskOrchestrationExecutor&lt;/code&gt; just before Orchestration is executed, DTF sets the SynchronizationContext and unsets it after the Orchestraton is complete.
Now when you do an &lt;code class=&quot;language-text&quot;&gt;await&lt;/code&gt; inside the orchestration, it might still span a thread to do an async operation, but when the execution of the async operation is completed, it will always come back to the starting thread using the SynchronizationContext.&lt;/p&gt;
&lt;h3&gt;TaskCompletionSource&lt;/h3&gt;
&lt;p&gt;These 2 articles do a pretty good job of explaining &lt;code class=&quot;language-text&quot;&gt;TaskCompletionSource&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.pluralsight.com/guides/task-taskcompletion-source-csharp&quot;&gt;Task vs. TaskCompletionSource&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/15316613/when-should-taskcompletionsourcet-be-used&quot;&gt;When should TaskCompletionSource be used ?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So now, you know that TaskCompletion sources is used to convert an event-driven code to a more promise based/awaitable pattern.
Now in DTF, we have discussed that Orchestrations get executed multiple times. Let’s assume that an orchestration as one below&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; Task&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RunTask&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; task1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ScheduleWithRetry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TestActivity1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Test Input1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; str &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;x&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; Task&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;90000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Substring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Length &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    str &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And from somewhere else in the code.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ExecuteOrchestrationAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt; runTimeState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;RunTask&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Task&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;FromResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So, we are invoking RunTask and not waiting for it to complete. As a result, now we are stuck with 500 MB of data, which will be in memory for 90 seconds. Considering that orchestrations can run days. What would you expect for the below piece of code?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-text line-numbers&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;public async Task&amp;lt;bool&amp;gt; RunTask()
{
    var task1 = context.ScheduleWithRetry&amp;lt;bool&amp;gt;(typeof(TestActivity1), options, &amp;quot;Test Input1&amp;quot;);
    var str = new string(&amp;#39;x&amp;#39;, 500 * 1024 * 1024);
    await task1;
    Console.WriteLine(str.Substring(str.Length - 10));
    str = null;
    return true;
}&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Tasks typically take much more than 90 seconds. And considering the orchestration would be invoked at least 2 times, we are looking at 1 GB of data per task. And if you remember Part 2, Orchestration gets executed multiple times, and it is perfectly normal for orchestration to Execute &lt;code class=&quot;language-text&quot;&gt;await task&lt;/code&gt; and never come back. So what happens is that &lt;code class=&quot;language-text&quot;&gt;ScheduleWithRetry&lt;/code&gt; gives back a TaskCompletionSource. &lt;/p&gt;
&lt;p&gt;And whenever the framework detects that &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There is no reference to TaskCompletionSource, so it cannot be set as completed.&lt;/li&gt;
&lt;li&gt;The async call itself is not awaited&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It garbage collects the memory.&lt;/p&gt;
&lt;p&gt;So hence, you will not see the memory leak that you would typically expect with async operations as the framework is smart enough to distinguish between the tasks that may complete and tasks that will never complete.
This is not generally a recommended pattern, as per the &lt;a href=&quot;https://devblogs.microsoft.com/pfxteam/dont-forget-to-complete-your-tasks/&quot;&gt;experts&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Durable Task Framework Internals - Part 4 (Terminated Orchestrations & Middlewares)]]></title><description><![CDATA[Durable Task Framework Series This post is part 4 of a series of posts on DTF. Durable Task Framework Internals - Part 1 (Dataflow and…]]></description><link>https://abhikmitra.github.io/blog/durable-task-4/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/durable-task-4/</guid><pubDate>Sun, 26 Apr 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;Durable Task Framework Series&lt;/h3&gt;
&lt;p&gt;This post is &lt;strong&gt;part 4&lt;/strong&gt; of a series of posts on DTF.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task/&quot;&gt;Durable Task Framework Internals - Part 1 (Dataflow and Reliability)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-2/&quot;&gt;Durable Task Framework Internals - Part 2 (The curious case of Orchestrations)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-3/&quot;&gt;Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-4/&quot;&gt;Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp;#x26; Middlewares)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 5 (Interesting usages of TPL in DTF)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Do you think there is more that I should cover or something I should fix ? Please raise an &lt;a href=&quot;https://github.com/abhikmitra/blog/issues&quot;&gt;issue&lt;/a&gt; and let me know.&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Terminate an orchestration&lt;/h3&gt;
&lt;p&gt;The Client can control the orchestration even though the Hub manages the orchestration. The Client can issue &lt;code class=&quot;language-text&quot;&gt;TerminateInstanceAsync&lt;/code&gt; to terminate the ongoing orchestration.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CreateOrchestrationInstanceAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TestOrchestration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;InstanceId5306&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Test Input&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Result&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
Task&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;TerminateInstanceAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here is the sequence diagram as to what happens behind the scenes&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562965&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1250px;&quot; viewBox=&quot;-50 -10 1250 702&quot;&gt;&lt;style&gt;#mermaid-1587905562965 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562965 .label text{fill:#333}#mermaid-1587905562965 .node rect,#mermaid-1587905562965 .node circle,#mermaid-1587905562965 .node ellipse,#mermaid-1587905562965 .node polygon,#mermaid-1587905562965 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562965 .node .label{text-align:center}#mermaid-1587905562965 .node.clickable{cursor:pointer}#mermaid-1587905562965 .arrowheadPath{fill:#333}#mermaid-1587905562965 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562965 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562965 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562965 .cluster text{fill:#333}#mermaid-1587905562965 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562965 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562965 text.actor{fill:#000;stroke:none}#mermaid-1587905562965 .actor-line{stroke:grey}#mermaid-1587905562965 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562965 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562965 #arrowhead{fill:#333}#mermaid-1587905562965 .sequenceNumber{fill:#fff}#mermaid-1587905562965 #sequencenumber{fill:#333}#mermaid-1587905562965 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562965 .messageText{fill:#333;stroke:none}#mermaid-1587905562965 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562965 .labelText{fill:#000;stroke:none}#mermaid-1587905562965 .loopText{fill:#000;stroke:none}#mermaid-1587905562965 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562965 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562965 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562965 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562965 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562965 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562965 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .section{stroke:none;opacity:0.2}#mermaid-1587905562965 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562965 .section2{fill:#fff400}#mermaid-1587905562965 .section1,#mermaid-1587905562965 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562965 .sectionTitle0{fill:#333}#mermaid-1587905562965 .sectionTitle1{fill:#333}#mermaid-1587905562965 .sectionTitle2{fill:#333}#mermaid-1587905562965 .sectionTitle3{fill:#333}#mermaid-1587905562965 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562965 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .grid path{stroke-width:0}#mermaid-1587905562965 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562965 .task{stroke-width:2}#mermaid-1587905562965 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562965 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562965 .task.clickable{cursor:pointer}#mermaid-1587905562965 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562965 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562965 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562965 .taskText0,#mermaid-1587905562965 .taskText1,#mermaid-1587905562965 .taskText2,#mermaid-1587905562965 .taskText3{fill:#fff}#mermaid-1587905562965 .task0,#mermaid-1587905562965 .task1,#mermaid-1587905562965 .task2,#mermaid-1587905562965 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562965 .taskTextOutside0,#mermaid-1587905562965 .taskTextOutside2{fill:#000}#mermaid-1587905562965 .taskTextOutside1,#mermaid-1587905562965 .taskTextOutside3{fill:#000}#mermaid-1587905562965 .active0,#mermaid-1587905562965 .active1,#mermaid-1587905562965 .active2,#mermaid-1587905562965 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562965 .activeText0,#mermaid-1587905562965 .activeText1,#mermaid-1587905562965 .activeText2,#mermaid-1587905562965 .activeText3{fill:#000 !important}#mermaid-1587905562965 .done0,#mermaid-1587905562965 .done1,#mermaid-1587905562965 .done2,#mermaid-1587905562965 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562965 .doneText0,#mermaid-1587905562965 .doneText1,#mermaid-1587905562965 .doneText2,#mermaid-1587905562965 .doneText3{fill:#000 !important}#mermaid-1587905562965 .crit0,#mermaid-1587905562965 .crit1,#mermaid-1587905562965 .crit2,#mermaid-1587905562965 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562965 .activeCrit0,#mermaid-1587905562965 .activeCrit1,#mermaid-1587905562965 .activeCrit2,#mermaid-1587905562965 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562965 .doneCrit0,#mermaid-1587905562965 .doneCrit1,#mermaid-1587905562965 .doneCrit2,#mermaid-1587905562965 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562965 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562965 .milestoneText{font-style:italic}#mermaid-1587905562965 .doneCritText0,#mermaid-1587905562965 .doneCritText1,#mermaid-1587905562965 .doneCritText2,#mermaid-1587905562965 .doneCritText3{fill:#000 !important}#mermaid-1587905562965 .activeCritText0,#mermaid-1587905562965 .activeCritText1,#mermaid-1587905562965 .activeCritText2,#mermaid-1587905562965 .activeCritText3{fill:#000 !important}#mermaid-1587905562965 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562965 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562965 g.clickable{cursor:pointer}#mermaid-1587905562965 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562965 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562965 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562965 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562965 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562965 .dashed-line{stroke-dasharray:3}#mermaid-1587905562965 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 .commit-id,#mermaid-1587905562965 .commit-msg,#mermaid-1587905562965 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562965 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562965 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562965 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562965 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562965 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562965 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562965 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562965 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562965 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562965 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562965 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;691&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;691&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;691&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;691&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;691&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor5&quot; x1=&quot;1075&quot; y1=&quot;5&quot; x2=&quot;1075&quot; y2=&quot;691&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1000&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;170&quot; x2=&quot;675&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;198&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;205&quot; x2=&quot;875&quot; y2=&quot;205&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;233&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Scheduled&lt;/text&gt;&lt;line x1=&quot;875&quot; y1=&quot;240&quot; x2=&quot;475&quot; y2=&quot;240&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;268&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;275&quot; x2=&quot;1075&quot; y2=&quot;275&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1070&quot; y=&quot;277&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;10&quot; height=&quot;200&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;activation0&quot;&gt;&lt;/rect&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;285&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;52&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;-4&quot; y=&quot;309&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;16&quot;&gt;After 5 seconds of &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;-4&quot; y=&quot;325&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;16&quot;&gt; waiting&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;365&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionTerminated&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;372&quot; x2=&quot;275&quot; y2=&quot;372&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;400&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionTerminated&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;407&quot; x2=&quot;475&quot; y2=&quot;407&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;435&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;442&quot; x2=&quot;275&quot; y2=&quot;442&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;772.5&quot; y=&quot;470&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Finished&lt;/text&gt;&lt;line x1=&quot;1070&quot; y1=&quot;477&quot; x2=&quot;475&quot; y2=&quot;477&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;505&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;512&quot; x2=&quot;475&quot; y2=&quot;512&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;522&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;84&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;396&quot; y=&quot;546&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;416&quot;&gt;Since the &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;396&quot; y=&quot;562&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;416&quot;&gt; orchestration is&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;396&quot; y=&quot;578&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;416&quot;&gt; already terminated &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;396&quot; y=&quot;594&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;416&quot;&gt; - No-Op&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;626&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;658.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;626&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;658.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;626&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;658.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;626&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;658.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;626&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;658.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1000&quot; y=&quot;626&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;658.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;So the terminate request is again sent as a message in the queue. The orchestrator gets the event and puts it in the session state.
Whenever the Hub receives an event, it checks its existing list of old events from the session state and builds up the current state.
So whenever the next set of TaskCompletion events, it will all result in a No-Op. The termination is asynchronous. There isn’t any facility to cancel ongoing TaskActivities, and only new ones will not be triggered.&lt;/p&gt;
&lt;h3&gt;Activity Middlewares&lt;/h3&gt;
&lt;p&gt;The DTF Framework supports middlewares for plugging into the Activity and Orchestration execution flow. They are pretty simple to solve it and works how you would expect any middlewares to work.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;hubWorker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddActivityDispatcherMiddleware&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; activity &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;GetProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;TaskActivity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;GetProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;OrchestrationInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Activity Details - &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; activity&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ToString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; Id = &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;InstanceId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The delegate that you pass to &lt;code class=&quot;language-text&quot;&gt;AddActivityDispatcherMiddleware&lt;/code&gt; is invoked just before the TaskActivity gets invoked&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562965&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:650px;&quot; viewBox=&quot;-50 -10 650 344&quot;&gt;&lt;style&gt;#mermaid-1587905562965 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562965 .label text{fill:#333}#mermaid-1587905562965 .node rect,#mermaid-1587905562965 .node circle,#mermaid-1587905562965 .node ellipse,#mermaid-1587905562965 .node polygon,#mermaid-1587905562965 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562965 .node .label{text-align:center}#mermaid-1587905562965 .node.clickable{cursor:pointer}#mermaid-1587905562965 .arrowheadPath{fill:#333}#mermaid-1587905562965 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562965 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562965 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562965 .cluster text{fill:#333}#mermaid-1587905562965 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562965 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562965 text.actor{fill:#000;stroke:none}#mermaid-1587905562965 .actor-line{stroke:grey}#mermaid-1587905562965 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562965 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562965 #arrowhead{fill:#333}#mermaid-1587905562965 .sequenceNumber{fill:#fff}#mermaid-1587905562965 #sequencenumber{fill:#333}#mermaid-1587905562965 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562965 .messageText{fill:#333;stroke:none}#mermaid-1587905562965 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562965 .labelText{fill:#000;stroke:none}#mermaid-1587905562965 .loopText{fill:#000;stroke:none}#mermaid-1587905562965 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562965 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562965 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562965 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562965 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562965 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562965 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .section{stroke:none;opacity:0.2}#mermaid-1587905562965 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562965 .section2{fill:#fff400}#mermaid-1587905562965 .section1,#mermaid-1587905562965 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562965 .sectionTitle0{fill:#333}#mermaid-1587905562965 .sectionTitle1{fill:#333}#mermaid-1587905562965 .sectionTitle2{fill:#333}#mermaid-1587905562965 .sectionTitle3{fill:#333}#mermaid-1587905562965 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562965 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .grid path{stroke-width:0}#mermaid-1587905562965 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562965 .task{stroke-width:2}#mermaid-1587905562965 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562965 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562965 .task.clickable{cursor:pointer}#mermaid-1587905562965 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562965 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562965 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562965 .taskText0,#mermaid-1587905562965 .taskText1,#mermaid-1587905562965 .taskText2,#mermaid-1587905562965 .taskText3{fill:#fff}#mermaid-1587905562965 .task0,#mermaid-1587905562965 .task1,#mermaid-1587905562965 .task2,#mermaid-1587905562965 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562965 .taskTextOutside0,#mermaid-1587905562965 .taskTextOutside2{fill:#000}#mermaid-1587905562965 .taskTextOutside1,#mermaid-1587905562965 .taskTextOutside3{fill:#000}#mermaid-1587905562965 .active0,#mermaid-1587905562965 .active1,#mermaid-1587905562965 .active2,#mermaid-1587905562965 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562965 .activeText0,#mermaid-1587905562965 .activeText1,#mermaid-1587905562965 .activeText2,#mermaid-1587905562965 .activeText3{fill:#000 !important}#mermaid-1587905562965 .done0,#mermaid-1587905562965 .done1,#mermaid-1587905562965 .done2,#mermaid-1587905562965 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562965 .doneText0,#mermaid-1587905562965 .doneText1,#mermaid-1587905562965 .doneText2,#mermaid-1587905562965 .doneText3{fill:#000 !important}#mermaid-1587905562965 .crit0,#mermaid-1587905562965 .crit1,#mermaid-1587905562965 .crit2,#mermaid-1587905562965 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562965 .activeCrit0,#mermaid-1587905562965 .activeCrit1,#mermaid-1587905562965 .activeCrit2,#mermaid-1587905562965 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562965 .doneCrit0,#mermaid-1587905562965 .doneCrit1,#mermaid-1587905562965 .doneCrit2,#mermaid-1587905562965 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562965 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562965 .milestoneText{font-style:italic}#mermaid-1587905562965 .doneCritText0,#mermaid-1587905562965 .doneCritText1,#mermaid-1587905562965 .doneCritText2,#mermaid-1587905562965 .doneCritText3{fill:#000 !important}#mermaid-1587905562965 .activeCritText0,#mermaid-1587905562965 .activeCritText1,#mermaid-1587905562965 .activeCritText2,#mermaid-1587905562965 .activeCritText3{fill:#000 !important}#mermaid-1587905562965 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562965 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562965 g.clickable{cursor:pointer}#mermaid-1587905562965 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562965 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562965 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562965 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562965 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562965 .dashed-line{stroke-dasharray:3}#mermaid-1587905562965 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562965 .commit-id,#mermaid-1587905562965 .commit-msg,#mermaid-1587905562965 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562965 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562965 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562965 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562965 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562965 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562965 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562965 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562965 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562965 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562965 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562965 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562965 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;333&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;333&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Middleware&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;333&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;75&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;68&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;-4&quot; y=&quot;99&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;16&quot;&gt;Hub receives &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;-4&quot; y=&quot;115&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;16&quot;&gt; the TaskScheduled &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;-4&quot; y=&quot;131&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;16&quot;&gt; event&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;171&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Middleware Invoked&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;178&quot; x2=&quot;275&quot; y2=&quot;178&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;206&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Middleware Execution Complete&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;213&quot; x2=&quot;75&quot; y2=&quot;213&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;275&quot; y=&quot;241&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Invoked&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;248&quot; x2=&quot;475&quot; y2=&quot;248&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;268&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;300.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;268&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;300.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Middleware&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;268&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;300.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;The middlewares get invoked in the same thread as Tasks, and they individually do not have any reliability. There is no state marker to show middleware was run successfully, but the Task failed. Middlewares get invoked for all tasks irrespective if the Task had failed in its previous run or not. It is agnostic to the Task triggering the middleware.&lt;/p&gt;
&lt;p&gt;Also, the middleware cannot be used to handle task failures. You cannot put a try-catch around the &lt;code class=&quot;language-text&quot;&gt;next()&lt;/code&gt; call. The Exceptions thrown by the Task are caught and swallowed by the framework in the &lt;em&gt;TaskActivityDispatcher&lt;/em&gt; part of the code, and the middlewares do not receive it.&lt;/p&gt;
&lt;h4&gt;Potential Gotcha!&lt;/h4&gt;
&lt;p&gt;Middlewares, if they fail, will fail the Task as well. Interestingly , such failures &lt;strong&gt;do not trigger the &lt;code class=&quot;language-text&quot;&gt;TaskFailed&lt;/code&gt; event&lt;/strong&gt;. But since the TaskScheduled message is not removed from the queue, the Hub keeps retrying and gives up when the limit is reached. Since the TaskFailed event was not generated, Azure Table Storage would also not show that the Task had failed. &lt;/p&gt;
&lt;p&gt;Here is an example when one task completes, and others fail due to a failure in the middleware. &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/91116b4a7188b097891bc8fc56884dd4/96658/TableStore.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+ElEQVQY002NTU4CQRCF57puDHHjDTyEpyCjiTsTVAwrB4IYEzNdXdXd8wcCbgRWz+p2MmHx8l79fZXdzn5x/XDC1f0Rl7nqrld+VueHvn8a5iPdvxgfcfN4QNOs0XRb1O03suKrwWzl8LxgPC0EL0unzpgUlPJkbjF990mxjv66Cpgufdoryg3mnxZvHwRT7ZE1dQUvDLEGjkmzhZBJipmpROUl5eh1cAiO4XS/1nrTtRBmkDH42SswhBrWMkqjH8gOuSzN0DPqLA7MonIpi/Np1nbr4Wa7i8CqgtUP8YgisM//MqlHRD1MIAqLAO9D8i4C+5udAv8ATixg3fcEHYUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Store&quot;
        title=&quot;Store&quot;
        src=&quot;/blog/static/91116b4a7188b097891bc8fc56884dd4/fcda8/TableStore.png&quot;
        srcset=&quot;/blog/static/91116b4a7188b097891bc8fc56884dd4/12f09/TableStore.png 148w,
/blog/static/91116b4a7188b097891bc8fc56884dd4/e4a3f/TableStore.png 295w,
/blog/static/91116b4a7188b097891bc8fc56884dd4/fcda8/TableStore.png 590w,
/blog/static/91116b4a7188b097891bc8fc56884dd4/96658/TableStore.png 881w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt; &lt;/p&gt;
&lt;p&gt;The store has all the data about &lt;em&gt;Task1&lt;/em&gt; till it was scheduled. One would be excused for thinking that &lt;em&gt;Task1&lt;/em&gt; was never picked up, and there is something wrong with DTF.&lt;/p&gt;
&lt;p&gt;What happened was, our middleware threw an exception when it was run in the context of &lt;em&gt;Task1&lt;/em&gt;, but in other cases, it passed. Hence there is no data for &lt;em&gt;Task1&lt;/em&gt; failing. This behavior is something to keep in mind when debugging the failures.&lt;/p&gt;
&lt;h3&gt;Orchestration Middlewares&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt; hubWorker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddOrchestrationDispatcherMiddleware&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; orchestration &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;GetProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;TaskOrchestration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;GetProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;OrchestrationRuntimeState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;GetProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;OrchestrationInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\n   orchestration Details - &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; orchestration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ToString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; Id = &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;InstanceId &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;state = &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Events&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Orchestration Middlewares work and behave the same way as the TaskActivity middlewares. The middleware gets invoked &lt;em&gt;each time&lt;/em&gt; the orchestration gets invoked. Similar to activity middlewares a try-catch would not be able to catch exceptions from Orchestrations.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)]]></title><description><![CDATA[Durable Task Framework Series This post is part 3 of a series of posts on DTF. Durable Task Framework Internals - Part 1 (Dataflow and…]]></description><link>https://abhikmitra.github.io/blog/durable-task-3/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/durable-task-3/</guid><pubDate>Sat, 25 Apr 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;Durable Task Framework Series&lt;/h3&gt;
&lt;p&gt;This post is &lt;strong&gt;part 3&lt;/strong&gt; of a series of posts on DTF.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task/&quot;&gt;Durable Task Framework Internals - Part 1 (Dataflow and Reliability)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-2/&quot;&gt;Durable Task Framework Internals - Part 2 (The curious case of Orchestrations)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-3/&quot;&gt;Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-4/&quot;&gt;Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp;#x26; Middlewares)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 5 (Interesting usages of TPL in DTF)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Do you think there is more that I should cover or something I should fix ? Please raise an &lt;a href=&quot;https://github.com/abhikmitra/blog/issues&quot;&gt;issue&lt;/a&gt; and let me know&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;The Tracker Queue&lt;/h3&gt;
&lt;p&gt;in Part 1, I had discussed that DTF creates three queues in Service Bus (&lt;code class=&quot;language-text&quot;&gt;Orchestrator&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Worker&lt;/code&gt; &amp;#x26;&lt;code class=&quot;language-text&quot;&gt;Tracking&lt;/code&gt;). In the last two sections, we discussed in-depth about how these Orchestrator and Worker help run tasks durably.&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;tracking&lt;/code&gt; queue is used for tracking events. In essence, you can disable the tracking queue, and the functionality would still work. Here is the sequence diagram of how various tracking messages are sent.&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562928&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1450px;&quot; viewBox=&quot;-50 -10 1450 1176&quot;&gt;&lt;style&gt;#mermaid-1587905562928 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562928 .label text{fill:#333}#mermaid-1587905562928 .node rect,#mermaid-1587905562928 .node circle,#mermaid-1587905562928 .node ellipse,#mermaid-1587905562928 .node polygon,#mermaid-1587905562928 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562928 .node .label{text-align:center}#mermaid-1587905562928 .node.clickable{cursor:pointer}#mermaid-1587905562928 .arrowheadPath{fill:#333}#mermaid-1587905562928 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562928 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562928 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562928 .cluster text{fill:#333}#mermaid-1587905562928 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562928 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562928 text.actor{fill:#000;stroke:none}#mermaid-1587905562928 .actor-line{stroke:grey}#mermaid-1587905562928 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562928 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562928 #arrowhead{fill:#333}#mermaid-1587905562928 .sequenceNumber{fill:#fff}#mermaid-1587905562928 #sequencenumber{fill:#333}#mermaid-1587905562928 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562928 .messageText{fill:#333;stroke:none}#mermaid-1587905562928 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562928 .labelText{fill:#000;stroke:none}#mermaid-1587905562928 .loopText{fill:#000;stroke:none}#mermaid-1587905562928 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562928 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562928 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562928 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .section{stroke:none;opacity:0.2}#mermaid-1587905562928 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562928 .section2{fill:#fff400}#mermaid-1587905562928 .section1,#mermaid-1587905562928 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562928 .sectionTitle0{fill:#333}#mermaid-1587905562928 .sectionTitle1{fill:#333}#mermaid-1587905562928 .sectionTitle2{fill:#333}#mermaid-1587905562928 .sectionTitle3{fill:#333}#mermaid-1587905562928 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562928 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .grid path{stroke-width:0}#mermaid-1587905562928 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562928 .task{stroke-width:2}#mermaid-1587905562928 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562928 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562928 .task.clickable{cursor:pointer}#mermaid-1587905562928 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskText0,#mermaid-1587905562928 .taskText1,#mermaid-1587905562928 .taskText2,#mermaid-1587905562928 .taskText3{fill:#fff}#mermaid-1587905562928 .task0,#mermaid-1587905562928 .task1,#mermaid-1587905562928 .task2,#mermaid-1587905562928 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562928 .taskTextOutside0,#mermaid-1587905562928 .taskTextOutside2{fill:#000}#mermaid-1587905562928 .taskTextOutside1,#mermaid-1587905562928 .taskTextOutside3{fill:#000}#mermaid-1587905562928 .active0,#mermaid-1587905562928 .active1,#mermaid-1587905562928 .active2,#mermaid-1587905562928 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562928 .activeText0,#mermaid-1587905562928 .activeText1,#mermaid-1587905562928 .activeText2,#mermaid-1587905562928 .activeText3{fill:#000 !important}#mermaid-1587905562928 .done0,#mermaid-1587905562928 .done1,#mermaid-1587905562928 .done2,#mermaid-1587905562928 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562928 .doneText0,#mermaid-1587905562928 .doneText1,#mermaid-1587905562928 .doneText2,#mermaid-1587905562928 .doneText3{fill:#000 !important}#mermaid-1587905562928 .crit0,#mermaid-1587905562928 .crit1,#mermaid-1587905562928 .crit2,#mermaid-1587905562928 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562928 .activeCrit0,#mermaid-1587905562928 .activeCrit1,#mermaid-1587905562928 .activeCrit2,#mermaid-1587905562928 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562928 .doneCrit0,#mermaid-1587905562928 .doneCrit1,#mermaid-1587905562928 .doneCrit2,#mermaid-1587905562928 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562928 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562928 .milestoneText{font-style:italic}#mermaid-1587905562928 .doneCritText0,#mermaid-1587905562928 .doneCritText1,#mermaid-1587905562928 .doneCritText2,#mermaid-1587905562928 .doneCritText3{fill:#000 !important}#mermaid-1587905562928 .activeCritText0,#mermaid-1587905562928 .activeCritText1,#mermaid-1587905562928 .activeCritText2,#mermaid-1587905562928 .activeCritText3{fill:#000 !important}#mermaid-1587905562928 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562928 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562928 g.clickable{cursor:pointer}#mermaid-1587905562928 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562928 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562928 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562928 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562928 .dashed-line{stroke-dasharray:3}#mermaid-1587905562928 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .commit-id,#mermaid-1587905562928 .commit-msg,#mermaid-1587905562928 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562928 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562928 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562928 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562928 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562928 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562928 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562928 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562928 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562928 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562928 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;1165&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;1165&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;1165&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;1165&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;1165&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor5&quot; x1=&quot;1075&quot; y1=&quot;5&quot; x2=&quot;1075&quot; y2=&quot;1165&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1000&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;Tracker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor6&quot; x1=&quot;1275&quot; y1=&quot;5&quot; x2=&quot;1275&quot; y2=&quot;1165&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1275&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;170&quot; x2=&quot;675&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;198&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Scheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;205&quot; x2=&quot;875&quot; y2=&quot;205&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;233&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OrchestratorStarted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;240&quot; x2=&quot;1075&quot; y2=&quot;240&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;268&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;275&quot; x2=&quot;1075&quot; y2=&quot;275&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;303&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;310&quot; x2=&quot;1075&quot; y2=&quot;310&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;338&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OrchestratorCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;345&quot; x2=&quot;1075&quot; y2=&quot;345&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;373&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;HistoryState&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;380&quot; x2=&quot;1075&quot; y2=&quot;380&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;408&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Scheduled&lt;/text&gt;&lt;line x1=&quot;875&quot; y1=&quot;415&quot; x2=&quot;475&quot; y2=&quot;415&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;875&quot; y=&quot;443&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;450&quot; x2=&quot;1275&quot; y2=&quot;450&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;478&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;485&quot; x2=&quot;275&quot; y2=&quot;485&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;513&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OrchestratorStarted&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;520&quot; x2=&quot;475&quot; y2=&quot;520&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;548&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;555&quot; x2=&quot;475&quot; y2=&quot;555&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;583&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;590&quot; x2=&quot;475&quot; y2=&quot;590&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;618&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OrchestratorCompleted&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;625&quot; x2=&quot;475&quot; y2=&quot;625&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;653&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;HistoryState&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;660&quot; x2=&quot;475&quot; y2=&quot;660&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;688&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;695&quot; x2=&quot;475&quot; y2=&quot;695&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;723&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked &amp;amp; Completed&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;730&quot; x2=&quot;675&quot; y2=&quot;730&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;758&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OrchestratorStarted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;765&quot; x2=&quot;1075&quot; y2=&quot;765&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;793&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;800&quot; x2=&quot;1075&quot; y2=&quot;800&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;828&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;835&quot; x2=&quot;1075&quot; y2=&quot;835&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;863&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OrchestratorCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;870&quot; x2=&quot;1075&quot; y2=&quot;870&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;898&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;HistoryState&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;905&quot; x2=&quot;1075&quot; y2=&quot;905&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;933&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OrchestratorStarted&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;940&quot; x2=&quot;475&quot; y2=&quot;940&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;968&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;975&quot; x2=&quot;475&quot; y2=&quot;975&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;1003&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionCompleted&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;1010&quot; x2=&quot;475&quot; y2=&quot;1010&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;1038&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;OrchestratorCompleted&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;1045&quot; x2=&quot;475&quot; y2=&quot;1045&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;1073&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;HistoryState&lt;/text&gt;&lt;line x1=&quot;1075&quot; y1=&quot;1080&quot; x2=&quot;475&quot; y2=&quot;1080&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;1100&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;1132.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;1100&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;1132.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;1100&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;1132.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;1100&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;1132.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;1100&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;1132.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1000&quot; y=&quot;1100&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;1132.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;Tracker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1200&quot; y=&quot;1100&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1275&quot; y=&quot;1132.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1275&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;When the Hub receives the event, it puts the state into Azure Storage for tracking what all the states that the orchestration passed through. You can objectively see how many times the orchestration was triggered and the time taken for each task to complete. Anyone using DTF in a non-trivial way would need Azure Tables for the telemetry it provides.&lt;/p&gt;
&lt;h3&gt;Azure Storage&lt;/h3&gt;
&lt;p&gt;Azure table store is entirely optional for DTF. If you do not pass the Azure Storage string, DTF will still work. In that case, DTF optimizes by not using the worker queue anymore, as the events put into the tracker queue are going to result in a No-Op.&lt;/p&gt;
&lt;p&gt;So when the framework boots up, there are 2 Tables created in Azure Table Store.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;InstanceHistory00&amp;#x3C;HubName&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This stores the history of all the states that your TaskActivities and Orchestration passed through.&lt;/li&gt;
&lt;li&gt;These are the same events that get queued in the tracker.&lt;/li&gt;
&lt;li&gt;There are timestamps and sequence numbers to reconstruct the chronology of the various state transitions.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;JumpStart00&amp;#x3C;HubName&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The Table is used for added reliability since there is a chance of Dual writes. We will go into the details of this one.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;The JumpStart Table&lt;/h3&gt;
&lt;p&gt;The table &lt;code class=&quot;language-text&quot;&gt;JumpStart00\&amp;lt;HubName\&amp;gt;&lt;/code&gt; is used for Jump starting orchestrations.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;When the Hub boots up, even before Client is started&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562928&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:450px;&quot; viewBox=&quot;-50 -10 450 231&quot;&gt;&lt;style&gt;#mermaid-1587905562928 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562928 .label text{fill:#333}#mermaid-1587905562928 .node rect,#mermaid-1587905562928 .node circle,#mermaid-1587905562928 .node ellipse,#mermaid-1587905562928 .node polygon,#mermaid-1587905562928 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562928 .node .label{text-align:center}#mermaid-1587905562928 .node.clickable{cursor:pointer}#mermaid-1587905562928 .arrowheadPath{fill:#333}#mermaid-1587905562928 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562928 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562928 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562928 .cluster text{fill:#333}#mermaid-1587905562928 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562928 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562928 text.actor{fill:#000;stroke:none}#mermaid-1587905562928 .actor-line{stroke:grey}#mermaid-1587905562928 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562928 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562928 #arrowhead{fill:#333}#mermaid-1587905562928 .sequenceNumber{fill:#fff}#mermaid-1587905562928 #sequencenumber{fill:#333}#mermaid-1587905562928 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562928 .messageText{fill:#333;stroke:none}#mermaid-1587905562928 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562928 .labelText{fill:#000;stroke:none}#mermaid-1587905562928 .loopText{fill:#000;stroke:none}#mermaid-1587905562928 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562928 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562928 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562928 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .section{stroke:none;opacity:0.2}#mermaid-1587905562928 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562928 .section2{fill:#fff400}#mermaid-1587905562928 .section1,#mermaid-1587905562928 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562928 .sectionTitle0{fill:#333}#mermaid-1587905562928 .sectionTitle1{fill:#333}#mermaid-1587905562928 .sectionTitle2{fill:#333}#mermaid-1587905562928 .sectionTitle3{fill:#333}#mermaid-1587905562928 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562928 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .grid path{stroke-width:0}#mermaid-1587905562928 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562928 .task{stroke-width:2}#mermaid-1587905562928 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562928 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562928 .task.clickable{cursor:pointer}#mermaid-1587905562928 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskText0,#mermaid-1587905562928 .taskText1,#mermaid-1587905562928 .taskText2,#mermaid-1587905562928 .taskText3{fill:#fff}#mermaid-1587905562928 .task0,#mermaid-1587905562928 .task1,#mermaid-1587905562928 .task2,#mermaid-1587905562928 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562928 .taskTextOutside0,#mermaid-1587905562928 .taskTextOutside2{fill:#000}#mermaid-1587905562928 .taskTextOutside1,#mermaid-1587905562928 .taskTextOutside3{fill:#000}#mermaid-1587905562928 .active0,#mermaid-1587905562928 .active1,#mermaid-1587905562928 .active2,#mermaid-1587905562928 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562928 .activeText0,#mermaid-1587905562928 .activeText1,#mermaid-1587905562928 .activeText2,#mermaid-1587905562928 .activeText3{fill:#000 !important}#mermaid-1587905562928 .done0,#mermaid-1587905562928 .done1,#mermaid-1587905562928 .done2,#mermaid-1587905562928 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562928 .doneText0,#mermaid-1587905562928 .doneText1,#mermaid-1587905562928 .doneText2,#mermaid-1587905562928 .doneText3{fill:#000 !important}#mermaid-1587905562928 .crit0,#mermaid-1587905562928 .crit1,#mermaid-1587905562928 .crit2,#mermaid-1587905562928 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562928 .activeCrit0,#mermaid-1587905562928 .activeCrit1,#mermaid-1587905562928 .activeCrit2,#mermaid-1587905562928 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562928 .doneCrit0,#mermaid-1587905562928 .doneCrit1,#mermaid-1587905562928 .doneCrit2,#mermaid-1587905562928 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562928 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562928 .milestoneText{font-style:italic}#mermaid-1587905562928 .doneCritText0,#mermaid-1587905562928 .doneCritText1,#mermaid-1587905562928 .doneCritText2,#mermaid-1587905562928 .doneCritText3{fill:#000 !important}#mermaid-1587905562928 .activeCritText0,#mermaid-1587905562928 .activeCritText1,#mermaid-1587905562928 .activeCritText2,#mermaid-1587905562928 .activeCritText3{fill:#000 !important}#mermaid-1587905562928 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562928 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562928 g.clickable{cursor:pointer}#mermaid-1587905562928 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562928 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562928 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562928 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562928 .dashed-line{stroke-dasharray:3}#mermaid-1587905562928 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .commit-id,#mermaid-1587905562928 .commit-msg,#mermaid-1587905562928 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562928 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562928 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562928 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562928 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562928 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562928 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562928 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562928 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562928 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562928 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;220&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;220&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;118&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;poll for entry in Table.&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;125&quot; x2=&quot;275&quot; y2=&quot;125&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;65&quot; y1=&quot;75&quot; x2=&quot;285&quot; y2=&quot;75&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;285&quot; y1=&quot;75&quot; x2=&quot;285&quot; y2=&quot;135&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;135&quot; x2=&quot;285&quot; y2=&quot;135&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;75&quot; x2=&quot;65&quot; y2=&quot;135&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;65,75 115,75 115,88 106.6,95 65,95&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;72.5&quot; y=&quot;90&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;72.5&quot;&gt;loop&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;175&quot; y=&quot;90&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;175&quot;&gt;[ Every 5 Seconds ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;155&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;187.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;155&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;187.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;When the &lt;strong&gt;Client&lt;/strong&gt; encounters &lt;code class=&quot;language-text&quot;&gt;CreateOrchestrationInstanceAsync&lt;/code&gt; and Azure Storage connection strings provided, here is the flow that takes place&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562931&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:650px;&quot; viewBox=&quot;-50 -10 650 231&quot;&gt;&lt;style&gt;#mermaid-1587905562931 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562931 .label text{fill:#333}#mermaid-1587905562931 .node rect,#mermaid-1587905562931 .node circle,#mermaid-1587905562931 .node ellipse,#mermaid-1587905562931 .node polygon,#mermaid-1587905562931 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562931 .node .label{text-align:center}#mermaid-1587905562931 .node.clickable{cursor:pointer}#mermaid-1587905562931 .arrowheadPath{fill:#333}#mermaid-1587905562931 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562931 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562931 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562931 .cluster text{fill:#333}#mermaid-1587905562931 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562931 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562931 text.actor{fill:#000;stroke:none}#mermaid-1587905562931 .actor-line{stroke:grey}#mermaid-1587905562931 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562931 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562931 #arrowhead{fill:#333}#mermaid-1587905562931 .sequenceNumber{fill:#fff}#mermaid-1587905562931 #sequencenumber{fill:#333}#mermaid-1587905562931 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562931 .messageText{fill:#333;stroke:none}#mermaid-1587905562931 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562931 .labelText{fill:#000;stroke:none}#mermaid-1587905562931 .loopText{fill:#000;stroke:none}#mermaid-1587905562931 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562931 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562931 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562931 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562931 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562931 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562931 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 .section{stroke:none;opacity:0.2}#mermaid-1587905562931 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562931 .section2{fill:#fff400}#mermaid-1587905562931 .section1,#mermaid-1587905562931 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562931 .sectionTitle0{fill:#333}#mermaid-1587905562931 .sectionTitle1{fill:#333}#mermaid-1587905562931 .sectionTitle2{fill:#333}#mermaid-1587905562931 .sectionTitle3{fill:#333}#mermaid-1587905562931 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562931 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 .grid path{stroke-width:0}#mermaid-1587905562931 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562931 .task{stroke-width:2}#mermaid-1587905562931 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562931 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562931 .task.clickable{cursor:pointer}#mermaid-1587905562931 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562931 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562931 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562931 .taskText0,#mermaid-1587905562931 .taskText1,#mermaid-1587905562931 .taskText2,#mermaid-1587905562931 .taskText3{fill:#fff}#mermaid-1587905562931 .task0,#mermaid-1587905562931 .task1,#mermaid-1587905562931 .task2,#mermaid-1587905562931 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562931 .taskTextOutside0,#mermaid-1587905562931 .taskTextOutside2{fill:#000}#mermaid-1587905562931 .taskTextOutside1,#mermaid-1587905562931 .taskTextOutside3{fill:#000}#mermaid-1587905562931 .active0,#mermaid-1587905562931 .active1,#mermaid-1587905562931 .active2,#mermaid-1587905562931 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562931 .activeText0,#mermaid-1587905562931 .activeText1,#mermaid-1587905562931 .activeText2,#mermaid-1587905562931 .activeText3{fill:#000 !important}#mermaid-1587905562931 .done0,#mermaid-1587905562931 .done1,#mermaid-1587905562931 .done2,#mermaid-1587905562931 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562931 .doneText0,#mermaid-1587905562931 .doneText1,#mermaid-1587905562931 .doneText2,#mermaid-1587905562931 .doneText3{fill:#000 !important}#mermaid-1587905562931 .crit0,#mermaid-1587905562931 .crit1,#mermaid-1587905562931 .crit2,#mermaid-1587905562931 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562931 .activeCrit0,#mermaid-1587905562931 .activeCrit1,#mermaid-1587905562931 .activeCrit2,#mermaid-1587905562931 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562931 .doneCrit0,#mermaid-1587905562931 .doneCrit1,#mermaid-1587905562931 .doneCrit2,#mermaid-1587905562931 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562931 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562931 .milestoneText{font-style:italic}#mermaid-1587905562931 .doneCritText0,#mermaid-1587905562931 .doneCritText1,#mermaid-1587905562931 .doneCritText2,#mermaid-1587905562931 .doneCritText3{fill:#000 !important}#mermaid-1587905562931 .activeCritText0,#mermaid-1587905562931 .activeCritText1,#mermaid-1587905562931 .activeCritText2,#mermaid-1587905562931 .activeCritText3{fill:#000 !important}#mermaid-1587905562931 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562931 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562931 g.clickable{cursor:pointer}#mermaid-1587905562931 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562931 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562931 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562931 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562931 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562931 .dashed-line{stroke-dasharray:3}#mermaid-1587905562931 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562931 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562931 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562931 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562931 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562931 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562931 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562931 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562931 .commit-id,#mermaid-1587905562931 .commit-msg,#mermaid-1587905562931 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562931 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562931 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562931 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562931 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562931 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562931 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562931 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562931 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562931 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562931 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562931 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562931 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;220&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;220&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;220&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Details&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;275&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;155&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;187.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;155&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;187.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;155&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;187.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;
&lt;p&gt;Now either of things can happen &lt;strong&gt;Hub&lt;/strong&gt; encounters &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Hub first gets the event from service bus, before it gets through polling&lt;/em&gt; -  When it gets an entity from Jumpstart during polling, it checks whether the Orchestration corresponding to that specific row in Jumpstart table has already been kicked off. The status of orchestration can be figured out by looking at the instanceHistory table. If it can find an entry in the instanceHistory table, then there is no use of Jumpstart, and hence the entity is deleted.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562928&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:850px;&quot; viewBox=&quot;-50 -10 850 398&quot;&gt;&lt;style&gt;#mermaid-1587905562928 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562928 .label text{fill:#333}#mermaid-1587905562928 .node rect,#mermaid-1587905562928 .node circle,#mermaid-1587905562928 .node ellipse,#mermaid-1587905562928 .node polygon,#mermaid-1587905562928 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562928 .node .label{text-align:center}#mermaid-1587905562928 .node.clickable{cursor:pointer}#mermaid-1587905562928 .arrowheadPath{fill:#333}#mermaid-1587905562928 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562928 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562928 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562928 .cluster text{fill:#333}#mermaid-1587905562928 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562928 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562928 text.actor{fill:#000;stroke:none}#mermaid-1587905562928 .actor-line{stroke:grey}#mermaid-1587905562928 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562928 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562928 #arrowhead{fill:#333}#mermaid-1587905562928 .sequenceNumber{fill:#fff}#mermaid-1587905562928 #sequencenumber{fill:#333}#mermaid-1587905562928 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562928 .messageText{fill:#333;stroke:none}#mermaid-1587905562928 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562928 .labelText{fill:#000;stroke:none}#mermaid-1587905562928 .loopText{fill:#000;stroke:none}#mermaid-1587905562928 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562928 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562928 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562928 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .section{stroke:none;opacity:0.2}#mermaid-1587905562928 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562928 .section2{fill:#fff400}#mermaid-1587905562928 .section1,#mermaid-1587905562928 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562928 .sectionTitle0{fill:#333}#mermaid-1587905562928 .sectionTitle1{fill:#333}#mermaid-1587905562928 .sectionTitle2{fill:#333}#mermaid-1587905562928 .sectionTitle3{fill:#333}#mermaid-1587905562928 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562928 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .grid path{stroke-width:0}#mermaid-1587905562928 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562928 .task{stroke-width:2}#mermaid-1587905562928 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562928 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562928 .task.clickable{cursor:pointer}#mermaid-1587905562928 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskText0,#mermaid-1587905562928 .taskText1,#mermaid-1587905562928 .taskText2,#mermaid-1587905562928 .taskText3{fill:#fff}#mermaid-1587905562928 .task0,#mermaid-1587905562928 .task1,#mermaid-1587905562928 .task2,#mermaid-1587905562928 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562928 .taskTextOutside0,#mermaid-1587905562928 .taskTextOutside2{fill:#000}#mermaid-1587905562928 .taskTextOutside1,#mermaid-1587905562928 .taskTextOutside3{fill:#000}#mermaid-1587905562928 .active0,#mermaid-1587905562928 .active1,#mermaid-1587905562928 .active2,#mermaid-1587905562928 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562928 .activeText0,#mermaid-1587905562928 .activeText1,#mermaid-1587905562928 .activeText2,#mermaid-1587905562928 .activeText3{fill:#000 !important}#mermaid-1587905562928 .done0,#mermaid-1587905562928 .done1,#mermaid-1587905562928 .done2,#mermaid-1587905562928 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562928 .doneText0,#mermaid-1587905562928 .doneText1,#mermaid-1587905562928 .doneText2,#mermaid-1587905562928 .doneText3{fill:#000 !important}#mermaid-1587905562928 .crit0,#mermaid-1587905562928 .crit1,#mermaid-1587905562928 .crit2,#mermaid-1587905562928 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562928 .activeCrit0,#mermaid-1587905562928 .activeCrit1,#mermaid-1587905562928 .activeCrit2,#mermaid-1587905562928 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562928 .doneCrit0,#mermaid-1587905562928 .doneCrit1,#mermaid-1587905562928 .doneCrit2,#mermaid-1587905562928 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562928 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562928 .milestoneText{font-style:italic}#mermaid-1587905562928 .doneCritText0,#mermaid-1587905562928 .doneCritText1,#mermaid-1587905562928 .doneCritText2,#mermaid-1587905562928 .doneCritText3{fill:#000 !important}#mermaid-1587905562928 .activeCritText0,#mermaid-1587905562928 .activeCritText1,#mermaid-1587905562928 .activeCritText2,#mermaid-1587905562928 .activeCritText3{fill:#000 !important}#mermaid-1587905562928 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562928 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562928 g.clickable{cursor:pointer}#mermaid-1587905562928 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562928 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562928 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562928 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562928 .dashed-line{stroke-dasharray:3}#mermaid-1587905562928 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .commit-id,#mermaid-1587905562928 .commit-msg,#mermaid-1587905562928 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562928 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562928 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562928 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562928 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562928 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562928 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562928 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562928 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562928 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562928 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;387&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Orchestrator Queue&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;387&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;387&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;387&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;InstanceHistory Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;50&quot; y=&quot;110&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;250&quot; height=&quot;52&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;46&quot; y=&quot;134&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;66&quot;&gt;The normal Orchestration &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;46&quot; y=&quot;150&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;66&quot;&gt; process kicks off&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;215&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Finds an entry&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;222&quot; x2=&quot;475&quot; y2=&quot;222&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;265&quot; y1=&quot;172&quot; x2=&quot;485&quot; y2=&quot;172&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;485&quot; y1=&quot;172&quot; x2=&quot;485&quot; y2=&quot;232&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;265&quot; y1=&quot;232&quot; x2=&quot;485&quot; y2=&quot;232&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;265&quot; y1=&quot;172&quot; x2=&quot;265&quot; y2=&quot;232&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;265,172 315,172 315,185 306.6,192 265,192&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;272.5&quot; y=&quot;187&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;272.5&quot;&gt;loop&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;375&quot; y=&quot;187&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;375&quot;&gt;[ Every 5 Seconds ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;475&quot; y=&quot;260&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Checks if the Orchestration corresponding to the entry is present&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;267&quot; x2=&quot;675&quot; y2=&quot;267&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;295&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Deletes the entry&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;302&quot; x2=&quot;475&quot; y2=&quot;302&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;322&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;354.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Orchestrator Queue&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;322&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;354.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;322&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;354.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;322&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;354.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;InstanceHistory Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Hub first gets the event from polling, before it gets through Service Bus&lt;/em&gt; - When it gets an entity from the Table, it first checks if there is a corresponding entry in instanceHistory table, which would mean that Hub has received the orchestration signal from Service Bus. But in this case, it would not be able to find it, so it checks the time in which the Client triggered the orchestration. If 10 minutes have not passed, it will ignore the entity, but &lt;strong&gt;will not delete it&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562928&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:850px;&quot; viewBox=&quot;-50 -10 850 511&quot;&gt;&lt;style&gt;#mermaid-1587905562928 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562928 .label text{fill:#333}#mermaid-1587905562928 .node rect,#mermaid-1587905562928 .node circle,#mermaid-1587905562928 .node ellipse,#mermaid-1587905562928 .node polygon,#mermaid-1587905562928 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562928 .node .label{text-align:center}#mermaid-1587905562928 .node.clickable{cursor:pointer}#mermaid-1587905562928 .arrowheadPath{fill:#333}#mermaid-1587905562928 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562928 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562928 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562928 .cluster text{fill:#333}#mermaid-1587905562928 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562928 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562928 text.actor{fill:#000;stroke:none}#mermaid-1587905562928 .actor-line{stroke:grey}#mermaid-1587905562928 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562928 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562928 #arrowhead{fill:#333}#mermaid-1587905562928 .sequenceNumber{fill:#fff}#mermaid-1587905562928 #sequencenumber{fill:#333}#mermaid-1587905562928 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562928 .messageText{fill:#333;stroke:none}#mermaid-1587905562928 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562928 .labelText{fill:#000;stroke:none}#mermaid-1587905562928 .loopText{fill:#000;stroke:none}#mermaid-1587905562928 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562928 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562928 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562928 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562928 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .section{stroke:none;opacity:0.2}#mermaid-1587905562928 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562928 .section2{fill:#fff400}#mermaid-1587905562928 .section1,#mermaid-1587905562928 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562928 .sectionTitle0{fill:#333}#mermaid-1587905562928 .sectionTitle1{fill:#333}#mermaid-1587905562928 .sectionTitle2{fill:#333}#mermaid-1587905562928 .sectionTitle3{fill:#333}#mermaid-1587905562928 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562928 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .grid path{stroke-width:0}#mermaid-1587905562928 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562928 .task{stroke-width:2}#mermaid-1587905562928 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562928 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562928 .task.clickable{cursor:pointer}#mermaid-1587905562928 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562928 .taskText0,#mermaid-1587905562928 .taskText1,#mermaid-1587905562928 .taskText2,#mermaid-1587905562928 .taskText3{fill:#fff}#mermaid-1587905562928 .task0,#mermaid-1587905562928 .task1,#mermaid-1587905562928 .task2,#mermaid-1587905562928 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562928 .taskTextOutside0,#mermaid-1587905562928 .taskTextOutside2{fill:#000}#mermaid-1587905562928 .taskTextOutside1,#mermaid-1587905562928 .taskTextOutside3{fill:#000}#mermaid-1587905562928 .active0,#mermaid-1587905562928 .active1,#mermaid-1587905562928 .active2,#mermaid-1587905562928 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562928 .activeText0,#mermaid-1587905562928 .activeText1,#mermaid-1587905562928 .activeText2,#mermaid-1587905562928 .activeText3{fill:#000 !important}#mermaid-1587905562928 .done0,#mermaid-1587905562928 .done1,#mermaid-1587905562928 .done2,#mermaid-1587905562928 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562928 .doneText0,#mermaid-1587905562928 .doneText1,#mermaid-1587905562928 .doneText2,#mermaid-1587905562928 .doneText3{fill:#000 !important}#mermaid-1587905562928 .crit0,#mermaid-1587905562928 .crit1,#mermaid-1587905562928 .crit2,#mermaid-1587905562928 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562928 .activeCrit0,#mermaid-1587905562928 .activeCrit1,#mermaid-1587905562928 .activeCrit2,#mermaid-1587905562928 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562928 .doneCrit0,#mermaid-1587905562928 .doneCrit1,#mermaid-1587905562928 .doneCrit2,#mermaid-1587905562928 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562928 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562928 .milestoneText{font-style:italic}#mermaid-1587905562928 .doneCritText0,#mermaid-1587905562928 .doneCritText1,#mermaid-1587905562928 .doneCritText2,#mermaid-1587905562928 .doneCritText3{fill:#000 !important}#mermaid-1587905562928 .activeCritText0,#mermaid-1587905562928 .activeCritText1,#mermaid-1587905562928 .activeCritText2,#mermaid-1587905562928 .activeCritText3{fill:#000 !important}#mermaid-1587905562928 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562928 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562928 g.clickable{cursor:pointer}#mermaid-1587905562928 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562928 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562928 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562928 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562928 .dashed-line{stroke-dasharray:3}#mermaid-1587905562928 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .commit-id,#mermaid-1587905562928 .commit-msg,#mermaid-1587905562928 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562928 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562928 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562928 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562928 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562928 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562928 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562928 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562928 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562928 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562928 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562928 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562928 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;500&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;500&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;500&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;InstanceHistory Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;500&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;Orchestrator Queue&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;118&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Finds an entry&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;125&quot; x2=&quot;275&quot; y2=&quot;125&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;275&quot; y=&quot;153&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Checks if the Orchestration corresponding to the entry is present&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;160&quot; x2=&quot;475&quot; y2=&quot;160&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;188&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;If currentTime - startTime &amp;lt; 10 minutes , no op.&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;195&quot; x2=&quot;275&quot; y2=&quot;195&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;65&quot; y1=&quot;75&quot; x2=&quot;485&quot; y2=&quot;75&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;485&quot; y1=&quot;75&quot; x2=&quot;485&quot; y2=&quot;205&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;205&quot; x2=&quot;485&quot; y2=&quot;205&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;75&quot; x2=&quot;65&quot; y2=&quot;205&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;65,75 115,75 115,88 106.6,95 65,95&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;72.5&quot; y=&quot;90&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;72.5&quot;&gt;loop&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;275&quot; y=&quot;90&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;275&quot;&gt;[ Every 5 Seconds ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;50&quot; y=&quot;215&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;250&quot; height=&quot;68&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;46&quot; y=&quot;239&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;66&quot;&gt;Within 10 minutes , we will &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;46&quot; y=&quot;255&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;66&quot;&gt; definitely receive the message from &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;46&quot; y=&quot;271&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;66&quot;&gt; the queue&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;311&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;675&quot; y1=&quot;318&quot; x2=&quot;75&quot; y2=&quot;318&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;50&quot; y=&quot;328&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;650&quot; height=&quot;52&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;46&quot; y=&quot;352&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;66&quot;&gt;The normal Orchestration &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;46&quot; y=&quot;368&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;66&quot;&gt; process kicks off&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;408&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Deletes the entry&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;415&quot; x2=&quot;275&quot; y2=&quot;415&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;435&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;467.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;435&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;467.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;435&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;467.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;InstanceHistory Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;435&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;467.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;Orchestrator Queue&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Now lets look at the case where queing to Service bus fails from the client.&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562929&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:650px;&quot; viewBox=&quot;-50 -10 650 231&quot;&gt;&lt;style&gt;#mermaid-1587905562929 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562929 .label text{fill:#333}#mermaid-1587905562929 .node rect,#mermaid-1587905562929 .node circle,#mermaid-1587905562929 .node ellipse,#mermaid-1587905562929 .node polygon,#mermaid-1587905562929 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562929 .node .label{text-align:center}#mermaid-1587905562929 .node.clickable{cursor:pointer}#mermaid-1587905562929 .arrowheadPath{fill:#333}#mermaid-1587905562929 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562929 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562929 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562929 .cluster text{fill:#333}#mermaid-1587905562929 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562929 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562929 text.actor{fill:#000;stroke:none}#mermaid-1587905562929 .actor-line{stroke:grey}#mermaid-1587905562929 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562929 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562929 #arrowhead{fill:#333}#mermaid-1587905562929 .sequenceNumber{fill:#fff}#mermaid-1587905562929 #sequencenumber{fill:#333}#mermaid-1587905562929 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562929 .messageText{fill:#333;stroke:none}#mermaid-1587905562929 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562929 .labelText{fill:#000;stroke:none}#mermaid-1587905562929 .loopText{fill:#000;stroke:none}#mermaid-1587905562929 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562929 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562929 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562929 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562929 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562929 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562929 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 .section{stroke:none;opacity:0.2}#mermaid-1587905562929 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562929 .section2{fill:#fff400}#mermaid-1587905562929 .section1,#mermaid-1587905562929 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562929 .sectionTitle0{fill:#333}#mermaid-1587905562929 .sectionTitle1{fill:#333}#mermaid-1587905562929 .sectionTitle2{fill:#333}#mermaid-1587905562929 .sectionTitle3{fill:#333}#mermaid-1587905562929 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562929 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 .grid path{stroke-width:0}#mermaid-1587905562929 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562929 .task{stroke-width:2}#mermaid-1587905562929 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562929 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562929 .task.clickable{cursor:pointer}#mermaid-1587905562929 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562929 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562929 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562929 .taskText0,#mermaid-1587905562929 .taskText1,#mermaid-1587905562929 .taskText2,#mermaid-1587905562929 .taskText3{fill:#fff}#mermaid-1587905562929 .task0,#mermaid-1587905562929 .task1,#mermaid-1587905562929 .task2,#mermaid-1587905562929 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562929 .taskTextOutside0,#mermaid-1587905562929 .taskTextOutside2{fill:#000}#mermaid-1587905562929 .taskTextOutside1,#mermaid-1587905562929 .taskTextOutside3{fill:#000}#mermaid-1587905562929 .active0,#mermaid-1587905562929 .active1,#mermaid-1587905562929 .active2,#mermaid-1587905562929 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562929 .activeText0,#mermaid-1587905562929 .activeText1,#mermaid-1587905562929 .activeText2,#mermaid-1587905562929 .activeText3{fill:#000 !important}#mermaid-1587905562929 .done0,#mermaid-1587905562929 .done1,#mermaid-1587905562929 .done2,#mermaid-1587905562929 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562929 .doneText0,#mermaid-1587905562929 .doneText1,#mermaid-1587905562929 .doneText2,#mermaid-1587905562929 .doneText3{fill:#000 !important}#mermaid-1587905562929 .crit0,#mermaid-1587905562929 .crit1,#mermaid-1587905562929 .crit2,#mermaid-1587905562929 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562929 .activeCrit0,#mermaid-1587905562929 .activeCrit1,#mermaid-1587905562929 .activeCrit2,#mermaid-1587905562929 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562929 .doneCrit0,#mermaid-1587905562929 .doneCrit1,#mermaid-1587905562929 .doneCrit2,#mermaid-1587905562929 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562929 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562929 .milestoneText{font-style:italic}#mermaid-1587905562929 .doneCritText0,#mermaid-1587905562929 .doneCritText1,#mermaid-1587905562929 .doneCritText2,#mermaid-1587905562929 .doneCritText3{fill:#000 !important}#mermaid-1587905562929 .activeCritText0,#mermaid-1587905562929 .activeCritText1,#mermaid-1587905562929 .activeCritText2,#mermaid-1587905562929 .activeCritText3{fill:#000 !important}#mermaid-1587905562929 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562929 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562929 g.clickable{cursor:pointer}#mermaid-1587905562929 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562929 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562929 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562929 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562929 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562929 .dashed-line{stroke-dasharray:3}#mermaid-1587905562929 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562929 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562929 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562929 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562929 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562929 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562929 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562929 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562929 .commit-id,#mermaid-1587905562929 .commit-msg,#mermaid-1587905562929 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562929 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562929 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562929 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562929 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562929 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562929 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562929 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562929 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562929 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562929 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562929 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562929 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;220&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;220&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;220&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Details&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;275&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Message Queuing failed&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#crosshead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;155&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;187.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;155&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;187.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;155&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;187.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;Now, this might happen for a variety of reason, it could be a transient error, or the Client might have encountered an exception which caused the app to close. In a distributed system, it’s expected some nodes might go down.&lt;/p&gt;
&lt;p&gt;When this happens, DTF is an inconsistent state as the JumpStart Table indicates that a task has been scheduled, but in reality, the message to the Service bus has failed. This is a common problem with Distributed Systems and is called the &lt;a href=&quot;https://thoughts-on-java.org/dual-writes/&quot;&gt;Dual Writes&lt;/a&gt; issue. DUal writes leave you with a system with an inconsistent system.&lt;/p&gt;
&lt;p&gt;Thankfully when this happens, the jump start polling comes to the rescue.&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562930&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:850px;&quot; viewBox=&quot;-50 -10 850 592&quot;&gt;&lt;style&gt;#mermaid-1587905562930 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562930 .label text{fill:#333}#mermaid-1587905562930 .node rect,#mermaid-1587905562930 .node circle,#mermaid-1587905562930 .node ellipse,#mermaid-1587905562930 .node polygon,#mermaid-1587905562930 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562930 .node .label{text-align:center}#mermaid-1587905562930 .node.clickable{cursor:pointer}#mermaid-1587905562930 .arrowheadPath{fill:#333}#mermaid-1587905562930 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562930 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562930 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562930 .cluster text{fill:#333}#mermaid-1587905562930 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562930 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562930 text.actor{fill:#000;stroke:none}#mermaid-1587905562930 .actor-line{stroke:grey}#mermaid-1587905562930 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562930 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562930 #arrowhead{fill:#333}#mermaid-1587905562930 .sequenceNumber{fill:#fff}#mermaid-1587905562930 #sequencenumber{fill:#333}#mermaid-1587905562930 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562930 .messageText{fill:#333;stroke:none}#mermaid-1587905562930 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562930 .labelText{fill:#000;stroke:none}#mermaid-1587905562930 .loopText{fill:#000;stroke:none}#mermaid-1587905562930 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562930 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562930 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562930 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562930 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562930 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562930 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 .section{stroke:none;opacity:0.2}#mermaid-1587905562930 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562930 .section2{fill:#fff400}#mermaid-1587905562930 .section1,#mermaid-1587905562930 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562930 .sectionTitle0{fill:#333}#mermaid-1587905562930 .sectionTitle1{fill:#333}#mermaid-1587905562930 .sectionTitle2{fill:#333}#mermaid-1587905562930 .sectionTitle3{fill:#333}#mermaid-1587905562930 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562930 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 .grid path{stroke-width:0}#mermaid-1587905562930 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562930 .task{stroke-width:2}#mermaid-1587905562930 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562930 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562930 .task.clickable{cursor:pointer}#mermaid-1587905562930 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562930 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562930 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562930 .taskText0,#mermaid-1587905562930 .taskText1,#mermaid-1587905562930 .taskText2,#mermaid-1587905562930 .taskText3{fill:#fff}#mermaid-1587905562930 .task0,#mermaid-1587905562930 .task1,#mermaid-1587905562930 .task2,#mermaid-1587905562930 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562930 .taskTextOutside0,#mermaid-1587905562930 .taskTextOutside2{fill:#000}#mermaid-1587905562930 .taskTextOutside1,#mermaid-1587905562930 .taskTextOutside3{fill:#000}#mermaid-1587905562930 .active0,#mermaid-1587905562930 .active1,#mermaid-1587905562930 .active2,#mermaid-1587905562930 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562930 .activeText0,#mermaid-1587905562930 .activeText1,#mermaid-1587905562930 .activeText2,#mermaid-1587905562930 .activeText3{fill:#000 !important}#mermaid-1587905562930 .done0,#mermaid-1587905562930 .done1,#mermaid-1587905562930 .done2,#mermaid-1587905562930 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562930 .doneText0,#mermaid-1587905562930 .doneText1,#mermaid-1587905562930 .doneText2,#mermaid-1587905562930 .doneText3{fill:#000 !important}#mermaid-1587905562930 .crit0,#mermaid-1587905562930 .crit1,#mermaid-1587905562930 .crit2,#mermaid-1587905562930 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562930 .activeCrit0,#mermaid-1587905562930 .activeCrit1,#mermaid-1587905562930 .activeCrit2,#mermaid-1587905562930 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562930 .doneCrit0,#mermaid-1587905562930 .doneCrit1,#mermaid-1587905562930 .doneCrit2,#mermaid-1587905562930 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562930 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562930 .milestoneText{font-style:italic}#mermaid-1587905562930 .doneCritText0,#mermaid-1587905562930 .doneCritText1,#mermaid-1587905562930 .doneCritText2,#mermaid-1587905562930 .doneCritText3{fill:#000 !important}#mermaid-1587905562930 .activeCritText0,#mermaid-1587905562930 .activeCritText1,#mermaid-1587905562930 .activeCritText2,#mermaid-1587905562930 .activeCritText3{fill:#000 !important}#mermaid-1587905562930 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562930 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562930 g.clickable{cursor:pointer}#mermaid-1587905562930 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562930 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562930 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562930 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562930 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562930 .dashed-line{stroke-dasharray:3}#mermaid-1587905562930 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562930 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562930 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562930 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562930 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562930 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562930 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562930 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562930 .commit-id,#mermaid-1587905562930 .commit-msg,#mermaid-1587905562930 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562930 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562930 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562930 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562930 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562930 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562930 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562930 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562930 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562930 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562930 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562930 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562930 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;581&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;581&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;581&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;InstanceHistory Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;581&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;118&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Finds an entry&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;125&quot; x2=&quot;275&quot; y2=&quot;125&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;275&quot; y=&quot;153&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Checks if the Orchestration corresponding to the entry is present&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;160&quot; x2=&quot;475&quot; y2=&quot;160&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;188&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;If currentTime - startTime &amp;lt; 10 minutes , no-op.&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;195&quot; x2=&quot;275&quot; y2=&quot;195&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;line x1=&quot;65&quot; y1=&quot;75&quot; x2=&quot;485&quot; y2=&quot;75&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;485&quot; y1=&quot;75&quot; x2=&quot;485&quot; y2=&quot;205&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;205&quot; x2=&quot;485&quot; y2=&quot;205&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;line x1=&quot;65&quot; y1=&quot;75&quot; x2=&quot;65&quot; y2=&quot;205&quot; class=&quot;loopLine&quot;&gt;&lt;/line&gt;&lt;polygon points=&quot;65,75 115,75 115,88 106.6,95 65,95&quot; class=&quot;labelBox&quot;&gt;&lt;/polygon&gt;&lt;text x=&quot;72.5&quot; y=&quot;90&quot; class=&quot;labelText&quot;&gt;&lt;tspan x=&quot;72.5&quot;&gt;loop&lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;275&quot; y=&quot;90&quot; class=&quot;loopText&quot; style=&quot;text-anchor: middle;&quot;&gt;&lt;tspan x=&quot;275&quot;&gt;[ Every 5 Seconds ]&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;50&quot; y=&quot;215&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;250&quot; height=&quot;36&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;46&quot; y=&quot;239&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;66&quot;&gt;After 10 minutes of waiting&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;279&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Gets the entry from the jump start table &amp;amp; creates the message&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;286&quot; x2=&quot;275&quot; y2=&quot;286&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;314&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;321&quot; x2=&quot;675&quot; y2=&quot;321&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;349&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Updates the entity with the new timestamp&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;356&quot; x2=&quot;275&quot; y2=&quot;356&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;384&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;675&quot; y1=&quot;391&quot; x2=&quot;75&quot; y2=&quot;391&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;419&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Finds an entry&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;426&quot; x2=&quot;275&quot; y2=&quot;426&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;275&quot; y=&quot;454&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Checks if the Orchestration corresponding to the entry is present&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;461&quot; x2=&quot;475&quot; y2=&quot;461&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;489&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Deletes the entry&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;496&quot; x2=&quot;275&quot; y2=&quot;496&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;516&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;548.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;516&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;548.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;JumpStart Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;516&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;548.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;InstanceHistory Table&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;516&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;548.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;p&gt;The Hub looks for situations where the entity is present in the Jump Start table but has not arrived through Service Bus for 10 minutes. Then it queues the ExecutionStarted event itself. It keeps repeating this process and trying to jump-start the orchestration until it finds the orchestration in the instanceHistory table&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;The jump start is not a replacement for the Service Bus. It is only protecting against the dual write situation by becoming eventually consistent in case of a failure. Of course, you only have this problem when instance tracking is enabled. If you do not have an Azure Table storage , then you would not run into the Dual Write scenarios at all.&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Durable Task Framework Internals - Part 2 (The curious case of Orchestrations)]]></title><description><![CDATA[Durable Task Framework Series This post is part 2 of a series of posts on DTF. Durable Task Framework Internals - Part 1 (Dataflow and…]]></description><link>https://abhikmitra.github.io/blog/durable-task-2/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/durable-task-2/</guid><pubDate>Fri, 24 Apr 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;Durable Task Framework Series&lt;/h3&gt;
&lt;p&gt;This post is &lt;strong&gt;part 2&lt;/strong&gt; of a series of posts on DTF.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task/&quot;&gt;Durable Task Framework Internals - Part 1 (Dataflow and Reliability)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-2/&quot;&gt;Durable Task Framework Internals - Part 2 (The curious case of Orchestrations)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-3/&quot;&gt;Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-4/&quot;&gt;Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp;#x26; Middlewares)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 5 (Interesting usages of TPL in DTF)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Do you think there is more that I should cover or something I should fix ? Please raise an &lt;a href=&quot;https://github.com/abhikmitra/blog/issues&quot;&gt;issue&lt;/a&gt; and let me know&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Multi Activity Orchestrations&lt;/h3&gt;
&lt;p&gt;We will see whats the process of  Orchestration in case of multiple activities as that’s what you will frequently have.&lt;/p&gt;
&lt;p&gt;Here is a sequence diagram of the happy path with an orchestration comprising of two activitties &lt;code class=&quot;language-text&quot;&gt;TaskActivity1&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;TaskActivity2&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1590339706798&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1450px;&quot; viewBox=&quot;-50 -10 1450 881&quot;&gt;&lt;rect x=&quot;465&quot; y=&quot;695&quot; fill=&quot;rgb(255, 255, 0, 0.5)&quot; width=&quot;220&quot; height=&quot;55&quot; class=&quot;rect&quot;&gt;&lt;/rect&gt;&lt;rect x=&quot;465&quot; y=&quot;525&quot; fill=&quot;rgb(255, 255, 0, 0.5)&quot; width=&quot;220&quot; height=&quot;55&quot; class=&quot;rect&quot;&gt;&lt;/rect&gt;&lt;rect x=&quot;465&quot; y=&quot;145&quot; fill=&quot;rgb(255, 255, 0, 0.5)&quot; width=&quot;220&quot; height=&quot;55&quot; class=&quot;rect&quot;&gt;&lt;/rect&gt;&lt;style&gt;#mermaid-1590339706798 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590339706798 .label text{fill:#333}#mermaid-1590339706798 .node rect,#mermaid-1590339706798 .node circle,#mermaid-1590339706798 .node ellipse,#mermaid-1590339706798 .node polygon,#mermaid-1590339706798 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590339706798 .node .label{text-align:center}#mermaid-1590339706798 .node.clickable{cursor:pointer}#mermaid-1590339706798 .arrowheadPath{fill:#333}#mermaid-1590339706798 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590339706798 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590339706798 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590339706798 .cluster text{fill:#333}#mermaid-1590339706798 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590339706798 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590339706798 text.actor{fill:#000;stroke:none}#mermaid-1590339706798 .actor-line{stroke:grey}#mermaid-1590339706798 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590339706798 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1590339706798 #arrowhead{fill:#333}#mermaid-1590339706798 .sequenceNumber{fill:#fff}#mermaid-1590339706798 #sequencenumber{fill:#333}#mermaid-1590339706798 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590339706798 .messageText{fill:#333;stroke:none}#mermaid-1590339706798 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590339706798 .labelText{fill:#000;stroke:none}#mermaid-1590339706798 .loopText{fill:#000;stroke:none}#mermaid-1590339706798 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1590339706798 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590339706798 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590339706798 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590339706798 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590339706798 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590339706798 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 .section{stroke:none;opacity:0.2}#mermaid-1590339706798 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590339706798 .section2{fill:#fff400}#mermaid-1590339706798 .section1,#mermaid-1590339706798 .section3{fill:#fff;opacity:0.2}#mermaid-1590339706798 .sectionTitle0{fill:#333}#mermaid-1590339706798 .sectionTitle1{fill:#333}#mermaid-1590339706798 .sectionTitle2{fill:#333}#mermaid-1590339706798 .sectionTitle3{fill:#333}#mermaid-1590339706798 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590339706798 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 .grid path{stroke-width:0}#mermaid-1590339706798 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590339706798 .task{stroke-width:2}#mermaid-1590339706798 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 .taskText:not([font-size]){font-size:11px}#mermaid-1590339706798 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590339706798 .task.clickable{cursor:pointer}#mermaid-1590339706798 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590339706798 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590339706798 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590339706798 .taskText0,#mermaid-1590339706798 .taskText1,#mermaid-1590339706798 .taskText2,#mermaid-1590339706798 .taskText3{fill:#fff}#mermaid-1590339706798 .task0,#mermaid-1590339706798 .task1,#mermaid-1590339706798 .task2,#mermaid-1590339706798 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590339706798 .taskTextOutside0,#mermaid-1590339706798 .taskTextOutside2{fill:#000}#mermaid-1590339706798 .taskTextOutside1,#mermaid-1590339706798 .taskTextOutside3{fill:#000}#mermaid-1590339706798 .active0,#mermaid-1590339706798 .active1,#mermaid-1590339706798 .active2,#mermaid-1590339706798 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590339706798 .activeText0,#mermaid-1590339706798 .activeText1,#mermaid-1590339706798 .activeText2,#mermaid-1590339706798 .activeText3{fill:#000 !important}#mermaid-1590339706798 .done0,#mermaid-1590339706798 .done1,#mermaid-1590339706798 .done2,#mermaid-1590339706798 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590339706798 .doneText0,#mermaid-1590339706798 .doneText1,#mermaid-1590339706798 .doneText2,#mermaid-1590339706798 .doneText3{fill:#000 !important}#mermaid-1590339706798 .crit0,#mermaid-1590339706798 .crit1,#mermaid-1590339706798 .crit2,#mermaid-1590339706798 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590339706798 .activeCrit0,#mermaid-1590339706798 .activeCrit1,#mermaid-1590339706798 .activeCrit2,#mermaid-1590339706798 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590339706798 .doneCrit0,#mermaid-1590339706798 .doneCrit1,#mermaid-1590339706798 .doneCrit2,#mermaid-1590339706798 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590339706798 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590339706798 .milestoneText{font-style:italic}#mermaid-1590339706798 .doneCritText0,#mermaid-1590339706798 .doneCritText1,#mermaid-1590339706798 .doneCritText2,#mermaid-1590339706798 .doneCritText3{fill:#000 !important}#mermaid-1590339706798 .activeCritText0,#mermaid-1590339706798 .activeCritText1,#mermaid-1590339706798 .activeCritText2,#mermaid-1590339706798 .activeCritText3{fill:#000 !important}#mermaid-1590339706798 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590339706798 g.classGroup text .title{font-weight:bolder}#mermaid-1590339706798 g.clickable{cursor:pointer}#mermaid-1590339706798 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590339706798 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590339706798 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590339706798 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590339706798 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590339706798 .dashed-line{stroke-dasharray:3}#mermaid-1590339706798 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590339706798 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590339706798 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590339706798 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590339706798 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590339706798 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590339706798 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590339706798 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590339706798 .commit-id,#mermaid-1590339706798 .commit-msg,#mermaid-1590339706798 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590339706798 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590339706798 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590339706798 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590339706798 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590339706798 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590339706798 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590339706798 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590339706798 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590339706798 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590339706798 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590339706798 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1590339706798 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;870&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;870&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;870&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;870&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;870&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor5&quot; x1=&quot;1075&quot; y1=&quot;5&quot; x2=&quot;1075&quot; y2=&quot;870&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1000&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity1&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor6&quot; x1=&quot;1275&quot; y1=&quot;5&quot; x2=&quot;1275&quot; y2=&quot;870&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1275&quot; dy=&quot;0&quot;&gt;TaskActivity2&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;183&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;1. Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;190&quot; x2=&quot;675&quot; y2=&quot;190&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;228&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;235&quot; x2=&quot;875&quot; y2=&quot;235&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;263&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;270&quot; x2=&quot;875&quot; y2=&quot;270&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;298&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Scheduled&lt;/text&gt;&lt;line x1=&quot;875&quot; y1=&quot;305&quot; x2=&quot;475&quot; y2=&quot;305&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;333&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;340&quot; x2=&quot;1075&quot; y2=&quot;340&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1070&quot; y=&quot;342&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;10&quot; height=&quot;273&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;activation0&quot;&gt;&lt;/rect&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;368&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Scheduled&lt;/text&gt;&lt;line x1=&quot;875&quot; y1=&quot;375&quot; x2=&quot;475&quot; y2=&quot;375&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;875&quot; y=&quot;403&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;410&quot; x2=&quot;1275&quot; y2=&quot;410&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1270&quot; y=&quot;412&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;10&quot; height=&quot;33&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;activation0&quot;&gt;&lt;/rect&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;872.5&quot; y=&quot;438&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Finished&lt;/text&gt;&lt;line x1=&quot;1270&quot; y1=&quot;445&quot; x2=&quot;475&quot; y2=&quot;445&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;473&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;480&quot; x2=&quot;275&quot; y2=&quot;480&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;508&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;515&quot; x2=&quot;475&quot; y2=&quot;515&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;563&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;2. Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;570&quot; x2=&quot;675&quot; y2=&quot;570&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;772.5&quot; y=&quot;608&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Finished&lt;/text&gt;&lt;line x1=&quot;1070&quot; y1=&quot;615&quot; x2=&quot;475&quot; y2=&quot;615&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;643&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;650&quot; x2=&quot;275&quot; y2=&quot;650&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;678&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;685&quot; x2=&quot;475&quot; y2=&quot;685&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;733&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;3. Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;740&quot; x2=&quot;675&quot; y2=&quot;740&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;778&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Finished&lt;/text&gt;&lt;line x1=&quot;675&quot; y1=&quot;785&quot; x2=&quot;475&quot; y2=&quot;785&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;805&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;837.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;805&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;837.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;805&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;837.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;805&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;837.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;805&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;837.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1000&quot; y=&quot;805&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;837.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity1&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1200&quot; y=&quot;805&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1275&quot; y=&quot;837.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1275&quot; dy=&quot;0&quot;&gt;TaskActivity2&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;h3&gt;The curious case of Orchestrations&lt;/h3&gt;
&lt;p&gt;So we have  the same Orchestration getting invoked 3 times. Curiously only once the orchestration finishes while others dont seem to do anything.
Lets look at the orchestration code.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Writeline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Orchestration Started&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; task1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ScheduleWithRetry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TestActivity1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Test Input1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; task2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ScheduleWithRetry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TestActivity2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Test Input2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; result1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; task1&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; result2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; task2&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Writeline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Orchestration Finished&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;First&lt;/strong&gt; time Orchestration starts - Replay False - Starts due to TaskCompleted event from the client&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Console logs - Orchestration Started&lt;/li&gt;
&lt;li&gt;Encounters 2 ScheduleWithRetry and sends two taskScheduled event to the Worker&lt;/li&gt;
&lt;li&gt;Goes to the await statement, see that task 1 is not complete. Exits.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Second&lt;/strong&gt; time orchestration starts - Replay true - Starts due to TaskCompleted event from Task 2 getting completed&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Console logs - Orchestration Started&lt;/li&gt;
&lt;li&gt;Encounters 2 ScheduleWithRetry, which does a noop as the tasks are already scheduled.&lt;/li&gt;
&lt;li&gt;Goes to the await statement, see that task 1 is not complete. Exits.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Third time&lt;/strong&gt; orchestration starts - Replay true - Starts due to TaskCompleted event from Task 1 getting completed&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Console logs - Orchestration Started&lt;/li&gt;
&lt;li&gt;Encounters 2 ScheduleWithRetry, which does a noop as the tasks are already scheduled.&lt;/li&gt;
&lt;li&gt;Goes to the await statement, sees that task 1 complete, returns the result.&lt;/li&gt;
&lt;li&gt;Goes to the await statement, sees that task 2 is already complete, returns the result.&lt;/li&gt;
&lt;li&gt;Console logs - Orchestration Finished&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So, in general, for any orchestration, we will have n number of unfinished Orchestrations and one complete orchestration.&lt;/p&gt;
&lt;h3&gt;Incomplete Orchestrations&lt;/h3&gt;
&lt;p&gt;The orchestrations seem to magically disappear after they encounter &lt;code class=&quot;language-text&quot;&gt;await&lt;/code&gt;, i.e. if Task1 is in flight.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;   &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; result1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; task1&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;In Case #1 and case #2 , this &lt;code class=&quot;language-text&quot;&gt;await&lt;/code&gt; never returns because internally when you Schedule a task it cannot invoke the actual task due to the sync nature of execution.&lt;/li&gt;
&lt;li&gt;Instead the framework returns a &lt;a href=&quot;https://docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.taskcompletionsource-1?view=netframework-4.8&quot;&gt;TaskCompletionSource&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;The framework checks the Service Bus message (TaskCompleted event) which triggered the execution whether it has the result of the await call and resolves the &lt;code class=&quot;language-text&quot;&gt;TaskCompletionSource&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;In all other cases &lt;code class=&quot;language-text&quot;&gt;TaskCompletionSource&lt;/code&gt; is never resolved, and hence you get the &lt;code class=&quot;language-text&quot;&gt;Orchestration Finished&lt;/code&gt; log only once and not in the other 2 cases.&lt;/li&gt;
&lt;li&gt;Unfulfilled tasks does not mean that the thread is blocked. The task parallel library will free up the thread and recycle it back to the pool.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;The await that you do over the &lt;code class=&quot;language-text&quot;&gt;ScheduleWithRetry&lt;/code&gt; Tasks are syntactic sugar over what is primarily an asynchronous event-driven architecture based on Queues.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Where do results from taskActivity get stored ?&lt;/h2&gt;
&lt;p&gt;In Part 1, you would have seen that even though hub was shut down , if the Task  execution was complete it will not re-run the Task. Its a similar situation when task1 completes in the multi activity scenario above , orchestration gets executed multiple times and gets the value of Task2 without even executing it more than once. Surely there is some store where the result from the task activities are stored?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DTF serializes all the events into something called as Session State which is closely tied to the concept of &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/service-bus-messaging/message-sessions&quot;&gt;Message Sessions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Service bus uses session Id to enforce ordering and partitioning of messages.&lt;/li&gt;
&lt;li&gt;Each session Id allows you to store a 1 Mb/256 Kb blob of data that is called Session State.&lt;/li&gt;
&lt;li&gt;Session is opened when you have a message in the service bus , and a session is closed when all messages of a particular sessionId is cleared and sessionState is set to null.&lt;/li&gt;
&lt;li&gt;DTF uses this session State to store data of all the states that the orchestration went through.&lt;/li&gt;
&lt;li&gt;Once the Orchestration is complete this session state is cleared and message session is closed.&lt;/li&gt;
&lt;li&gt;So the moment a Task completes, DTF puts the result into the event and into the Session State.&lt;/li&gt;
&lt;li&gt;So whenever an Orchestration runs , its able to rebuild the current state by using the session state.&lt;/li&gt;
&lt;li&gt;Here is an example of a session state &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 562px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/blog/static/2798b67dcb285c283fb0a0df1e938e67/6e88f/serializedState.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 90.54054054054053%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC2UlEQVQ4y41U2XLaQBDk/38pfsAgdF+AjQAJCYG5BOZK7HKVXe5MjwA7lYdEVVO7O9rt6Znp3cb++RnbaovtdoePjw98fn7i+nH9L3t/f8f5fMbb2xteX1/R2Gw2KPICHPmjnE4xeBxgmCSoqgq73e6/7FmIcWzkeY4szbATx+FwwHq9xmKxwHK5FNbbvw4ySLWplADn3HM1BZxkGcIgRDJIdOzGXYyGQ/R7PZ3TojBCr1vPk8EA02KKoiiQpukNlERIqJGJ0zQ68DwfVseE53qwTAuBF4j58BxPAfnPsV0kyRCJlGQ8HmM0GgnQBi8vL5Ly7gvQ6lhwHRdxFAmzPjoSwBcw13YExBHAUP57F1AHpoyt+5YEtrXeo+EIT08LHI9HNFKJ5FgObMtW0JqNpT6y5Uh/GASwzXoPMyCoI3PDMDT44DGpAcdCmw7LNNFsNuuDtq2pEtgXUJbDNARAgpKl0Wqj3TIQRTHWq7VK7lZDMrQZUYwM2BjzkrLnupoi2ROU7DzPQ5ZNMJ/NJc0nGWcoyxIzWStgPplcUgq1EawjmxHJ2vd99XsCGviBNCLFRPbPBISMKK2FgC6kfgRXQJWNH2q9yKrX7Um6dYA4jgUo1LRjSY+1Y93YAN6ujXR4tVqpEfwGyI1sBpn6kpLv1szoIzMGISh9/W5fdcrL8PDwoOC/fv0UUW+/aqi68+tmhCIR1iwKYwFxNQilZF406ooWW817PdNuG1LPTK8sBf4HQ/OiMWqOHVX5SOf5jyW4Nodsr9lMpyVO55MC8bYoYDHJVaTcUOvRugndkjlFzvW9sLr7cSeAfb3HtLUY7y/1dwNM07Hqy+YNEEaUxRWQnU6ls6UwYWlYt1wI5JdOM11293Q6faXM7sznc3Vsqssr8u014bO03+91M0f6CULjnB3mY1GWM2XZ4FPFJ+xwOGqk78ZUvtt+f8BS9rPLqbDjWQLzBSrkHWWA38xfAK69acTIAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Serialized state&quot;
        title=&quot;Serialized state&quot;
        src=&quot;/blog/static/2798b67dcb285c283fb0a0df1e938e67/6e88f/serializedState.png&quot;
        srcset=&quot;/blog/static/2798b67dcb285c283fb0a0df1e938e67/12f09/serializedState.png 148w,
/blog/static/2798b67dcb285c283fb0a0df1e938e67/e4a3f/serializedState.png 295w,
/blog/static/2798b67dcb285c283fb0a0df1e938e67/6e88f/serializedState.png 562w&quot;
        sizes=&quot;(max-width: 562px) 100vw, 562px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Durable Task Framework Internals - Part 1 (Dataflow and Reliability)]]></title><description><![CDATA[Durable Task Framework Series This post is part 1 of a series of posts on DTF. Durable Task Framework Internals - Part 1 (Dataflow and…]]></description><link>https://abhikmitra.github.io/blog/durable-task/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/durable-task/</guid><pubDate>Thu, 23 Apr 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;Durable Task Framework Series&lt;/h3&gt;
&lt;p&gt;This post is &lt;strong&gt;part 1&lt;/strong&gt; of a series of posts on DTF.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task/&quot;&gt;Durable Task Framework Internals - Part 1 (Dataflow and Reliability)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-2/&quot;&gt;Durable Task Framework Internals - Part 2 (The curious case of Orchestrations)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-3/&quot;&gt;Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-4/&quot;&gt;Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp;#x26; Middlewares)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 5 (Interesting usages of TPL in DTF)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://abhikmitra.github.io/blog/durable-task-5/&quot;&gt;Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Do you think there is more that I should cover or something I should fix ? Please raise an &lt;a href=&quot;https://github.com/abhikmitra/blog/issues&quot;&gt;issue&lt;/a&gt; and let me know&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Durable Task Framework&lt;/h3&gt;
&lt;p&gt;The Durable Task Framework is an orchestration framework for dot net apps. You can read more about it in their official &lt;a href=&quot;https://github.com/Azure/durabletask&quot;&gt;github repo&lt;/a&gt;. This &lt;a href=&quot;https://channel9.msdn.com/Shows/On-NET/Building-workflows-with-the-Durable-Task-Framework&quot;&gt;channel 9 video&lt;/a&gt; does a pretty good job of explaining about the framework.&lt;/p&gt;
&lt;p&gt;While I was reading through the materials , I felt the literature out their treated the system as a blackbox and I couldn’t find any material on the web on how does DTF works under the hood. So I cloned DTF repo and added console logs to understand how it works. The following details apply to &lt;a href=&quot;https://www.nuget.org/packages/DurableTask.Core/&quot;&gt;DurableTask.Core&lt;/a&gt; version 2.0.0.6 which maps to commit id &lt;code class=&quot;language-text&quot;&gt;0a93eba6c9692f52776dac0f3741eccad3293ef6&lt;/code&gt; in the DTF Github repo.&lt;/p&gt;
&lt;h3&gt;Setup&lt;/h3&gt;
&lt;p&gt;My setup has 2 console apps , DTFDemoWorker and DTFClient. DTFDemoWorker houses the hubWorker and creates the resources. I have 1 Orchestration called a TestOrchestration which does 2 activities, testActivity1 and TestActivity2 both of which console logs to the console and waits for sometime to simulate some work being done.&lt;/p&gt;
&lt;p&gt;You can find the repo &lt;a href=&quot;https://github.com/abhikmitra/DTFDemo&quot;&gt;here&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;When we create the resources DTF creates 3 Queues in the Service Bus &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;#x3C;TaskHubName&gt;/orchestrator&lt;/li&gt;
&lt;li&gt;&amp;#x3C;TaskHubName&gt;/tracking&lt;/li&gt;
&lt;li&gt;&amp;#x3C;TaskHubName&gt;/worker&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Steps&lt;/h3&gt;
&lt;p&gt;We will see whats the process in which Orchestrator provides reliability. We will ignore the tracking Queue for now and add that later. To kepe the diagrams simple , let’s assume we have 1 Task that gets invoked.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;We start the process with the following code from the Client.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CreateOrchestrationInstanceAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TestOrchestration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;InstanceId5302&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Test Input&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Result&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;This will send a message with event name &lt;code class=&quot;language-text&quot;&gt;ExecutionStarted&lt;/code&gt; message into the Orchestrator queue.There will be other details such as the orchestration name and id , that will help DTF to operate on the correct instance of orchestration.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562888&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:450px;&quot; viewBox=&quot;-50 -10 450 196&quot;&gt;&lt;style&gt;#mermaid-1587905562888 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562888 .label text{fill:#333}#mermaid-1587905562888 .node rect,#mermaid-1587905562888 .node circle,#mermaid-1587905562888 .node ellipse,#mermaid-1587905562888 .node polygon,#mermaid-1587905562888 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562888 .node .label{text-align:center}#mermaid-1587905562888 .node.clickable{cursor:pointer}#mermaid-1587905562888 .arrowheadPath{fill:#333}#mermaid-1587905562888 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562888 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562888 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562888 .cluster text{fill:#333}#mermaid-1587905562888 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562888 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562888 text.actor{fill:#000;stroke:none}#mermaid-1587905562888 .actor-line{stroke:grey}#mermaid-1587905562888 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562888 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562888 #arrowhead{fill:#333}#mermaid-1587905562888 .sequenceNumber{fill:#fff}#mermaid-1587905562888 #sequencenumber{fill:#333}#mermaid-1587905562888 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562888 .messageText{fill:#333;stroke:none}#mermaid-1587905562888 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562888 .labelText{fill:#000;stroke:none}#mermaid-1587905562888 .loopText{fill:#000;stroke:none}#mermaid-1587905562888 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562888 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562888 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562888 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562888 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562888 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562888 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 .section{stroke:none;opacity:0.2}#mermaid-1587905562888 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562888 .section2{fill:#fff400}#mermaid-1587905562888 .section1,#mermaid-1587905562888 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562888 .sectionTitle0{fill:#333}#mermaid-1587905562888 .sectionTitle1{fill:#333}#mermaid-1587905562888 .sectionTitle2{fill:#333}#mermaid-1587905562888 .sectionTitle3{fill:#333}#mermaid-1587905562888 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562888 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 .grid path{stroke-width:0}#mermaid-1587905562888 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562888 .task{stroke-width:2}#mermaid-1587905562888 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562888 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562888 .task.clickable{cursor:pointer}#mermaid-1587905562888 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562888 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562888 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562888 .taskText0,#mermaid-1587905562888 .taskText1,#mermaid-1587905562888 .taskText2,#mermaid-1587905562888 .taskText3{fill:#fff}#mermaid-1587905562888 .task0,#mermaid-1587905562888 .task1,#mermaid-1587905562888 .task2,#mermaid-1587905562888 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562888 .taskTextOutside0,#mermaid-1587905562888 .taskTextOutside2{fill:#000}#mermaid-1587905562888 .taskTextOutside1,#mermaid-1587905562888 .taskTextOutside3{fill:#000}#mermaid-1587905562888 .active0,#mermaid-1587905562888 .active1,#mermaid-1587905562888 .active2,#mermaid-1587905562888 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562888 .activeText0,#mermaid-1587905562888 .activeText1,#mermaid-1587905562888 .activeText2,#mermaid-1587905562888 .activeText3{fill:#000 !important}#mermaid-1587905562888 .done0,#mermaid-1587905562888 .done1,#mermaid-1587905562888 .done2,#mermaid-1587905562888 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562888 .doneText0,#mermaid-1587905562888 .doneText1,#mermaid-1587905562888 .doneText2,#mermaid-1587905562888 .doneText3{fill:#000 !important}#mermaid-1587905562888 .crit0,#mermaid-1587905562888 .crit1,#mermaid-1587905562888 .crit2,#mermaid-1587905562888 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562888 .activeCrit0,#mermaid-1587905562888 .activeCrit1,#mermaid-1587905562888 .activeCrit2,#mermaid-1587905562888 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562888 .doneCrit0,#mermaid-1587905562888 .doneCrit1,#mermaid-1587905562888 .doneCrit2,#mermaid-1587905562888 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562888 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562888 .milestoneText{font-style:italic}#mermaid-1587905562888 .doneCritText0,#mermaid-1587905562888 .doneCritText1,#mermaid-1587905562888 .doneCritText2,#mermaid-1587905562888 .doneCritText3{fill:#000 !important}#mermaid-1587905562888 .activeCritText0,#mermaid-1587905562888 .activeCritText1,#mermaid-1587905562888 .activeCritText2,#mermaid-1587905562888 .activeCritText3{fill:#000 !important}#mermaid-1587905562888 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562888 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562888 g.clickable{cursor:pointer}#mermaid-1587905562888 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562888 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562888 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562888 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562888 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562888 .dashed-line{stroke-dasharray:3}#mermaid-1587905562888 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562888 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562888 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562888 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562888 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562888 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562888 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562888 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562888 .commit-id,#mermaid-1587905562888 .commit-msg,#mermaid-1587905562888 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562888 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562888 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562888 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562888 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562888 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562888 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562888 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562888 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562888 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562888 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562888 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562888 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;185&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;185&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;120&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;152.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;120&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;152.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;This is received by the hub &amp;#x26; the actual &lt;a href=&quot;https://github.com/abhikmitra/DTFDemo/blob/master/Domains/TestOrchestration.cs&quot;&gt;TestOrchestration&lt;/a&gt; code is invoked. As you can see in the link above , I have put in log statements and 2 log statements are invoked.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562432&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:850px;&quot; viewBox=&quot;-50 -10 850 266&quot;&gt;&lt;style&gt;#mermaid-1587905562432 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562432 .label text{fill:#333}#mermaid-1587905562432 .node rect,#mermaid-1587905562432 .node circle,#mermaid-1587905562432 .node ellipse,#mermaid-1587905562432 .node polygon,#mermaid-1587905562432 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562432 .node .label{text-align:center}#mermaid-1587905562432 .node.clickable{cursor:pointer}#mermaid-1587905562432 .arrowheadPath{fill:#333}#mermaid-1587905562432 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562432 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562432 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562432 .cluster text{fill:#333}#mermaid-1587905562432 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562432 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562432 text.actor{fill:#000;stroke:none}#mermaid-1587905562432 .actor-line{stroke:grey}#mermaid-1587905562432 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562432 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562432 #arrowhead{fill:#333}#mermaid-1587905562432 .sequenceNumber{fill:#fff}#mermaid-1587905562432 #sequencenumber{fill:#333}#mermaid-1587905562432 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562432 .messageText{fill:#333;stroke:none}#mermaid-1587905562432 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562432 .labelText{fill:#000;stroke:none}#mermaid-1587905562432 .loopText{fill:#000;stroke:none}#mermaid-1587905562432 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562432 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562432 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562432 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562432 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562432 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562432 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 .section{stroke:none;opacity:0.2}#mermaid-1587905562432 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562432 .section2{fill:#fff400}#mermaid-1587905562432 .section1,#mermaid-1587905562432 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562432 .sectionTitle0{fill:#333}#mermaid-1587905562432 .sectionTitle1{fill:#333}#mermaid-1587905562432 .sectionTitle2{fill:#333}#mermaid-1587905562432 .sectionTitle3{fill:#333}#mermaid-1587905562432 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562432 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 .grid path{stroke-width:0}#mermaid-1587905562432 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562432 .task{stroke-width:2}#mermaid-1587905562432 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562432 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562432 .task.clickable{cursor:pointer}#mermaid-1587905562432 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562432 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562432 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562432 .taskText0,#mermaid-1587905562432 .taskText1,#mermaid-1587905562432 .taskText2,#mermaid-1587905562432 .taskText3{fill:#fff}#mermaid-1587905562432 .task0,#mermaid-1587905562432 .task1,#mermaid-1587905562432 .task2,#mermaid-1587905562432 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562432 .taskTextOutside0,#mermaid-1587905562432 .taskTextOutside2{fill:#000}#mermaid-1587905562432 .taskTextOutside1,#mermaid-1587905562432 .taskTextOutside3{fill:#000}#mermaid-1587905562432 .active0,#mermaid-1587905562432 .active1,#mermaid-1587905562432 .active2,#mermaid-1587905562432 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562432 .activeText0,#mermaid-1587905562432 .activeText1,#mermaid-1587905562432 .activeText2,#mermaid-1587905562432 .activeText3{fill:#000 !important}#mermaid-1587905562432 .done0,#mermaid-1587905562432 .done1,#mermaid-1587905562432 .done2,#mermaid-1587905562432 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562432 .doneText0,#mermaid-1587905562432 .doneText1,#mermaid-1587905562432 .doneText2,#mermaid-1587905562432 .doneText3{fill:#000 !important}#mermaid-1587905562432 .crit0,#mermaid-1587905562432 .crit1,#mermaid-1587905562432 .crit2,#mermaid-1587905562432 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562432 .activeCrit0,#mermaid-1587905562432 .activeCrit1,#mermaid-1587905562432 .activeCrit2,#mermaid-1587905562432 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562432 .doneCrit0,#mermaid-1587905562432 .doneCrit1,#mermaid-1587905562432 .doneCrit2,#mermaid-1587905562432 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562432 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562432 .milestoneText{font-style:italic}#mermaid-1587905562432 .doneCritText0,#mermaid-1587905562432 .doneCritText1,#mermaid-1587905562432 .doneCritText2,#mermaid-1587905562432 .doneCritText3{fill:#000 !important}#mermaid-1587905562432 .activeCritText0,#mermaid-1587905562432 .activeCritText1,#mermaid-1587905562432 .activeCritText2,#mermaid-1587905562432 .activeCritText3{fill:#000 !important}#mermaid-1587905562432 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562432 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562432 g.clickable{cursor:pointer}#mermaid-1587905562432 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562432 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562432 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562432 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562432 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562432 .dashed-line{stroke-dasharray:3}#mermaid-1587905562432 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562432 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562432 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562432 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562432 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562432 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562432 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562432 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562432 .commit-id,#mermaid-1587905562432 .commit-msg,#mermaid-1587905562432 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562432 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562432 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562432 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562432 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562432 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562432 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562432 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562432 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562432 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562432 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562432 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562432 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;255&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;255&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;255&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;255&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;170&quot; x2=&quot;675&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;190&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;222.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;190&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;222.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;190&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;222.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;190&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;222.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;
&lt;p&gt;Assume the orchestration code is as below. The orchestration runs till &lt;code class=&quot;language-text&quot;&gt;scheduleWithRetry&lt;/code&gt; and prints &lt;code class=&quot;language-text&quot;&gt;Running Orchestration&lt;/code&gt; into the console. Since this is the first time orchestration is running &lt;code class=&quot;language-text&quot;&gt;Is replaying&lt;/code&gt; is set to false. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-csharp line-numbers&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Is Replaying =&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;IsReplaying&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Running Orchestration&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ScheduleWithRetry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TestActivity1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Orchestration Finished&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When the orchestration encounters an activity it puts a message into the Worker Queue and exits the orchestration. The rest of the orchestration is not executed.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562331&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1050px;&quot; viewBox=&quot;-50 -10 1050 301&quot;&gt;&lt;style&gt;#mermaid-1587905562331 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562331 .label text{fill:#333}#mermaid-1587905562331 .node rect,#mermaid-1587905562331 .node circle,#mermaid-1587905562331 .node ellipse,#mermaid-1587905562331 .node polygon,#mermaid-1587905562331 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562331 .node .label{text-align:center}#mermaid-1587905562331 .node.clickable{cursor:pointer}#mermaid-1587905562331 .arrowheadPath{fill:#333}#mermaid-1587905562331 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562331 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562331 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562331 .cluster text{fill:#333}#mermaid-1587905562331 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562331 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562331 text.actor{fill:#000;stroke:none}#mermaid-1587905562331 .actor-line{stroke:grey}#mermaid-1587905562331 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562331 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562331 #arrowhead{fill:#333}#mermaid-1587905562331 .sequenceNumber{fill:#fff}#mermaid-1587905562331 #sequencenumber{fill:#333}#mermaid-1587905562331 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562331 .messageText{fill:#333;stroke:none}#mermaid-1587905562331 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562331 .labelText{fill:#000;stroke:none}#mermaid-1587905562331 .loopText{fill:#000;stroke:none}#mermaid-1587905562331 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562331 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562331 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562331 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562331 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562331 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562331 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .section{stroke:none;opacity:0.2}#mermaid-1587905562331 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562331 .section2{fill:#fff400}#mermaid-1587905562331 .section1,#mermaid-1587905562331 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562331 .sectionTitle0{fill:#333}#mermaid-1587905562331 .sectionTitle1{fill:#333}#mermaid-1587905562331 .sectionTitle2{fill:#333}#mermaid-1587905562331 .sectionTitle3{fill:#333}#mermaid-1587905562331 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562331 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .grid path{stroke-width:0}#mermaid-1587905562331 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562331 .task{stroke-width:2}#mermaid-1587905562331 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562331 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562331 .task.clickable{cursor:pointer}#mermaid-1587905562331 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562331 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562331 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562331 .taskText0,#mermaid-1587905562331 .taskText1,#mermaid-1587905562331 .taskText2,#mermaid-1587905562331 .taskText3{fill:#fff}#mermaid-1587905562331 .task0,#mermaid-1587905562331 .task1,#mermaid-1587905562331 .task2,#mermaid-1587905562331 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562331 .taskTextOutside0,#mermaid-1587905562331 .taskTextOutside2{fill:#000}#mermaid-1587905562331 .taskTextOutside1,#mermaid-1587905562331 .taskTextOutside3{fill:#000}#mermaid-1587905562331 .active0,#mermaid-1587905562331 .active1,#mermaid-1587905562331 .active2,#mermaid-1587905562331 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562331 .activeText0,#mermaid-1587905562331 .activeText1,#mermaid-1587905562331 .activeText2,#mermaid-1587905562331 .activeText3{fill:#000 !important}#mermaid-1587905562331 .done0,#mermaid-1587905562331 .done1,#mermaid-1587905562331 .done2,#mermaid-1587905562331 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562331 .doneText0,#mermaid-1587905562331 .doneText1,#mermaid-1587905562331 .doneText2,#mermaid-1587905562331 .doneText3{fill:#000 !important}#mermaid-1587905562331 .crit0,#mermaid-1587905562331 .crit1,#mermaid-1587905562331 .crit2,#mermaid-1587905562331 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562331 .activeCrit0,#mermaid-1587905562331 .activeCrit1,#mermaid-1587905562331 .activeCrit2,#mermaid-1587905562331 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562331 .doneCrit0,#mermaid-1587905562331 .doneCrit1,#mermaid-1587905562331 .doneCrit2,#mermaid-1587905562331 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562331 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562331 .milestoneText{font-style:italic}#mermaid-1587905562331 .doneCritText0,#mermaid-1587905562331 .doneCritText1,#mermaid-1587905562331 .doneCritText2,#mermaid-1587905562331 .doneCritText3{fill:#000 !important}#mermaid-1587905562331 .activeCritText0,#mermaid-1587905562331 .activeCritText1,#mermaid-1587905562331 .activeCritText2,#mermaid-1587905562331 .activeCritText3{fill:#000 !important}#mermaid-1587905562331 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562331 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562331 g.clickable{cursor:pointer}#mermaid-1587905562331 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562331 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562331 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562331 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562331 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562331 .dashed-line{stroke-dasharray:3}#mermaid-1587905562331 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 .commit-id,#mermaid-1587905562331 .commit-msg,#mermaid-1587905562331 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562331 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562331 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562331 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562331 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562331 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562331 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562331 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562331 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562331 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562331 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562331 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;290&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;290&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;290&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;290&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;290&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;170&quot; x2=&quot;675&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;198&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;205&quot; x2=&quot;875&quot; y2=&quot;205&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;225&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;257.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;225&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;257.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;225&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;257.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;225&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;257.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;225&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;257.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;
&lt;p&gt;The hub is also listening to the Worker Queue and picks up the &lt;code class=&quot;language-text&quot;&gt;TaskScheduled&lt;/code&gt; message and invokes the TaskActivity. For now,  let’s assume all the TaskActivity does is a console log. So the task is immediately completed. When the task is completed the hub queues TaskCompleted event in the Orchestrator queue.&lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562292&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1250px;&quot; viewBox=&quot;-50 -10 1250 406&quot;&gt;&lt;style&gt;#mermaid-1587905562292 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562292 .label text{fill:#333}#mermaid-1587905562292 .node rect,#mermaid-1587905562292 .node circle,#mermaid-1587905562292 .node ellipse,#mermaid-1587905562292 .node polygon,#mermaid-1587905562292 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562292 .node .label{text-align:center}#mermaid-1587905562292 .node.clickable{cursor:pointer}#mermaid-1587905562292 .arrowheadPath{fill:#333}#mermaid-1587905562292 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562292 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562292 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562292 .cluster text{fill:#333}#mermaid-1587905562292 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562292 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562292 text.actor{fill:#000;stroke:none}#mermaid-1587905562292 .actor-line{stroke:grey}#mermaid-1587905562292 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562292 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562292 #arrowhead{fill:#333}#mermaid-1587905562292 .sequenceNumber{fill:#fff}#mermaid-1587905562292 #sequencenumber{fill:#333}#mermaid-1587905562292 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562292 .messageText{fill:#333;stroke:none}#mermaid-1587905562292 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562292 .labelText{fill:#000;stroke:none}#mermaid-1587905562292 .loopText{fill:#000;stroke:none}#mermaid-1587905562292 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562292 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562292 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562292 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562292 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562292 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562292 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 .section{stroke:none;opacity:0.2}#mermaid-1587905562292 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562292 .section2{fill:#fff400}#mermaid-1587905562292 .section1,#mermaid-1587905562292 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562292 .sectionTitle0{fill:#333}#mermaid-1587905562292 .sectionTitle1{fill:#333}#mermaid-1587905562292 .sectionTitle2{fill:#333}#mermaid-1587905562292 .sectionTitle3{fill:#333}#mermaid-1587905562292 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562292 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 .grid path{stroke-width:0}#mermaid-1587905562292 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562292 .task{stroke-width:2}#mermaid-1587905562292 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562292 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562292 .task.clickable{cursor:pointer}#mermaid-1587905562292 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562292 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562292 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562292 .taskText0,#mermaid-1587905562292 .taskText1,#mermaid-1587905562292 .taskText2,#mermaid-1587905562292 .taskText3{fill:#fff}#mermaid-1587905562292 .task0,#mermaid-1587905562292 .task1,#mermaid-1587905562292 .task2,#mermaid-1587905562292 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562292 .taskTextOutside0,#mermaid-1587905562292 .taskTextOutside2{fill:#000}#mermaid-1587905562292 .taskTextOutside1,#mermaid-1587905562292 .taskTextOutside3{fill:#000}#mermaid-1587905562292 .active0,#mermaid-1587905562292 .active1,#mermaid-1587905562292 .active2,#mermaid-1587905562292 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562292 .activeText0,#mermaid-1587905562292 .activeText1,#mermaid-1587905562292 .activeText2,#mermaid-1587905562292 .activeText3{fill:#000 !important}#mermaid-1587905562292 .done0,#mermaid-1587905562292 .done1,#mermaid-1587905562292 .done2,#mermaid-1587905562292 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562292 .doneText0,#mermaid-1587905562292 .doneText1,#mermaid-1587905562292 .doneText2,#mermaid-1587905562292 .doneText3{fill:#000 !important}#mermaid-1587905562292 .crit0,#mermaid-1587905562292 .crit1,#mermaid-1587905562292 .crit2,#mermaid-1587905562292 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562292 .activeCrit0,#mermaid-1587905562292 .activeCrit1,#mermaid-1587905562292 .activeCrit2,#mermaid-1587905562292 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562292 .doneCrit0,#mermaid-1587905562292 .doneCrit1,#mermaid-1587905562292 .doneCrit2,#mermaid-1587905562292 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562292 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562292 .milestoneText{font-style:italic}#mermaid-1587905562292 .doneCritText0,#mermaid-1587905562292 .doneCritText1,#mermaid-1587905562292 .doneCritText2,#mermaid-1587905562292 .doneCritText3{fill:#000 !important}#mermaid-1587905562292 .activeCritText0,#mermaid-1587905562292 .activeCritText1,#mermaid-1587905562292 .activeCritText2,#mermaid-1587905562292 .activeCritText3{fill:#000 !important}#mermaid-1587905562292 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562292 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562292 g.clickable{cursor:pointer}#mermaid-1587905562292 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562292 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562292 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562292 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562292 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562292 .dashed-line{stroke-dasharray:3}#mermaid-1587905562292 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562292 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562292 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562292 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562292 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562292 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562292 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562292 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562292 .commit-id,#mermaid-1587905562292 .commit-msg,#mermaid-1587905562292 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562292 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562292 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562292 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562292 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562292 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562292 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562292 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562292 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562292 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562292 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562292 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562292 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;395&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;395&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;395&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;395&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;395&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor5&quot; x1=&quot;1075&quot; y1=&quot;5&quot; x2=&quot;1075&quot; y2=&quot;395&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1000&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;170&quot; x2=&quot;675&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;198&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;205&quot; x2=&quot;875&quot; y2=&quot;205&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;233&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Scheduled&lt;/text&gt;&lt;line x1=&quot;875&quot; y1=&quot;240&quot; x2=&quot;475&quot; y2=&quot;240&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;268&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;275&quot; x2=&quot;1075&quot; y2=&quot;275&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;303&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;310&quot; x2=&quot;275&quot; y2=&quot;310&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;330&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;362.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;330&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;362.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;330&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;362.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;330&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;362.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;330&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;362.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1000&quot; y=&quot;330&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;362.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;The Orchestration wakes up, the moment the hub detects a message in the Orchestrator Queue and &lt;em&gt;restarts the Orchestration from the beginning&lt;/em&gt;. So all the logs that got printed last time gets printed again. Since this is the second time orchestration is running &lt;code class=&quot;language-text&quot;&gt;Is replaying&lt;/code&gt; is set to &lt;em&gt;True&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562322&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1250px;&quot; viewBox=&quot;-50 -10 1250 476&quot;&gt;&lt;style&gt;#mermaid-1587905562322 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562322 .label text{fill:#333}#mermaid-1587905562322 .node rect,#mermaid-1587905562322 .node circle,#mermaid-1587905562322 .node ellipse,#mermaid-1587905562322 .node polygon,#mermaid-1587905562322 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562322 .node .label{text-align:center}#mermaid-1587905562322 .node.clickable{cursor:pointer}#mermaid-1587905562322 .arrowheadPath{fill:#333}#mermaid-1587905562322 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562322 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562322 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562322 .cluster text{fill:#333}#mermaid-1587905562322 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562322 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562322 text.actor{fill:#000;stroke:none}#mermaid-1587905562322 .actor-line{stroke:grey}#mermaid-1587905562322 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562322 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562322 #arrowhead{fill:#333}#mermaid-1587905562322 .sequenceNumber{fill:#fff}#mermaid-1587905562322 #sequencenumber{fill:#333}#mermaid-1587905562322 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562322 .messageText{fill:#333;stroke:none}#mermaid-1587905562322 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562322 .labelText{fill:#000;stroke:none}#mermaid-1587905562322 .loopText{fill:#000;stroke:none}#mermaid-1587905562322 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562322 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562322 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562322 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562322 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562322 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562322 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 .section{stroke:none;opacity:0.2}#mermaid-1587905562322 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562322 .section2{fill:#fff400}#mermaid-1587905562322 .section1,#mermaid-1587905562322 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562322 .sectionTitle0{fill:#333}#mermaid-1587905562322 .sectionTitle1{fill:#333}#mermaid-1587905562322 .sectionTitle2{fill:#333}#mermaid-1587905562322 .sectionTitle3{fill:#333}#mermaid-1587905562322 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562322 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 .grid path{stroke-width:0}#mermaid-1587905562322 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562322 .task{stroke-width:2}#mermaid-1587905562322 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562322 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562322 .task.clickable{cursor:pointer}#mermaid-1587905562322 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562322 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562322 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562322 .taskText0,#mermaid-1587905562322 .taskText1,#mermaid-1587905562322 .taskText2,#mermaid-1587905562322 .taskText3{fill:#fff}#mermaid-1587905562322 .task0,#mermaid-1587905562322 .task1,#mermaid-1587905562322 .task2,#mermaid-1587905562322 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562322 .taskTextOutside0,#mermaid-1587905562322 .taskTextOutside2{fill:#000}#mermaid-1587905562322 .taskTextOutside1,#mermaid-1587905562322 .taskTextOutside3{fill:#000}#mermaid-1587905562322 .active0,#mermaid-1587905562322 .active1,#mermaid-1587905562322 .active2,#mermaid-1587905562322 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562322 .activeText0,#mermaid-1587905562322 .activeText1,#mermaid-1587905562322 .activeText2,#mermaid-1587905562322 .activeText3{fill:#000 !important}#mermaid-1587905562322 .done0,#mermaid-1587905562322 .done1,#mermaid-1587905562322 .done2,#mermaid-1587905562322 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562322 .doneText0,#mermaid-1587905562322 .doneText1,#mermaid-1587905562322 .doneText2,#mermaid-1587905562322 .doneText3{fill:#000 !important}#mermaid-1587905562322 .crit0,#mermaid-1587905562322 .crit1,#mermaid-1587905562322 .crit2,#mermaid-1587905562322 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562322 .activeCrit0,#mermaid-1587905562322 .activeCrit1,#mermaid-1587905562322 .activeCrit2,#mermaid-1587905562322 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562322 .doneCrit0,#mermaid-1587905562322 .doneCrit1,#mermaid-1587905562322 .doneCrit2,#mermaid-1587905562322 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562322 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562322 .milestoneText{font-style:italic}#mermaid-1587905562322 .doneCritText0,#mermaid-1587905562322 .doneCritText1,#mermaid-1587905562322 .doneCritText2,#mermaid-1587905562322 .doneCritText3{fill:#000 !important}#mermaid-1587905562322 .activeCritText0,#mermaid-1587905562322 .activeCritText1,#mermaid-1587905562322 .activeCritText2,#mermaid-1587905562322 .activeCritText3{fill:#000 !important}#mermaid-1587905562322 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562322 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562322 g.clickable{cursor:pointer}#mermaid-1587905562322 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562322 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562322 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562322 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562322 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562322 .dashed-line{stroke-dasharray:3}#mermaid-1587905562322 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562322 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562322 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562322 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562322 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562322 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562322 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562322 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562322 .commit-id,#mermaid-1587905562322 .commit-msg,#mermaid-1587905562322 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562322 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562322 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562322 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562322 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562322 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562322 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562322 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562322 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562322 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562322 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562322 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562322 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;465&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;465&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;465&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;465&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;465&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor5&quot; x1=&quot;1075&quot; y1=&quot;5&quot; x2=&quot;1075&quot; y2=&quot;465&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1000&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;170&quot; x2=&quot;675&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;198&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;205&quot; x2=&quot;875&quot; y2=&quot;205&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;233&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Scheduled&lt;/text&gt;&lt;line x1=&quot;875&quot; y1=&quot;240&quot; x2=&quot;475&quot; y2=&quot;240&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;268&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;275&quot; x2=&quot;1075&quot; y2=&quot;275&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;303&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;310&quot; x2=&quot;275&quot; y2=&quot;310&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;338&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskCompleted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;345&quot; x2=&quot;475&quot; y2=&quot;345&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;373&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked &amp;amp; Completed&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;380&quot; x2=&quot;675&quot; y2=&quot;380&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;400&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;432.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;400&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;432.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;400&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;432.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;400&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;432.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;400&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;432.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1000&quot; y=&quot;400&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;432.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;ol start=&quot;7&quot;&gt;
&lt;li&gt;
&lt;p&gt;What happens when the the Hub fails in Step #5 while it is running the taskActivity ?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In a distributed system , we have to work with the assumption that the hub can fail any time and so can the task. &lt;/li&gt;
&lt;li&gt;The hub does not remove the TaskScheduledEvent unless the TasActivity is complete. So if in case the hub goes down, the service bus message will be present in the queue. When the hub comes back online, it will start from step 5 as if nothing had happened.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;What if, the Task itself throws an exception  ? &lt;/p&gt;
&lt;div class=&quot;mermaid&quot; data-processed=&quot;true&quot;&gt;&lt;svg id=&quot;mermaid-1587905562331&quot; width=&quot;100%&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;100%&quot; style=&quot;max-width:1350px;&quot; viewBox=&quot;-50 -10 1350 786&quot;&gt;&lt;style&gt;#mermaid-1587905562331 .label{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587905562331 .label text{fill:#333}#mermaid-1587905562331 .node rect,#mermaid-1587905562331 .node circle,#mermaid-1587905562331 .node ellipse,#mermaid-1587905562331 .node polygon,#mermaid-1587905562331 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587905562331 .node .label{text-align:center}#mermaid-1587905562331 .node.clickable{cursor:pointer}#mermaid-1587905562331 .arrowheadPath{fill:#333}#mermaid-1587905562331 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587905562331 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587905562331 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587905562331 .cluster text{fill:#333}#mermaid-1587905562331 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587905562331 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562331 text.actor{fill:#000;stroke:none}#mermaid-1587905562331 .actor-line{stroke:grey}#mermaid-1587905562331 .messageLine0{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562331 .messageLine1{stroke-width:1.5;stroke-dasharray:&apos;2 2&apos;;stroke:#333}#mermaid-1587905562331 #arrowhead{fill:#333}#mermaid-1587905562331 .sequenceNumber{fill:#fff}#mermaid-1587905562331 #sequencenumber{fill:#333}#mermaid-1587905562331 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587905562331 .messageText{fill:#333;stroke:none}#mermaid-1587905562331 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587905562331 .labelText{fill:#000;stroke:none}#mermaid-1587905562331 .loopText{fill:#000;stroke:none}#mermaid-1587905562331 .loopLine{stroke-width:2;stroke-dasharray:&apos;2 2&apos;;stroke:#ccf}#mermaid-1587905562331 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562331 .noteText{fill:black;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587905562331 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587905562331 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587905562331 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587905562331 .mermaid-main-font{font-family:&quot;trebuchet ms&quot;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .section{stroke:none;opacity:0.2}#mermaid-1587905562331 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587905562331 .section2{fill:#fff400}#mermaid-1587905562331 .section1,#mermaid-1587905562331 .section3{fill:#fff;opacity:0.2}#mermaid-1587905562331 .sectionTitle0{fill:#333}#mermaid-1587905562331 .sectionTitle1{fill:#333}#mermaid-1587905562331 .sectionTitle2{fill:#333}#mermaid-1587905562331 .sectionTitle3{fill:#333}#mermaid-1587905562331 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587905562331 .grid .tick text{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .grid path{stroke-width:0}#mermaid-1587905562331 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587905562331 .task{stroke-width:2}#mermaid-1587905562331 .taskText{text-anchor:middle;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .taskText:not([font-size]){font-size:11px}#mermaid-1587905562331 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587905562331 .task.clickable{cursor:pointer}#mermaid-1587905562331 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562331 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562331 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587905562331 .taskText0,#mermaid-1587905562331 .taskText1,#mermaid-1587905562331 .taskText2,#mermaid-1587905562331 .taskText3{fill:#fff}#mermaid-1587905562331 .task0,#mermaid-1587905562331 .task1,#mermaid-1587905562331 .task2,#mermaid-1587905562331 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587905562331 .taskTextOutside0,#mermaid-1587905562331 .taskTextOutside2{fill:#000}#mermaid-1587905562331 .taskTextOutside1,#mermaid-1587905562331 .taskTextOutside3{fill:#000}#mermaid-1587905562331 .active0,#mermaid-1587905562331 .active1,#mermaid-1587905562331 .active2,#mermaid-1587905562331 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587905562331 .activeText0,#mermaid-1587905562331 .activeText1,#mermaid-1587905562331 .activeText2,#mermaid-1587905562331 .activeText3{fill:#000 !important}#mermaid-1587905562331 .done0,#mermaid-1587905562331 .done1,#mermaid-1587905562331 .done2,#mermaid-1587905562331 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587905562331 .doneText0,#mermaid-1587905562331 .doneText1,#mermaid-1587905562331 .doneText2,#mermaid-1587905562331 .doneText3{fill:#000 !important}#mermaid-1587905562331 .crit0,#mermaid-1587905562331 .crit1,#mermaid-1587905562331 .crit2,#mermaid-1587905562331 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587905562331 .activeCrit0,#mermaid-1587905562331 .activeCrit1,#mermaid-1587905562331 .activeCrit2,#mermaid-1587905562331 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587905562331 .doneCrit0,#mermaid-1587905562331 .doneCrit1,#mermaid-1587905562331 .doneCrit2,#mermaid-1587905562331 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587905562331 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587905562331 .milestoneText{font-style:italic}#mermaid-1587905562331 .doneCritText0,#mermaid-1587905562331 .doneCritText1,#mermaid-1587905562331 .doneCritText2,#mermaid-1587905562331 .doneCritText3{fill:#000 !important}#mermaid-1587905562331 .activeCritText0,#mermaid-1587905562331 .activeCritText1,#mermaid-1587905562331 .activeCritText2,#mermaid-1587905562331 .activeCritText3{fill:#000 !important}#mermaid-1587905562331 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 g.classGroup text{fill:#9370db;stroke:none;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587905562331 g.classGroup text .title{font-weight:bolder}#mermaid-1587905562331 g.clickable{cursor:pointer}#mermaid-1587905562331 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562331 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562331 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562331 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587905562331 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562331 .dashed-line{stroke-dasharray:3}#mermaid-1587905562331 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587905562331 .commit-id,#mermaid-1587905562331 .commit-msg,#mermaid-1587905562331 .branch-label{fill:lightgrey;color:lightgrey;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 .slice{font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587905562331 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587905562331 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587905562331 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587905562331 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587905562331 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587905562331 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587905562331 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587905562331 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587905562331 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587905562331 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587905562331 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:&apos;trebuchet ms&apos;, verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: &apos;&quot;trebuchet ms&quot;, verdana, arial&apos;;--mermaid-font-family: &quot;Comic Sans MS&quot;, &quot;Comic Sans&quot;, cursive}

:root { --mermaid-font-family: &quot;trebuchet ms&quot;, verdana, arial;}&lt;/style&gt;&lt;style&gt;#mermaid-1587905562331 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal &quot;trebuchet ms&quot;, verdana, arial;
  }&lt;/style&gt;&lt;g&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor0&quot; x1=&quot;75&quot; y1=&quot;5&quot; x2=&quot;75&quot; y2=&quot;775&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor1&quot; x1=&quot;275&quot; y1=&quot;5&quot; x2=&quot;275&quot; y2=&quot;775&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;200&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor2&quot; x1=&quot;475&quot; y1=&quot;5&quot; x2=&quot;475&quot; y2=&quot;775&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;400&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor3&quot; x1=&quot;675&quot; y1=&quot;5&quot; x2=&quot;675&quot; y2=&quot;775&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;600&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor4&quot; x1=&quot;875&quot; y1=&quot;5&quot; x2=&quot;875&quot; y2=&quot;775&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;800&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;line id=&quot;actor5&quot; x1=&quot;1075&quot; y1=&quot;5&quot; x2=&quot;1075&quot; y2=&quot;775&quot; class=&quot;actor-line&quot; stroke-width=&quot;0.5px&quot; stroke=&quot;#999&quot;&gt;&lt;/line&gt;&lt;rect x=&quot;1000&quot; y=&quot;0&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;32.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;defs&gt;&lt;marker id=&quot;arrowhead&quot; refX=&quot;5&quot; refY=&quot;2&quot; markerWidth=&quot;6&quot; markerHeight=&quot;4&quot; orient=&quot;auto&quot;&gt;&lt;path d=&quot;M 0,0 V 4 L6,2 Z&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;crosshead&quot; markerWidth=&quot;15&quot; markerHeight=&quot;8&quot; orient=&quot;auto&quot; refX=&quot;16&quot; refY=&quot;4&quot;&gt;&lt;path fill=&quot;black&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 9,2 V 6 L16,4 Z&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;path fill=&quot;none&quot; stroke=&quot;#000000&quot; stroke-width=&quot;1px&quot; d=&quot;M 0,1 L 6,7 M 6,1 L 0,7&quot; style=&quot;stroke-dasharray: 0, 0;&quot;&gt;&lt;/path&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;defs&gt;&lt;marker id=&quot;sequencenumber&quot; refX=&quot;15&quot; refY=&quot;15&quot; markerWidth=&quot;60&quot; markerHeight=&quot;40&quot; orient=&quot;auto&quot;&gt;&lt;circle cx=&quot;15&quot; cy=&quot;15&quot; r=&quot;6&quot;&gt;&lt;/circle&gt;&lt;/marker&gt;&lt;/defs&gt;&lt;g&gt;&lt;text x=&quot;175&quot; y=&quot;93&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;75&quot; y1=&quot;100&quot; x2=&quot;275&quot; y2=&quot;100&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;128&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;ExecutionStarted&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;135&quot; x2=&quot;475&quot; y2=&quot;135&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;163&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;170&quot; x2=&quot;675&quot; y2=&quot;170&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;198&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;205&quot; x2=&quot;875&quot; y2=&quot;205&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;233&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Scheduled&lt;/text&gt;&lt;line x1=&quot;875&quot; y1=&quot;240&quot; x2=&quot;475&quot; y2=&quot;240&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;775&quot; y=&quot;268&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Task Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;275&quot; x2=&quot;1075&quot; y2=&quot;275&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1100&quot; y=&quot;285&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;36&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1096&quot; y=&quot;309&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;1116&quot;&gt;Throws Exception! &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;1096&quot; y=&quot;325&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;1116&quot;&gt;&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;349&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskFailed&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;356&quot; x2=&quot;275&quot; y2=&quot;356&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;384&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskFailed&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;391&quot; x2=&quot;475&quot; y2=&quot;391&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;419&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;426&quot; x2=&quot;675&quot; y2=&quot;426&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;500&quot; y=&quot;436&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;68&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;496&quot; y=&quot;460&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;516&quot;&gt;Error Handling &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;496&quot; y=&quot;476&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;516&quot;&gt; Runs  till &lt;/tspan&gt;&lt;/text&gt;&lt;text x=&quot;496&quot; y=&quot;492&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;516&quot;&gt;ScheduleWithRetry&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;532&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Timer Fired&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;539&quot; x2=&quot;275&quot; y2=&quot;539&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;375&quot; y=&quot;567&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Timer Fired&lt;/text&gt;&lt;line x1=&quot;275&quot; y1=&quot;574&quot; x2=&quot;475&quot; y2=&quot;574&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;575&quot; y=&quot;602&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;Orchestration Invoked&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;609&quot; x2=&quot;675&quot; y2=&quot;609&quot; class=&quot;messageLine0&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;text x=&quot;675&quot; y=&quot;637&quot; class=&quot;messageText&quot; style=&quot;text-anchor: middle;&quot;&gt;TaskScheduled&lt;/text&gt;&lt;line x1=&quot;475&quot; y1=&quot;644&quot; x2=&quot;875&quot; y2=&quot;644&quot; class=&quot;messageLine1&quot; stroke-width=&quot;2&quot; stroke=&quot;black&quot; marker-end=&quot;url(#arrowhead)&quot; style=&quot;stroke-dasharray: 3, 3; fill: none;&quot;&gt;&lt;/line&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;500&quot; y=&quot;654&quot; fill=&quot;#EDF2AE&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;36&quot; rx=&quot;0&quot; ry=&quot;0&quot; class=&quot;note&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;496&quot; y=&quot;678&quot; class=&quot;noteText&quot;&gt;&lt;tspan x=&quot;516&quot;&gt;Happy path restarts&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;0&quot; y=&quot;710&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;75&quot; y=&quot;742.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;75&quot; dy=&quot;0&quot;&gt;Client&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;200&quot; y=&quot;710&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;275&quot; y=&quot;742.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;275&quot; dy=&quot;0&quot;&gt;Orchestrator&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;400&quot; y=&quot;710&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;475&quot; y=&quot;742.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;475&quot; dy=&quot;0&quot;&gt;Hub&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;600&quot; y=&quot;710&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;675&quot; y=&quot;742.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;675&quot; dy=&quot;0&quot;&gt;TestOrchestration&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;800&quot; y=&quot;710&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;875&quot; y=&quot;742.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;875&quot; dy=&quot;0&quot;&gt;Worker&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;g&gt;&lt;rect x=&quot;1000&quot; y=&quot;710&quot; fill=&quot;#eaeaea&quot; stroke=&quot;#666&quot; width=&quot;150&quot; height=&quot;65&quot; rx=&quot;3&quot; ry=&quot;3&quot; class=&quot;actor&quot;&gt;&lt;/rect&gt;&lt;text x=&quot;1075&quot; y=&quot;742.5&quot; dominant-baseline=&quot;central&quot; alignment-baseline=&quot;central&quot; class=&quot;actor&quot; style=&quot;text-anchor: middle; font-size: 14px;&quot;&gt;&lt;tspan x=&quot;1075&quot; dy=&quot;0&quot;&gt;TaskActivity&lt;/tspan&gt;&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Running Dot Net Core outside MS ecosystem - 2]]></title><description><![CDATA[Dockerize the app Follow directions here As of writing, this pointed to images of dot net core v2.2. Replace it with 3.1 Create an asp.net…]]></description><link>https://abhikmitra.github.io/blog/dotnet-app2/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/dotnet-app2/</guid><pubDate>Mon, 13 Apr 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;Dockerize the app&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Follow directions &lt;a href=&quot;https://docs.docker.com/engine/examples/dotnetcore/&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;As of writing, this pointed to images of dot net core v2.2. Replace it with 3.1&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Create an asp.net core app&lt;/h3&gt;
&lt;p&gt;End State: &lt;a href=&quot;https://github.com/abhikmitra/dotnet-outside-ms/tree/1CreateApp&quot;&gt;The repo at the end of Part 1&lt;/a&gt;  &lt;/p&gt;</content:encoded></item><item><title><![CDATA[Running Dot Net Core outside MS ecosystem - 1]]></title><description><![CDATA[Create a Repo Using github for creating my repo , even though Github is a part of Microsoft , it still does not fall into my typical day to…]]></description><link>https://abhikmitra.github.io/blog/dotnet-app1/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/dotnet-app1/</guid><pubDate>Mon, 13 Apr 2020 18:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;Create a Repo&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Using github for creating my repo , even though Github is a part of Microsoft , it still does not fall into my typical day to day flow .&lt;/li&gt;
&lt;li&gt;As of writing, sadly I was not able to get a gitgnore in the list of github .gitignore so we will initialize the repo with just a readme&lt;/li&gt;
&lt;li&gt;You can find the repository &lt;a href=&quot;https://github.com/abhikmitra/dotnet-outside-ms&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Create an asp.net core app&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Clone the app&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-text line-numbers&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git clone git@github.com:abhikmitra/dotnet-outside-ms.git&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;I will be using Visual Studio 2019 as my preferred editor&lt;/li&gt;
&lt;li&gt;Our stack will be ASP.NET Core 3.1 on .NET Core so that it is cross platform. I will start of with a Simple API template.&lt;/li&gt;
&lt;li&gt;I am not selecting the the “Enable Docker Setup” as I want to do that myself. I have named the solution &lt;code class=&quot;language-text&quot;&gt;BackendApp&lt;/code&gt; and the project is &lt;code class=&quot;language-text&quot;&gt;BackendAPI&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Since Github doe snot have a .gitignore template for  dot net apps, we are gonna use this &lt;a href=&quot;https://raw.githubusercontent.com/OmniSharp/generator-aspnet/master/templates/gitignore.txt&quot;&gt;.gitignore&lt;/a&gt;. This might not be enough , we will see.&lt;/li&gt;
&lt;li&gt;The app is going to expose one endpoint called &lt;code class=&quot;language-text&quot;&gt;api/environment/iscontainerized&lt;/code&gt;. The controller checks for the environment variable “containerized” and returns if its true or false. If you run the app , it should return false.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;End State: &lt;a href=&quot;https://github.com/abhikmitra/dotnet-outside-ms/tree/1CreateApp&quot;&gt;The repo at the end of Part 1&lt;/a&gt;  &lt;/p&gt;</content:encoded></item><item><title><![CDATA[Hello World - Starting a new Blog Series]]></title><description><![CDATA[This is my first post on my blog! How exciting!  For the last few years, I have been building distributed systems in Dot Net. As a result, I…]]></description><link>https://abhikmitra.github.io/blog/hello-world/</link><guid isPermaLink="false">https://abhikmitra.github.io/blog/hello-world/</guid><pubDate>Sun, 12 Apr 2020 18:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This is my first post on my blog! How exciting! &lt;/p&gt;
&lt;p&gt;For the last few years, I have been building distributed systems in Dot Net. As a result, I live in the Microsoft ecosystem bubble of &lt;code class=&quot;language-text&quot;&gt;Azure&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Service Fabric&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Windows&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Azure DevOps&lt;/code&gt; , etc. &lt;/p&gt;
&lt;p&gt;With DotNet being open source and cross-platform, .NET core should work with all the OSS tech out there. This series will look at how we can build a DotNet app, make it talk to some of the leading OSS frameworks and build a polyglot app.&lt;/p&gt;
&lt;p&gt;And I want to do all of this without using anything from the typical dot net ecosystem other than the language itself. That means no Azure, no service fabric, etc.&lt;/p&gt;
&lt;p&gt;The primary aim for this series is for me to learn and some how documenting what I learn helps me grok things easily. Hope, some of you might benefit from this as well. &lt;/p&gt;</content:encoded></item></channel></rss>