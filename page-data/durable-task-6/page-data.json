{"componentChunkName":"component---src-templates-blog-post-js","path":"/durable-task-6/","result":{"data":{"site":{"siteMetadata":{"title":"Abhik's Blog"}},"markdownRemark":{"id":"f585c7aa-c8ad-535c-9998-b28b53927fea","excerpt":"Durable Task Framework Series This post is part 6 of a series of posts on DTF. Durable Task Framework Internals - Part 1 (Dataflow and Reliability) Durable Taskâ€¦","html":"<h3>Durable Task Framework Series</h3>\n<p>This post is <strong>part 6</strong> of a series of posts on DTF.</p>\n<ol>\n<li><a href=\"https://abhikmitra.github.io/blog/durable-task/\">Durable Task Framework Internals - Part 1 (Dataflow and Reliability)</a></li>\n<li><a href=\"https://abhikmitra.github.io/blog/durable-task-2/\">Durable Task Framework Internals - Part 2 (The curious case of Orchestrations)</a></li>\n<li><a href=\"https://abhikmitra.github.io/blog/durable-task-3/\">Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)</a></li>\n<li><a href=\"https://abhikmitra.github.io/blog/durable-task-4/\">Durable Task Framework Internals - Part 4 (Terminated Orchestrations &#x26; Middlewares)</a></li>\n<li><a href=\"https://abhikmitra.github.io/blog/durable-task-5/\">Durable Task Framework Internals - Part 5 (Interesting usages of TPL in DTF)</a></li>\n<li><a href=\"https://abhikmitra.github.io/blog/durable-task-5/\">Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)</a></li>\n</ol>\n<p>Do you think there is more that I should cover or something I should fix ? Please raise an <a href=\"https://github.com/abhikmitra/blog/issues\">issue</a> and let me know.</p>\n<hr>\n<p>In this post, we are going to go do a walk-through the code for DTF. This post would be helpful if you need to look under the covers. Instead of starting from scratch, you can go straight to the exciting part.</p>\n<div class=\"mermaid\" data-processed=\"true\"><svg id=\"mermaid-1599753988105\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" height=\"100%\" style=\"max-width:1250px;\" viewBox=\"-50 -10 1250 694\"><style>#mermaid-1599753988105 .label{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1599753988105 .label text{fill:#333}#mermaid-1599753988105 .node rect,#mermaid-1599753988105 .node circle,#mermaid-1599753988105 .node ellipse,#mermaid-1599753988105 .node polygon,#mermaid-1599753988105 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1599753988105 .node .label{text-align:center}#mermaid-1599753988105 .node.clickable{cursor:pointer}#mermaid-1599753988105 .arrowheadPath{fill:#333}#mermaid-1599753988105 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1599753988105 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1599753988105 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1599753988105 .cluster text{fill:#333}#mermaid-1599753988105 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1599753988105 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1599753988105 text.actor{fill:#000;stroke:none}#mermaid-1599753988105 .actor-line{stroke:grey}#mermaid-1599753988105 .messageLine0{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1599753988105 .messageLine1{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1599753988105 #arrowhead{fill:#333}#mermaid-1599753988105 .sequenceNumber{fill:#fff}#mermaid-1599753988105 #sequencenumber{fill:#333}#mermaid-1599753988105 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1599753988105 .messageText{fill:#333;stroke:none}#mermaid-1599753988105 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1599753988105 .labelText{fill:#000;stroke:none}#mermaid-1599753988105 .loopText{fill:#000;stroke:none}#mermaid-1599753988105 .loopLine{stroke-width:2;stroke-dasharray:'2 2';stroke:#ccf}#mermaid-1599753988105 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1599753988105 .noteText{fill:black;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1599753988105 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1599753988105 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1599753988105 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1599753988105 .mermaid-main-font{font-family:\"trebuchet ms\", verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 .section{stroke:none;opacity:0.2}#mermaid-1599753988105 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1599753988105 .section2{fill:#fff400}#mermaid-1599753988105 .section1,#mermaid-1599753988105 .section3{fill:#fff;opacity:0.2}#mermaid-1599753988105 .sectionTitle0{fill:#333}#mermaid-1599753988105 .sectionTitle1{fill:#333}#mermaid-1599753988105 .sectionTitle2{fill:#333}#mermaid-1599753988105 .sectionTitle3{fill:#333}#mermaid-1599753988105 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1599753988105 .grid .tick text{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 .grid path{stroke-width:0}#mermaid-1599753988105 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1599753988105 .task{stroke-width:2}#mermaid-1599753988105 .taskText{text-anchor:middle;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 .taskText:not([font-size]){font-size:11px}#mermaid-1599753988105 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1599753988105 .task.clickable{cursor:pointer}#mermaid-1599753988105 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1599753988105 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1599753988105 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1599753988105 .taskText0,#mermaid-1599753988105 .taskText1,#mermaid-1599753988105 .taskText2,#mermaid-1599753988105 .taskText3{fill:#fff}#mermaid-1599753988105 .task0,#mermaid-1599753988105 .task1,#mermaid-1599753988105 .task2,#mermaid-1599753988105 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1599753988105 .taskTextOutside0,#mermaid-1599753988105 .taskTextOutside2{fill:#000}#mermaid-1599753988105 .taskTextOutside1,#mermaid-1599753988105 .taskTextOutside3{fill:#000}#mermaid-1599753988105 .active0,#mermaid-1599753988105 .active1,#mermaid-1599753988105 .active2,#mermaid-1599753988105 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1599753988105 .activeText0,#mermaid-1599753988105 .activeText1,#mermaid-1599753988105 .activeText2,#mermaid-1599753988105 .activeText3{fill:#000 !important}#mermaid-1599753988105 .done0,#mermaid-1599753988105 .done1,#mermaid-1599753988105 .done2,#mermaid-1599753988105 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1599753988105 .doneText0,#mermaid-1599753988105 .doneText1,#mermaid-1599753988105 .doneText2,#mermaid-1599753988105 .doneText3{fill:#000 !important}#mermaid-1599753988105 .crit0,#mermaid-1599753988105 .crit1,#mermaid-1599753988105 .crit2,#mermaid-1599753988105 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1599753988105 .activeCrit0,#mermaid-1599753988105 .activeCrit1,#mermaid-1599753988105 .activeCrit2,#mermaid-1599753988105 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1599753988105 .doneCrit0,#mermaid-1599753988105 .doneCrit1,#mermaid-1599753988105 .doneCrit2,#mermaid-1599753988105 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1599753988105 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1599753988105 .milestoneText{font-style:italic}#mermaid-1599753988105 .doneCritText0,#mermaid-1599753988105 .doneCritText1,#mermaid-1599753988105 .doneCritText2,#mermaid-1599753988105 .doneCritText3{fill:#000 !important}#mermaid-1599753988105 .activeCritText0,#mermaid-1599753988105 .activeCritText1,#mermaid-1599753988105 .activeCritText2,#mermaid-1599753988105 .activeCritText3{fill:#000 !important}#mermaid-1599753988105 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 g.classGroup text{fill:#9370db;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1599753988105 g.classGroup text .title{font-weight:bolder}#mermaid-1599753988105 g.clickable{cursor:pointer}#mermaid-1599753988105 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1599753988105 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1599753988105 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1599753988105 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1599753988105 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1599753988105 .dashed-line{stroke-dasharray:3}#mermaid-1599753988105 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988105 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988105 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1599753988105 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1599753988105 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988105 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988105 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988105 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988105 .commit-id,#mermaid-1599753988105 .commit-msg,#mermaid-1599753988105 .branch-label{fill:lightgrey;color:lightgrey;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 .slice{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988105 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1599753988105 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1599753988105 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1599753988105 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1599753988105 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1599753988105 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1599753988105 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1599753988105 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1599753988105 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1599753988105 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1599753988105 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: '\"trebuchet ms\", verdana, arial';--mermaid-font-family: \"Comic Sans MS\", \"Comic Sans\", cursive}\n\n:root { --mermaid-font-family: \"trebuchet ms\", verdana, arial;}</style><style>#mermaid-1599753988105 {\n    color: rgb(0, 0, 0);\n    font: normal normal 400 normal 16px / normal \"trebuchet ms\", verdana, arial;\n  }</style><g></g><g><line id=\"actor0\" x1=\"75\" y1=\"5\" x2=\"75\" y2=\"683\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"0\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">main</tspan></text></g><g><line id=\"actor1\" x1=\"275\" y1=\"5\" x2=\"275\" y2=\"683\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"200\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">TaskHubWorker</tspan></text></g><g><line id=\"actor2\" x1=\"475\" y1=\"5\" x2=\"475\" y2=\"683\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"400\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"475\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"475\" dy=\"0\">ServiceBusOrchestrationService</tspan></text></g><g><line id=\"actor3\" x1=\"675\" y1=\"5\" x2=\"675\" y2=\"683\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"600\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"675\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"675\" dy=\"0\">TaskOrchestrationDispatcher</tspan></text></g><g><line id=\"actor4\" x1=\"875\" y1=\"5\" x2=\"875\" y2=\"683\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"800\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"875\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"875\" dy=\"0\">TaskActivityDispatcher</tspan></text></g><g><line id=\"actor5\" x1=\"1075\" y1=\"5\" x2=\"1075\" y2=\"683\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"1000\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"1075\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"1075\" dy=\"0\">WorkItemDispatcher</tspan></text></g><defs><marker id=\"arrowhead\" refX=\"5\" refY=\"2\" markerWidth=\"6\" markerHeight=\"4\" orient=\"auto\"><path d=\"M 0,0 V 4 L6,2 Z\"></path></marker></defs><defs><marker id=\"crosshead\" markerWidth=\"15\" markerHeight=\"8\" orient=\"auto\" refX=\"16\" refY=\"4\"><path fill=\"black\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 9,2 V 6 L16,4 Z\" style=\"stroke-dasharray: 0, 0;\"></path><path fill=\"none\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 0,1 L 6,7 M 6,1 L 0,7\" style=\"stroke-dasharray: 0, 0;\"></path></marker></defs><defs><marker id=\"sequencenumber\" refX=\"15\" refY=\"15\" markerWidth=\"60\" markerHeight=\"40\" orient=\"auto\"><circle cx=\"15\" cy=\"15\" r=\"6\"></circle></marker></defs><g><text x=\"275\" y=\"93\" class=\"messageText\" style=\"text-anchor: middle;\">Create New Instance</text><line x1=\"75\" y1=\"100\" x2=\"475\" y2=\"100\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"775\" y=\"128\" class=\"messageText\" style=\"text-anchor: middle;\">Create New Instance</text><line x1=\"475\" y1=\"135\" x2=\"1075\" y2=\"135\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"175\" y=\"163\" class=\"messageText\" style=\"text-anchor: middle;\">StartAsync()</text><line x1=\"75\" y1=\"170\" x2=\"275\" y2=\"170\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"475\" y=\"198\" class=\"messageText\" style=\"text-anchor: middle;\">Create New Instance</text><line x1=\"275\" y1=\"205\" x2=\"675\" y2=\"205\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"875\" y=\"233\" class=\"messageText\" style=\"text-anchor: middle;\">Create New Instance</text><line x1=\"675\" y1=\"240\" x2=\"1075\" y2=\"240\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"575\" y=\"268\" class=\"messageText\" style=\"text-anchor: middle;\">Create New Instance</text><line x1=\"275\" y1=\"275\" x2=\"875\" y2=\"275\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"975\" y=\"303\" class=\"messageText\" style=\"text-anchor: middle;\">Create New Instance</text><line x1=\"875\" y1=\"310\" x2=\"1075\" y2=\"310\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"375\" y=\"338\" class=\"messageText\" style=\"text-anchor: middle;\">StartAsync()</text><line x1=\"275\" y1=\"345\" x2=\"475\" y2=\"345\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><rect x=\"1000\" y=\"355\" fill=\"#EDF2AE\" stroke=\"#666\" width=\"150\" height=\"68\" rx=\"0\" ry=\"0\" class=\"note\"></rect><text x=\"996\" y=\"379\" class=\"noteText\"><tspan x=\"1016\">3 instances of </tspan></text><text x=\"996\" y=\"395\" class=\"noteText\"><tspan x=\"1016\"> WorkItemDIspatcher</tspan></text><text x=\"996\" y=\"411\" class=\"noteText\"><tspan x=\"1016\"> is created</tspan></text></g><g><text x=\"775\" y=\"451\" class=\"messageText\" style=\"text-anchor: middle;\">StartAsync()</text><line x1=\"475\" y1=\"458\" x2=\"1075\" y2=\"458\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"475\" y=\"486\" class=\"messageText\" style=\"text-anchor: middle;\">StartAsync()</text><line x1=\"275\" y1=\"493\" x2=\"675\" y2=\"493\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"875\" y=\"521\" class=\"messageText\" style=\"text-anchor: middle;\">StartAsync()</text><line x1=\"675\" y1=\"528\" x2=\"1075\" y2=\"528\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"575\" y=\"556\" class=\"messageText\" style=\"text-anchor: middle;\">StartAsync()</text><line x1=\"275\" y1=\"563\" x2=\"875\" y2=\"563\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"975\" y=\"591\" class=\"messageText\" style=\"text-anchor: middle;\">StartAsync()</text><line x1=\"875\" y1=\"598\" x2=\"1075\" y2=\"598\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><rect x=\"0\" y=\"618\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"650.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">main</tspan></text></g><g><rect x=\"200\" y=\"618\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"650.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">TaskHubWorker</tspan></text></g><g><rect x=\"400\" y=\"618\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"475\" y=\"650.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"475\" dy=\"0\">ServiceBusOrchestrationService</tspan></text></g><g><rect x=\"600\" y=\"618\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"675\" y=\"650.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"675\" dy=\"0\">TaskOrchestrationDispatcher</tspan></text></g><g><rect x=\"800\" y=\"618\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"875\" y=\"650.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"875\" dy=\"0\">TaskActivityDispatcher</tspan></text></g><g><rect x=\"1000\" y=\"618\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"1075\" y=\"650.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"1075\" dy=\"0\">WorkItemDispatcher</tspan></text></g></svg></div>\n<p>So whats happening here is , there are 3 interesting classes that get created</p>\n<ol>\n<li>ServiceBusOrchestrationService - Monitors the tracker Queue</li>\n<li>TaskOrchestrationDispatcher - Monitors Orchestrator Queue</li>\n<li>TaskActivityDispatcher - Monitors Worker Queue</li>\n</ol>\n<p>When you finally start the hub using <code class=\"language-text\">StartAsync</code>, all of these classes create their own  <code class=\"language-text\">WorkItemDispatcher</code> which is the starting point for all messages that your Receive.\nWorkItem dispatcher has a while loop that keeps polling the respective QueueClient for new messages. So we have 3 WorkItemDispatchers polling three queues at regular intervals.\nWhenever it gets any message, it creates a <em>new thread</em> and passes it off, back to the respective dispatchers</p>\n<div class=\"mermaid\" data-processed=\"true\"><svg id=\"mermaid-1599753988090\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" height=\"100%\" style=\"max-width:1650px;\" viewBox=\"-50 -10 1650 538\"><style>#mermaid-1599753988090 .label{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1599753988090 .label text{fill:#333}#mermaid-1599753988090 .node rect,#mermaid-1599753988090 .node circle,#mermaid-1599753988090 .node ellipse,#mermaid-1599753988090 .node polygon,#mermaid-1599753988090 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1599753988090 .node .label{text-align:center}#mermaid-1599753988090 .node.clickable{cursor:pointer}#mermaid-1599753988090 .arrowheadPath{fill:#333}#mermaid-1599753988090 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1599753988090 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1599753988090 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1599753988090 .cluster text{fill:#333}#mermaid-1599753988090 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1599753988090 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1599753988090 text.actor{fill:#000;stroke:none}#mermaid-1599753988090 .actor-line{stroke:grey}#mermaid-1599753988090 .messageLine0{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1599753988090 .messageLine1{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1599753988090 #arrowhead{fill:#333}#mermaid-1599753988090 .sequenceNumber{fill:#fff}#mermaid-1599753988090 #sequencenumber{fill:#333}#mermaid-1599753988090 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1599753988090 .messageText{fill:#333;stroke:none}#mermaid-1599753988090 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1599753988090 .labelText{fill:#000;stroke:none}#mermaid-1599753988090 .loopText{fill:#000;stroke:none}#mermaid-1599753988090 .loopLine{stroke-width:2;stroke-dasharray:'2 2';stroke:#ccf}#mermaid-1599753988090 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1599753988090 .noteText{fill:black;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1599753988090 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1599753988090 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1599753988090 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1599753988090 .mermaid-main-font{font-family:\"trebuchet ms\", verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 .section{stroke:none;opacity:0.2}#mermaid-1599753988090 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1599753988090 .section2{fill:#fff400}#mermaid-1599753988090 .section1,#mermaid-1599753988090 .section3{fill:#fff;opacity:0.2}#mermaid-1599753988090 .sectionTitle0{fill:#333}#mermaid-1599753988090 .sectionTitle1{fill:#333}#mermaid-1599753988090 .sectionTitle2{fill:#333}#mermaid-1599753988090 .sectionTitle3{fill:#333}#mermaid-1599753988090 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1599753988090 .grid .tick text{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 .grid path{stroke-width:0}#mermaid-1599753988090 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1599753988090 .task{stroke-width:2}#mermaid-1599753988090 .taskText{text-anchor:middle;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 .taskText:not([font-size]){font-size:11px}#mermaid-1599753988090 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1599753988090 .task.clickable{cursor:pointer}#mermaid-1599753988090 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1599753988090 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1599753988090 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1599753988090 .taskText0,#mermaid-1599753988090 .taskText1,#mermaid-1599753988090 .taskText2,#mermaid-1599753988090 .taskText3{fill:#fff}#mermaid-1599753988090 .task0,#mermaid-1599753988090 .task1,#mermaid-1599753988090 .task2,#mermaid-1599753988090 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1599753988090 .taskTextOutside0,#mermaid-1599753988090 .taskTextOutside2{fill:#000}#mermaid-1599753988090 .taskTextOutside1,#mermaid-1599753988090 .taskTextOutside3{fill:#000}#mermaid-1599753988090 .active0,#mermaid-1599753988090 .active1,#mermaid-1599753988090 .active2,#mermaid-1599753988090 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1599753988090 .activeText0,#mermaid-1599753988090 .activeText1,#mermaid-1599753988090 .activeText2,#mermaid-1599753988090 .activeText3{fill:#000 !important}#mermaid-1599753988090 .done0,#mermaid-1599753988090 .done1,#mermaid-1599753988090 .done2,#mermaid-1599753988090 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1599753988090 .doneText0,#mermaid-1599753988090 .doneText1,#mermaid-1599753988090 .doneText2,#mermaid-1599753988090 .doneText3{fill:#000 !important}#mermaid-1599753988090 .crit0,#mermaid-1599753988090 .crit1,#mermaid-1599753988090 .crit2,#mermaid-1599753988090 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1599753988090 .activeCrit0,#mermaid-1599753988090 .activeCrit1,#mermaid-1599753988090 .activeCrit2,#mermaid-1599753988090 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1599753988090 .doneCrit0,#mermaid-1599753988090 .doneCrit1,#mermaid-1599753988090 .doneCrit2,#mermaid-1599753988090 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1599753988090 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1599753988090 .milestoneText{font-style:italic}#mermaid-1599753988090 .doneCritText0,#mermaid-1599753988090 .doneCritText1,#mermaid-1599753988090 .doneCritText2,#mermaid-1599753988090 .doneCritText3{fill:#000 !important}#mermaid-1599753988090 .activeCritText0,#mermaid-1599753988090 .activeCritText1,#mermaid-1599753988090 .activeCritText2,#mermaid-1599753988090 .activeCritText3{fill:#000 !important}#mermaid-1599753988090 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 g.classGroup text{fill:#9370db;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1599753988090 g.classGroup text .title{font-weight:bolder}#mermaid-1599753988090 g.clickable{cursor:pointer}#mermaid-1599753988090 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1599753988090 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1599753988090 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1599753988090 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1599753988090 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1599753988090 .dashed-line{stroke-dasharray:3}#mermaid-1599753988090 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988090 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988090 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1599753988090 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1599753988090 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988090 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988090 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988090 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1599753988090 .commit-id,#mermaid-1599753988090 .commit-msg,#mermaid-1599753988090 .branch-label{fill:lightgrey;color:lightgrey;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 .slice{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1599753988090 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1599753988090 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1599753988090 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1599753988090 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1599753988090 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1599753988090 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1599753988090 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1599753988090 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1599753988090 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1599753988090 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1599753988090 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: '\"trebuchet ms\", verdana, arial';--mermaid-font-family: \"Comic Sans MS\", \"Comic Sans\", cursive}\n\n:root { --mermaid-font-family: \"trebuchet ms\", verdana, arial;}</style><style>#mermaid-1599753988090 {\n    color: rgb(0, 0, 0);\n    font: normal normal 400 normal 16px / normal \"trebuchet ms\", verdana, arial;\n  }</style><g></g><g><line id=\"actor0\" x1=\"75\" y1=\"5\" x2=\"75\" y2=\"527\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"0\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">WorkItemDispatcher</tspan></text></g><g><line id=\"actor1\" x1=\"275\" y1=\"5\" x2=\"275\" y2=\"527\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"200\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">TaskOrchestrationDispatcher</tspan></text></g><g><line id=\"actor2\" x1=\"475\" y1=\"5\" x2=\"475\" y2=\"527\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"400\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"475\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"475\" dy=\"0\">TaskOrchestrationExecutor</tspan></text></g><g><line id=\"actor3\" x1=\"675\" y1=\"5\" x2=\"675\" y2=\"527\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"600\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"675\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"675\" dy=\"0\">TaskActivityDispatcher</tspan></text></g><g><line id=\"actor4\" x1=\"875\" y1=\"5\" x2=\"875\" y2=\"527\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"800\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"875\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"875\" dy=\"0\">TaskOrchestrationContext</tspan></text></g><g><line id=\"actor5\" x1=\"1075\" y1=\"5\" x2=\"1075\" y2=\"527\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"1000\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"1075\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"1075\" dy=\"0\">DispatchMiddlewarePipeline</tspan></text></g><g><line id=\"actor6\" x1=\"1275\" y1=\"5\" x2=\"1275\" y2=\"527\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"1200\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"1275\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"1275\" dy=\"0\">TaskOrchestration</tspan></text></g><g><line id=\"actor7\" x1=\"1475\" y1=\"5\" x2=\"1475\" y2=\"527\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"1400\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"1475\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"1475\" dy=\"0\">Testorchestration</tspan></text></g><defs><marker id=\"arrowhead\" refX=\"5\" refY=\"2\" markerWidth=\"6\" markerHeight=\"4\" orient=\"auto\"><path d=\"M 0,0 V 4 L6,2 Z\"></path></marker></defs><defs><marker id=\"crosshead\" markerWidth=\"15\" markerHeight=\"8\" orient=\"auto\" refX=\"16\" refY=\"4\"><path fill=\"black\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 9,2 V 6 L16,4 Z\" style=\"stroke-dasharray: 0, 0;\"></path><path fill=\"none\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 0,1 L 6,7 M 6,1 L 0,7\" style=\"stroke-dasharray: 0, 0;\"></path></marker></defs><defs><marker id=\"sequencenumber\" refX=\"15\" refY=\"15\" markerWidth=\"60\" markerHeight=\"40\" orient=\"auto\"><circle cx=\"15\" cy=\"15\" r=\"6\"></circle></marker></defs><g><text x=\"175\" y=\"93\" class=\"messageText\" style=\"text-anchor: middle;\">OnProcessWorkItemSessionAsync</text><line x1=\"75\" y1=\"100\" x2=\"275\" y2=\"100\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"375\" y=\"128\" class=\"messageText\" style=\"text-anchor: middle;\">Create new Instance</text><line x1=\"275\" y1=\"135\" x2=\"475\" y2=\"135\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"675\" y=\"163\" class=\"messageText\" style=\"text-anchor: middle;\">Creates new instance</text><line x1=\"475\" y1=\"170\" x2=\"875\" y2=\"170\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"675\" y=\"198\" class=\"messageText\" style=\"text-anchor: middle;\">Executes the Middlewares</text><line x1=\"275\" y1=\"205\" x2=\"1075\" y2=\"205\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"675\" y=\"233\" class=\"messageText\" style=\"text-anchor: middle;\">Middlewares have reached the next() call</text><line x1=\"1075\" y1=\"240\" x2=\"275\" y2=\"240\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"375\" y=\"268\" class=\"messageText\" style=\"text-anchor: middle;\">Execute() - Not awaited</text><line x1=\"275\" y1=\"275\" x2=\"475\" y2=\"275\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><rect x=\"400\" y=\"285\" fill=\"#EDF2AE\" stroke=\"#666\" width=\"150\" height=\"52\" rx=\"0\" ry=\"0\" class=\"note\"></rect><text x=\"396\" y=\"309\" class=\"noteText\"><tspan x=\"416\">This is where </tspan></text><text x=\"396\" y=\"325\" class=\"noteText\"><tspan x=\"416\"> most of the logic is</tspan></text></g><g><text x=\"875\" y=\"365\" class=\"messageText\" style=\"text-anchor: middle;\">Execute()</text><line x1=\"475\" y1=\"372\" x2=\"1275\" y2=\"372\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"1375\" y=\"400\" class=\"messageText\" style=\"text-anchor: middle;\">RunTask</text><line x1=\"1275\" y1=\"407\" x2=\"1475\" y2=\"407\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"375\" y=\"435\" class=\"messageText\" style=\"text-anchor: middle;\">Decisions</text><line x1=\"475\" y1=\"442\" x2=\"275\" y2=\"442\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><rect x=\"0\" y=\"462\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"494.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">WorkItemDispatcher</tspan></text></g><g><rect x=\"200\" y=\"462\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"494.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">TaskOrchestrationDispatcher</tspan></text></g><g><rect x=\"400\" y=\"462\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"475\" y=\"494.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"475\" dy=\"0\">TaskOrchestrationExecutor</tspan></text></g><g><rect x=\"600\" y=\"462\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"675\" y=\"494.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"675\" dy=\"0\">TaskActivityDispatcher</tspan></text></g><g><rect x=\"800\" y=\"462\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"875\" y=\"494.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"875\" dy=\"0\">TaskOrchestrationContext</tspan></text></g><g><rect x=\"1000\" y=\"462\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"1075\" y=\"494.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"1075\" dy=\"0\">DispatchMiddlewarePipeline</tspan></text></g><g><rect x=\"1200\" y=\"462\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"1275\" y=\"494.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"1275\" dy=\"0\">TaskOrchestration</tspan></text></g><g><rect x=\"1400\" y=\"462\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"1475\" y=\"494.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"1475\" dy=\"0\">Testorchestration</tspan></text></g></svg></div>\n<p>So the TaskOrchestrationExecutor is where most of the magic happens. It has multiple responsibilities.</p>\n<ol>\n<li>Sets the SynchronizationContext</li>\n<li>Checks the event history and uses it to build up the current state of the orchestration.</li>\n<li>Figures out if the orchestration has already been terminated.</li>\n<li>Has various functions for handling different types of Orchestration start cases like <code class=\"language-text\">TaskScheduled</code>, <code class=\"language-text\">TaskScheduled</code>, <code class=\"language-text\">SubOrchestrationInstanceCompleted</code> etc.</li>\n<li>Handles Orchestration failures. </li>\n</ol>\n<p>When the TestOrchestration is invoked, all the calls to context (SchedulerWithRetry , timer, etc) get stored as an element in an array called decisions. The decision array is the messages that need to be put into the various Queues. The Dispatcher queues them back and marks the orchestration as complete.\nThis is the full flow right from the hub getting the message to executing it, figuring out the actions, and queueing them back.</p>","frontmatter":{"title":"Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)","date":"April 27, 2020","description":"In this part, we look at the code flow in DTF on how an orchestration gets executed and invokes the tasks "}}},"pageContext":{"slug":"/durable-task-6/","previous":{"fields":{"slug":"/durable-task-5/"},"frontmatter":{"title":"Durable Task Framework Internals - Part 5 (Interesting usages of TPL in DTF)"}},"next":{"fields":{"slug":"/event-hub/"},"frontmatter":{"title":"Azure Event Hub SDK Internals - Part 1 (Overview & Control Flow)"}}}},"staticQueryHashes":["1246554614","919801753"]}