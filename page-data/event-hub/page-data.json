{"componentChunkName":"component---src-templates-blog-post-js","path":"/event-hub/","result":{"data":{"site":{"siteMetadata":{"title":"Abhik's Blog"}},"markdownRemark":{"id":"8a680f41-f8ba-53ee-b13d-758b8a72fbad","excerpt":"Azure Event Hub SDK Series This post is part 1 of a series of posts on Azure Event Hub SDK for Dot NET. Azure Event Hub SDK Internals - Part 1 (Overviewâ€¦","html":"<h2>Azure Event Hub SDK Series</h2>\n<p>This post is <strong>part 1</strong> of a series of posts on Azure Event Hub SDK for Dot NET.</p>\n<ol>\n<li><a href=\"https://abhikmitra.github.io/blog/event-hub/\">Azure Event Hub SDK Internals - Part 1 (Overview &#x26; Control Flow)</a></li>\n<li><a href=\"https://abhikmitra.github.io/blog/event-hub-2/\">Azure Event Hub SDK Internals - Part 2 (Partition Manager &#x26; Lease Management)</a></li>\n<li><a href=\"https://abhikmitra.github.io/blog/event-hub-3/\">Azure Event Hub SDK Internals - Part 3 (Pumping Data &#x26; AMQP Links)</a>\nDo you think there is more that I should cover or something I should fix ? Please raise an <a href=\"https://github.com/abhikmitra/blog/issues\">issue</a> and let me know.</li>\n</ol>\n<hr>\n<p>Azure Event Hubs is a big data streaming platform and event ingestion service. It can receive and process millions of events per second. Data sent to an event hub can be transformed and stored by using any real-time analytics provider or batching/storage adapters. You can read more about Event Hubs <a href=\"https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about\">here</a></p>\n<p>The series focusses on <a href=\"https://www.nuget.org/packages/Microsoft.Azure.EventHubs/\">Microsoft.Azure.EventHubs</a> SDK - v4.2. This maps to <a href=\"https://github.com/Azure/azure-sdk-for-net\">Azure SDK for net</a> commit Id <code class=\"language-text\">00d8f23cffe22afb0e574909039556d8ca891be9</code></p>\n<h2>Event processor</h2>\n<p>We will focus on the Event Hub Processor since that is the part which deals with checkpointing , leasing , etc. </p>\n<p>There are 2 broad steps to receiving an event and we will dive into the details of each of the areas.</p>\n<h3>RegisterEventProcessorAsync - Initialization</h3>\n<p>Here is a typical code that you would use for registering an event processor.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\"><span class=\"token keyword\">var</span> eventProcessorHost <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventProcessorHost</span><span class=\"token punctuation\">(</span>\n                EventHubName<span class=\"token punctuation\">,</span>\n                PartitionReceiver<span class=\"token punctuation\">.</span>DefaultConsumerGroupName<span class=\"token punctuation\">,</span>\n                EventHubConnectionString<span class=\"token punctuation\">,</span>\n                StorageConnectionString<span class=\"token punctuation\">,</span>\n                StorageContainerName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Registers the Event Processor Host and starts receiving messages</span>\n<span class=\"token keyword\">await</span> eventProcessorHost<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">RegisterEventProcessorAsync</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SimpleEventProcessor</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here is what happens as a part of the registration.</p>\n<ul>\n<li>An Azure Storage CloudBlobClient is created with max execution time of 2 minutes.</li>\n<li>The PartitionManager is started which initializes the blob store.</li>\n<li>As a part of the initialization, first, it checks if the container exists.</li>\n<li>If not it will create the Azure blob container.</li>\n<li>Then it gets the run time information through an AMQP request to the Event Hub.</li>\n<li>The run time information has the partition count and partition ids.</li>\n<li>The response of the AMQP request looks like <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/922f134cd28d52d54541aaa8e5fdaa47/9cea8/GetRuntimeInformation.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAkklEQVQY033LSwuCQBSG4fn//6V1N1u1bxNSBkFCi8isM+OoY46+mRAt0j54OIdzUU0LtW8G+W5Zuoo0vWNtjs0LtMkQbb5VZ713L2JQ9GlHgK9KzvGJxy0hN9KNPf+igkgTRDJoddAswoTJesd0EzPfXpiFab9bjvyou3Xo0iNF/cO4hqtYwv2RzHnss0VGbj9ezAEvjK4biQQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"this\"\n        title=\"this\"\n        src=\"/blog/static/922f134cd28d52d54541aaa8e5fdaa47/fcda8/GetRuntimeInformation.png\"\n        srcset=\"/blog/static/922f134cd28d52d54541aaa8e5fdaa47/12f09/GetRuntimeInformation.png 148w,\n/blog/static/922f134cd28d52d54541aaa8e5fdaa47/e4a3f/GetRuntimeInformation.png 295w,\n/blog/static/922f134cd28d52d54541aaa8e5fdaa47/fcda8/GetRuntimeInformation.png 590w,\n/blog/static/922f134cd28d52d54541aaa8e5fdaa47/efc66/GetRuntimeInformation.png 885w,\n/blog/static/922f134cd28d52d54541aaa8e5fdaa47/c83ae/GetRuntimeInformation.png 1180w,\n/blog/static/922f134cd28d52d54541aaa8e5fdaa47/9cea8/GetRuntimeInformation.png 1278w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>\n<p>It extracts the Partition Ids and then create the leases for each of the partitions.</p>\n<ul>\n<li>The blobs get created under <code class=\"language-text\">&lt;containername&gt;/$Default/&lt;PartitonName&gt;</code></li>\n<li>\n<p>The blob contents are </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\">    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"Offset\"</span><span class=\"token operator\">:</span><span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"SequenceNumber\"</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"PartitionId\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Owner\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Token\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Epoch\"</span><span class=\"token operator\">:</span><span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n</li>\n<li>Verify the checkpoint store exists. In this library checkpoints store is same as the lease store. So checkpoint operations turn into lease operations under the covers. Read the comment in the code <a href=\"https://github.com/Azure/azure-sdk-for-net/blob/5e30a0ca3873d54a310924925e35043dd9f3b6a0/sdk/eventhub/Microsoft.Azure.EventHubs.Processor/src/AzureStorageCheckpointLeaseManager.cs#L106\">here</a></li>\n<li>Similar to leases, it checks for the existence of checkpoints. Since it is the same as leases, it is marked as a no-op.</li>\n</ul>\n<div class=\"mermaid\" data-processed=\"true\"><svg id=\"mermaid-1590434673865\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" height=\"100%\" style=\"max-width:850px;\" viewBox=\"-50 -10 850 441\"><style>#mermaid-1590434673865 .label{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590434673865 .label text{fill:#333}#mermaid-1590434673865 .node rect,#mermaid-1590434673865 .node circle,#mermaid-1590434673865 .node ellipse,#mermaid-1590434673865 .node polygon,#mermaid-1590434673865 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590434673865 .node .label{text-align:center}#mermaid-1590434673865 .node.clickable{cursor:pointer}#mermaid-1590434673865 .arrowheadPath{fill:#333}#mermaid-1590434673865 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590434673865 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590434673865 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590434673865 .cluster text{fill:#333}#mermaid-1590434673865 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590434673865 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590434673865 text.actor{fill:#000;stroke:none}#mermaid-1590434673865 .actor-line{stroke:grey}#mermaid-1590434673865 .messageLine0{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1590434673865 .messageLine1{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1590434673865 #arrowhead{fill:#333}#mermaid-1590434673865 .sequenceNumber{fill:#fff}#mermaid-1590434673865 #sequencenumber{fill:#333}#mermaid-1590434673865 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590434673865 .messageText{fill:#333;stroke:none}#mermaid-1590434673865 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590434673865 .labelText{fill:#000;stroke:none}#mermaid-1590434673865 .loopText{fill:#000;stroke:none}#mermaid-1590434673865 .loopLine{stroke-width:2;stroke-dasharray:'2 2';stroke:#ccf}#mermaid-1590434673865 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590434673865 .noteText{fill:black;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590434673865 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590434673865 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590434673865 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590434673865 .mermaid-main-font{font-family:\"trebuchet ms\", verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .section{stroke:none;opacity:0.2}#mermaid-1590434673865 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590434673865 .section2{fill:#fff400}#mermaid-1590434673865 .section1,#mermaid-1590434673865 .section3{fill:#fff;opacity:0.2}#mermaid-1590434673865 .sectionTitle0{fill:#333}#mermaid-1590434673865 .sectionTitle1{fill:#333}#mermaid-1590434673865 .sectionTitle2{fill:#333}#mermaid-1590434673865 .sectionTitle3{fill:#333}#mermaid-1590434673865 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590434673865 .grid .tick text{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .grid path{stroke-width:0}#mermaid-1590434673865 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590434673865 .task{stroke-width:2}#mermaid-1590434673865 .taskText{text-anchor:middle;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .taskText:not([font-size]){font-size:11px}#mermaid-1590434673865 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590434673865 .task.clickable{cursor:pointer}#mermaid-1590434673865 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673865 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673865 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673865 .taskText0,#mermaid-1590434673865 .taskText1,#mermaid-1590434673865 .taskText2,#mermaid-1590434673865 .taskText3{fill:#fff}#mermaid-1590434673865 .task0,#mermaid-1590434673865 .task1,#mermaid-1590434673865 .task2,#mermaid-1590434673865 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590434673865 .taskTextOutside0,#mermaid-1590434673865 .taskTextOutside2{fill:#000}#mermaid-1590434673865 .taskTextOutside1,#mermaid-1590434673865 .taskTextOutside3{fill:#000}#mermaid-1590434673865 .active0,#mermaid-1590434673865 .active1,#mermaid-1590434673865 .active2,#mermaid-1590434673865 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590434673865 .activeText0,#mermaid-1590434673865 .activeText1,#mermaid-1590434673865 .activeText2,#mermaid-1590434673865 .activeText3{fill:#000 !important}#mermaid-1590434673865 .done0,#mermaid-1590434673865 .done1,#mermaid-1590434673865 .done2,#mermaid-1590434673865 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590434673865 .doneText0,#mermaid-1590434673865 .doneText1,#mermaid-1590434673865 .doneText2,#mermaid-1590434673865 .doneText3{fill:#000 !important}#mermaid-1590434673865 .crit0,#mermaid-1590434673865 .crit1,#mermaid-1590434673865 .crit2,#mermaid-1590434673865 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590434673865 .activeCrit0,#mermaid-1590434673865 .activeCrit1,#mermaid-1590434673865 .activeCrit2,#mermaid-1590434673865 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590434673865 .doneCrit0,#mermaid-1590434673865 .doneCrit1,#mermaid-1590434673865 .doneCrit2,#mermaid-1590434673865 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590434673865 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590434673865 .milestoneText{font-style:italic}#mermaid-1590434673865 .doneCritText0,#mermaid-1590434673865 .doneCritText1,#mermaid-1590434673865 .doneCritText2,#mermaid-1590434673865 .doneCritText3{fill:#000 !important}#mermaid-1590434673865 .activeCritText0,#mermaid-1590434673865 .activeCritText1,#mermaid-1590434673865 .activeCritText2,#mermaid-1590434673865 .activeCritText3{fill:#000 !important}#mermaid-1590434673865 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 g.classGroup text{fill:#9370db;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590434673865 g.classGroup text .title{font-weight:bolder}#mermaid-1590434673865 g.clickable{cursor:pointer}#mermaid-1590434673865 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590434673865 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590434673865 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590434673865 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590434673865 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590434673865 .dashed-line{stroke-dasharray:3}#mermaid-1590434673865 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 .commit-id,#mermaid-1590434673865 .commit-msg,#mermaid-1590434673865 .branch-label{fill:lightgrey;color:lightgrey;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .slice{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590434673865 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590434673865 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590434673865 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590434673865 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590434673865 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590434673865 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590434673865 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590434673865 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590434673865 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590434673865 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: '\"trebuchet ms\", verdana, arial';--mermaid-font-family: \"Comic Sans MS\", \"Comic Sans\", cursive}\n\n:root { --mermaid-font-family: \"trebuchet ms\", verdana, arial;}</style><style>#mermaid-1590434673865 {\n    color: rgb(0, 0, 0);\n    font: normal normal 400 normal 16px / normal \"trebuchet ms\", verdana, arial;\n  }</style><g></g><g><line id=\"actor0\" x1=\"75\" y1=\"5\" x2=\"75\" y2=\"430\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"0\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">Main()</tspan></text></g><g><line id=\"actor1\" x1=\"275\" y1=\"5\" x2=\"275\" y2=\"430\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"200\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">EventProcessorHost</tspan></text></g><g><line id=\"actor2\" x1=\"475\" y1=\"5\" x2=\"475\" y2=\"430\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"400\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"475\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"475\" dy=\"0\">Azure Blob Storage</tspan></text></g><g><line id=\"actor3\" x1=\"675\" y1=\"5\" x2=\"675\" y2=\"430\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"600\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"675\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"675\" dy=\"0\">EventHub</tspan></text></g><defs><marker id=\"arrowhead\" refX=\"5\" refY=\"2\" markerWidth=\"6\" markerHeight=\"4\" orient=\"auto\"><path d=\"M 0,0 V 4 L6,2 Z\"></path></marker></defs><defs><marker id=\"crosshead\" markerWidth=\"15\" markerHeight=\"8\" orient=\"auto\" refX=\"16\" refY=\"4\"><path fill=\"black\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 9,2 V 6 L16,4 Z\" style=\"stroke-dasharray: 0, 0;\"></path><path fill=\"none\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 0,1 L 6,7 M 6,1 L 0,7\" style=\"stroke-dasharray: 0, 0;\"></path></marker></defs><defs><marker id=\"sequencenumber\" refX=\"15\" refY=\"15\" markerWidth=\"60\" markerHeight=\"40\" orient=\"auto\"><circle cx=\"15\" cy=\"15\" r=\"6\"></circle></marker></defs><g><text x=\"175\" y=\"93\" class=\"messageText\" style=\"text-anchor: middle;\">RegisterEventProcessorAsync</text><line x1=\"75\" y1=\"100\" x2=\"275\" y2=\"100\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><text x=\"375\" y=\"128\" class=\"messageText\" style=\"text-anchor: middle;\">Check If Container Exists for leases</text><line x1=\"275\" y1=\"135\" x2=\"475\" y2=\"135\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"475\" y=\"163\" class=\"messageText\" style=\"text-anchor: middle;\">AMQP: Gets Runtime Information</text><line x1=\"275\" y1=\"170\" x2=\"675\" y2=\"170\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"375\" y=\"223\" class=\"messageText\" style=\"text-anchor: middle;\">Create Lease for Partition 0</text><line x1=\"275\" y1=\"230\" x2=\"475\" y2=\"230\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"375\" y=\"258\" class=\"messageText\" style=\"text-anchor: middle;\">Create Lease for Partition 1</text><line x1=\"275\" y1=\"265\" x2=\"475\" y2=\"265\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><line x1=\"265\" y1=\"180\" x2=\"485\" y2=\"180\" class=\"loopLine\"></line><line x1=\"485\" y1=\"180\" x2=\"485\" y2=\"275\" class=\"loopLine\"></line><line x1=\"265\" y1=\"275\" x2=\"485\" y2=\"275\" class=\"loopLine\"></line><line x1=\"265\" y1=\"180\" x2=\"265\" y2=\"275\" class=\"loopLine\"></line><polygon points=\"265,180 315,180 315,193 306.6,200 265,200\" class=\"labelBox\"></polygon><text x=\"272.5\" y=\"195\" class=\"labelText\"><tspan x=\"272.5\">loop</tspan></text><text x=\"375\" y=\"195\" class=\"loopText\" style=\"text-anchor: middle;\"><tspan x=\"375\">[ For each Partition ]</tspan></text></g><g><text x=\"375\" y=\"303\" class=\"messageText\" style=\"text-anchor: middle;\">Check If Container Exists for Checkpoints</text><line x1=\"275\" y1=\"310\" x2=\"475\" y2=\"310\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"338\" class=\"messageText\" style=\"text-anchor: middle;\">Return</text><line x1=\"275\" y1=\"345\" x2=\"75\" y2=\"345\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line></g><g><rect x=\"0\" y=\"365\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"397.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">Main()</tspan></text></g><g><rect x=\"200\" y=\"365\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"397.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">EventProcessorHost</tspan></text></g><g><rect x=\"400\" y=\"365\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"475\" y=\"397.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"475\" dy=\"0\">Azure Blob Storage</tspan></text></g><g><rect x=\"600\" y=\"365\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"675\" y=\"397.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"675\" dy=\"0\">EventHub</tspan></text></g></svg></div>\n<p>Initialization is now complete.\nKicks off the run Async Processor and returns <strong>without</strong> waiting for RunAsync to complete</p>\n<h3>RegisterEventProcessorAsync - Run Async</h3>\n<p>As mentioned above, RunAsync part of the process is done asynchronously after RegisterEventProcessorAsync returns.</p>\n<ul>\n<li>The library checks the <code class=\"language-text\">$Default</code> blob directory and gets all the leases.</li>\n<li>\n<p>It tries to renew downloaded leases</p>\n<div class=\"mermaid\" data-processed=\"true\"><svg id=\"mermaid-1590434673866\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" height=\"100%\" style=\"max-width:450px;\" viewBox=\"-50 -10 450 196\"><style>#mermaid-1590434673866 .label{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590434673866 .label text{fill:#333}#mermaid-1590434673866 .node rect,#mermaid-1590434673866 .node circle,#mermaid-1590434673866 .node ellipse,#mermaid-1590434673866 .node polygon,#mermaid-1590434673866 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590434673866 .node .label{text-align:center}#mermaid-1590434673866 .node.clickable{cursor:pointer}#mermaid-1590434673866 .arrowheadPath{fill:#333}#mermaid-1590434673866 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590434673866 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590434673866 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590434673866 .cluster text{fill:#333}#mermaid-1590434673866 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590434673866 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590434673866 text.actor{fill:#000;stroke:none}#mermaid-1590434673866 .actor-line{stroke:grey}#mermaid-1590434673866 .messageLine0{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1590434673866 .messageLine1{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1590434673866 #arrowhead{fill:#333}#mermaid-1590434673866 .sequenceNumber{fill:#fff}#mermaid-1590434673866 #sequencenumber{fill:#333}#mermaid-1590434673866 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590434673866 .messageText{fill:#333;stroke:none}#mermaid-1590434673866 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590434673866 .labelText{fill:#000;stroke:none}#mermaid-1590434673866 .loopText{fill:#000;stroke:none}#mermaid-1590434673866 .loopLine{stroke-width:2;stroke-dasharray:'2 2';stroke:#ccf}#mermaid-1590434673866 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590434673866 .noteText{fill:black;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590434673866 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590434673866 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590434673866 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590434673866 .mermaid-main-font{font-family:\"trebuchet ms\", verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 .section{stroke:none;opacity:0.2}#mermaid-1590434673866 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590434673866 .section2{fill:#fff400}#mermaid-1590434673866 .section1,#mermaid-1590434673866 .section3{fill:#fff;opacity:0.2}#mermaid-1590434673866 .sectionTitle0{fill:#333}#mermaid-1590434673866 .sectionTitle1{fill:#333}#mermaid-1590434673866 .sectionTitle2{fill:#333}#mermaid-1590434673866 .sectionTitle3{fill:#333}#mermaid-1590434673866 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590434673866 .grid .tick text{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 .grid path{stroke-width:0}#mermaid-1590434673866 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590434673866 .task{stroke-width:2}#mermaid-1590434673866 .taskText{text-anchor:middle;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 .taskText:not([font-size]){font-size:11px}#mermaid-1590434673866 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590434673866 .task.clickable{cursor:pointer}#mermaid-1590434673866 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673866 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673866 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673866 .taskText0,#mermaid-1590434673866 .taskText1,#mermaid-1590434673866 .taskText2,#mermaid-1590434673866 .taskText3{fill:#fff}#mermaid-1590434673866 .task0,#mermaid-1590434673866 .task1,#mermaid-1590434673866 .task2,#mermaid-1590434673866 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590434673866 .taskTextOutside0,#mermaid-1590434673866 .taskTextOutside2{fill:#000}#mermaid-1590434673866 .taskTextOutside1,#mermaid-1590434673866 .taskTextOutside3{fill:#000}#mermaid-1590434673866 .active0,#mermaid-1590434673866 .active1,#mermaid-1590434673866 .active2,#mermaid-1590434673866 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590434673866 .activeText0,#mermaid-1590434673866 .activeText1,#mermaid-1590434673866 .activeText2,#mermaid-1590434673866 .activeText3{fill:#000 !important}#mermaid-1590434673866 .done0,#mermaid-1590434673866 .done1,#mermaid-1590434673866 .done2,#mermaid-1590434673866 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590434673866 .doneText0,#mermaid-1590434673866 .doneText1,#mermaid-1590434673866 .doneText2,#mermaid-1590434673866 .doneText3{fill:#000 !important}#mermaid-1590434673866 .crit0,#mermaid-1590434673866 .crit1,#mermaid-1590434673866 .crit2,#mermaid-1590434673866 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590434673866 .activeCrit0,#mermaid-1590434673866 .activeCrit1,#mermaid-1590434673866 .activeCrit2,#mermaid-1590434673866 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590434673866 .doneCrit0,#mermaid-1590434673866 .doneCrit1,#mermaid-1590434673866 .doneCrit2,#mermaid-1590434673866 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590434673866 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590434673866 .milestoneText{font-style:italic}#mermaid-1590434673866 .doneCritText0,#mermaid-1590434673866 .doneCritText1,#mermaid-1590434673866 .doneCritText2,#mermaid-1590434673866 .doneCritText3{fill:#000 !important}#mermaid-1590434673866 .activeCritText0,#mermaid-1590434673866 .activeCritText1,#mermaid-1590434673866 .activeCritText2,#mermaid-1590434673866 .activeCritText3{fill:#000 !important}#mermaid-1590434673866 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 g.classGroup text{fill:#9370db;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590434673866 g.classGroup text .title{font-weight:bolder}#mermaid-1590434673866 g.clickable{cursor:pointer}#mermaid-1590434673866 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590434673866 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590434673866 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590434673866 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590434673866 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590434673866 .dashed-line{stroke-dasharray:3}#mermaid-1590434673866 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673866 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673866 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590434673866 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590434673866 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673866 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673866 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673866 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673866 .commit-id,#mermaid-1590434673866 .commit-msg,#mermaid-1590434673866 .branch-label{fill:lightgrey;color:lightgrey;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 .slice{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673866 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590434673866 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590434673866 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590434673866 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590434673866 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590434673866 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590434673866 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590434673866 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590434673866 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590434673866 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590434673866 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: '\"trebuchet ms\", verdana, arial';--mermaid-font-family: \"Comic Sans MS\", \"Comic Sans\", cursive}\n\n:root { --mermaid-font-family: \"trebuchet ms\", verdana, arial;}</style><style>#mermaid-1590434673866 {\n    color: rgb(0, 0, 0);\n    font: normal normal 400 normal 16px / normal \"trebuchet ms\", verdana, arial;\n  }</style><g></g><g><line id=\"actor0\" x1=\"75\" y1=\"5\" x2=\"75\" y2=\"185\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"0\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">EventProcessorHost</tspan></text></g><g><line id=\"actor1\" x1=\"275\" y1=\"5\" x2=\"275\" y2=\"185\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"200\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">Azure Blob Storage</tspan></text></g><defs><marker id=\"arrowhead\" refX=\"5\" refY=\"2\" markerWidth=\"6\" markerHeight=\"4\" orient=\"auto\"><path d=\"M 0,0 V 4 L6,2 Z\"></path></marker></defs><defs><marker id=\"crosshead\" markerWidth=\"15\" markerHeight=\"8\" orient=\"auto\" refX=\"16\" refY=\"4\"><path fill=\"black\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 9,2 V 6 L16,4 Z\" style=\"stroke-dasharray: 0, 0;\"></path><path fill=\"none\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 0,1 L 6,7 M 6,1 L 0,7\" style=\"stroke-dasharray: 0, 0;\"></path></marker></defs><defs><marker id=\"sequencenumber\" refX=\"15\" refY=\"15\" markerWidth=\"60\" markerHeight=\"40\" orient=\"auto\"><circle cx=\"15\" cy=\"15\" r=\"6\"></circle></marker></defs><g><text x=\"175\" y=\"93\" class=\"messageText\" style=\"text-anchor: middle;\">ListBlobsSegmentedAsync</text><line x1=\"75\" y1=\"100\" x2=\"275\" y2=\"100\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><rect x=\"0\" y=\"120\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"152.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">EventProcessorHost</tspan></text></g><g><rect x=\"200\" y=\"120\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"152.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">Azure Blob Storage</tspan></text></g></svg></div>\n<p>Then start the lease management process. As a part of lease management, the Partition Manager downloads the Lease Blob, rechecks, and then acquires the lease. Sets the owner to the current hostId uploads it back</p>\n</li>\n</ul>\n<div class=\"mermaid\" data-processed=\"true\"><svg id=\"mermaid-1590434673865\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" height=\"100%\" style=\"max-width:450px;\" viewBox=\"-50 -10 450 441\"><style>#mermaid-1590434673865 .label{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590434673865 .label text{fill:#333}#mermaid-1590434673865 .node rect,#mermaid-1590434673865 .node circle,#mermaid-1590434673865 .node ellipse,#mermaid-1590434673865 .node polygon,#mermaid-1590434673865 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590434673865 .node .label{text-align:center}#mermaid-1590434673865 .node.clickable{cursor:pointer}#mermaid-1590434673865 .arrowheadPath{fill:#333}#mermaid-1590434673865 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590434673865 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590434673865 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590434673865 .cluster text{fill:#333}#mermaid-1590434673865 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590434673865 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590434673865 text.actor{fill:#000;stroke:none}#mermaid-1590434673865 .actor-line{stroke:grey}#mermaid-1590434673865 .messageLine0{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1590434673865 .messageLine1{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1590434673865 #arrowhead{fill:#333}#mermaid-1590434673865 .sequenceNumber{fill:#fff}#mermaid-1590434673865 #sequencenumber{fill:#333}#mermaid-1590434673865 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590434673865 .messageText{fill:#333;stroke:none}#mermaid-1590434673865 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590434673865 .labelText{fill:#000;stroke:none}#mermaid-1590434673865 .loopText{fill:#000;stroke:none}#mermaid-1590434673865 .loopLine{stroke-width:2;stroke-dasharray:'2 2';stroke:#ccf}#mermaid-1590434673865 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590434673865 .noteText{fill:black;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590434673865 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590434673865 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590434673865 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590434673865 .mermaid-main-font{font-family:\"trebuchet ms\", verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .section{stroke:none;opacity:0.2}#mermaid-1590434673865 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590434673865 .section2{fill:#fff400}#mermaid-1590434673865 .section1,#mermaid-1590434673865 .section3{fill:#fff;opacity:0.2}#mermaid-1590434673865 .sectionTitle0{fill:#333}#mermaid-1590434673865 .sectionTitle1{fill:#333}#mermaid-1590434673865 .sectionTitle2{fill:#333}#mermaid-1590434673865 .sectionTitle3{fill:#333}#mermaid-1590434673865 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590434673865 .grid .tick text{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .grid path{stroke-width:0}#mermaid-1590434673865 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590434673865 .task{stroke-width:2}#mermaid-1590434673865 .taskText{text-anchor:middle;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .taskText:not([font-size]){font-size:11px}#mermaid-1590434673865 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590434673865 .task.clickable{cursor:pointer}#mermaid-1590434673865 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673865 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673865 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673865 .taskText0,#mermaid-1590434673865 .taskText1,#mermaid-1590434673865 .taskText2,#mermaid-1590434673865 .taskText3{fill:#fff}#mermaid-1590434673865 .task0,#mermaid-1590434673865 .task1,#mermaid-1590434673865 .task2,#mermaid-1590434673865 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590434673865 .taskTextOutside0,#mermaid-1590434673865 .taskTextOutside2{fill:#000}#mermaid-1590434673865 .taskTextOutside1,#mermaid-1590434673865 .taskTextOutside3{fill:#000}#mermaid-1590434673865 .active0,#mermaid-1590434673865 .active1,#mermaid-1590434673865 .active2,#mermaid-1590434673865 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590434673865 .activeText0,#mermaid-1590434673865 .activeText1,#mermaid-1590434673865 .activeText2,#mermaid-1590434673865 .activeText3{fill:#000 !important}#mermaid-1590434673865 .done0,#mermaid-1590434673865 .done1,#mermaid-1590434673865 .done2,#mermaid-1590434673865 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590434673865 .doneText0,#mermaid-1590434673865 .doneText1,#mermaid-1590434673865 .doneText2,#mermaid-1590434673865 .doneText3{fill:#000 !important}#mermaid-1590434673865 .crit0,#mermaid-1590434673865 .crit1,#mermaid-1590434673865 .crit2,#mermaid-1590434673865 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590434673865 .activeCrit0,#mermaid-1590434673865 .activeCrit1,#mermaid-1590434673865 .activeCrit2,#mermaid-1590434673865 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590434673865 .doneCrit0,#mermaid-1590434673865 .doneCrit1,#mermaid-1590434673865 .doneCrit2,#mermaid-1590434673865 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590434673865 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590434673865 .milestoneText{font-style:italic}#mermaid-1590434673865 .doneCritText0,#mermaid-1590434673865 .doneCritText1,#mermaid-1590434673865 .doneCritText2,#mermaid-1590434673865 .doneCritText3{fill:#000 !important}#mermaid-1590434673865 .activeCritText0,#mermaid-1590434673865 .activeCritText1,#mermaid-1590434673865 .activeCritText2,#mermaid-1590434673865 .activeCritText3{fill:#000 !important}#mermaid-1590434673865 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 g.classGroup text{fill:#9370db;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590434673865 g.classGroup text .title{font-weight:bolder}#mermaid-1590434673865 g.clickable{cursor:pointer}#mermaid-1590434673865 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590434673865 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590434673865 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590434673865 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590434673865 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590434673865 .dashed-line{stroke-dasharray:3}#mermaid-1590434673865 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673865 .commit-id,#mermaid-1590434673865 .commit-msg,#mermaid-1590434673865 .branch-label{fill:lightgrey;color:lightgrey;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 .slice{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673865 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590434673865 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590434673865 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590434673865 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590434673865 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590434673865 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590434673865 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590434673865 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590434673865 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590434673865 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590434673865 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: '\"trebuchet ms\", verdana, arial';--mermaid-font-family: \"Comic Sans MS\", \"Comic Sans\", cursive}\n\n:root { --mermaid-font-family: \"trebuchet ms\", verdana, arial;}</style><style>#mermaid-1590434673865 {\n    color: rgb(0, 0, 0);\n    font: normal normal 400 normal 16px / normal \"trebuchet ms\", verdana, arial;\n  }</style><g></g><g><line id=\"actor0\" x1=\"75\" y1=\"5\" x2=\"75\" y2=\"430\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"0\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">EventProcessorHost</tspan></text></g><g><line id=\"actor1\" x1=\"275\" y1=\"5\" x2=\"275\" y2=\"430\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"200\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">Azure Blob Storage</tspan></text></g><defs><marker id=\"arrowhead\" refX=\"5\" refY=\"2\" markerWidth=\"6\" markerHeight=\"4\" orient=\"auto\"><path d=\"M 0,0 V 4 L6,2 Z\"></path></marker></defs><defs><marker id=\"crosshead\" markerWidth=\"15\" markerHeight=\"8\" orient=\"auto\" refX=\"16\" refY=\"4\"><path fill=\"black\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 9,2 V 6 L16,4 Z\" style=\"stroke-dasharray: 0, 0;\"></path><path fill=\"none\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 0,1 L 6,7 M 6,1 L 0,7\" style=\"stroke-dasharray: 0, 0;\"></path></marker></defs><defs><marker id=\"sequencenumber\" refX=\"15\" refY=\"15\" markerWidth=\"60\" markerHeight=\"40\" orient=\"auto\"><circle cx=\"15\" cy=\"15\" r=\"6\"></circle></marker></defs><g><text x=\"175\" y=\"93\" class=\"messageText\" style=\"text-anchor: middle;\">ListBlobsSegmentedAsync</text><line x1=\"75\" y1=\"100\" x2=\"275\" y2=\"100\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"153\" class=\"messageText\" style=\"text-anchor: middle;\">FetchAttributesAsync</text><line x1=\"75\" y1=\"160\" x2=\"275\" y2=\"160\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"188\" class=\"messageText\" style=\"text-anchor: middle;\">DownloadTextAsync</text><line x1=\"75\" y1=\"195\" x2=\"275\" y2=\"195\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"223\" class=\"messageText\" style=\"text-anchor: middle;\">FetchAttributesAsync</text><line x1=\"75\" y1=\"230\" x2=\"275\" y2=\"230\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"258\" class=\"messageText\" style=\"text-anchor: middle;\">AcquireLeaseAsync</text><line x1=\"75\" y1=\"265\" x2=\"275\" y2=\"265\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"293\" class=\"messageText\" style=\"text-anchor: middle;\">SetMetadataAsync</text><line x1=\"75\" y1=\"300\" x2=\"275\" y2=\"300\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"328\" class=\"messageText\" style=\"text-anchor: middle;\">UploadTextAsync</text><line x1=\"75\" y1=\"335\" x2=\"275\" y2=\"335\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><line x1=\"65\" y1=\"110\" x2=\"285\" y2=\"110\" class=\"loopLine\"></line><line x1=\"285\" y1=\"110\" x2=\"285\" y2=\"345\" class=\"loopLine\"></line><line x1=\"65\" y1=\"345\" x2=\"285\" y2=\"345\" class=\"loopLine\"></line><line x1=\"65\" y1=\"110\" x2=\"65\" y2=\"345\" class=\"loopLine\"></line><polygon points=\"65,110 115,110 115,123 106.6,130 65,130\" class=\"labelBox\"></polygon><text x=\"72.5\" y=\"125\" class=\"labelText\"><tspan x=\"72.5\">loop</tspan></text><text x=\"175\" y=\"125\" class=\"loopText\" style=\"text-anchor: middle;\"><tspan x=\"175\">[ For each Partition - Lease Management ]</tspan></text></g><g><rect x=\"0\" y=\"365\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"397.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">EventProcessorHost</tspan></text></g><g><rect x=\"200\" y=\"365\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"397.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">Azure Blob Storage</tspan></text></g></svg></div>\n<p>For each Lease that is owned by the host, Partition Manager creates a Pump. The pump is responsible for querying the event hub for messages and pushing it to the subscriber</p>\n<ul>\n<li>Refresh the Blob again so that we get the latest and check the hostname and check its expiry.</li>\n<li>If everything looks alright we create the pump</li>\n<li>We open the Pump using Open Async</li>\n<li>Then pump fetches the lease blob and checks for offset.</li>\n<li>The pump keeps checking for messages and keeps pushing them to the Event Processor</li>\n</ul>\n<div class=\"mermaid\" data-processed=\"true\"><svg id=\"mermaid-1590434673863\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" height=\"100%\" style=\"max-width:850px;\" viewBox=\"-50 -10 850 616\"><style>#mermaid-1590434673863 .label{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1590434673863 .label text{fill:#333}#mermaid-1590434673863 .node rect,#mermaid-1590434673863 .node circle,#mermaid-1590434673863 .node ellipse,#mermaid-1590434673863 .node polygon,#mermaid-1590434673863 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1590434673863 .node .label{text-align:center}#mermaid-1590434673863 .node.clickable{cursor:pointer}#mermaid-1590434673863 .arrowheadPath{fill:#333}#mermaid-1590434673863 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1590434673863 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1590434673863 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1590434673863 .cluster text{fill:#333}#mermaid-1590434673863 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1590434673863 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1590434673863 text.actor{fill:#000;stroke:none}#mermaid-1590434673863 .actor-line{stroke:grey}#mermaid-1590434673863 .messageLine0{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1590434673863 .messageLine1{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1590434673863 #arrowhead{fill:#333}#mermaid-1590434673863 .sequenceNumber{fill:#fff}#mermaid-1590434673863 #sequencenumber{fill:#333}#mermaid-1590434673863 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1590434673863 .messageText{fill:#333;stroke:none}#mermaid-1590434673863 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1590434673863 .labelText{fill:#000;stroke:none}#mermaid-1590434673863 .loopText{fill:#000;stroke:none}#mermaid-1590434673863 .loopLine{stroke-width:2;stroke-dasharray:'2 2';stroke:#ccf}#mermaid-1590434673863 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1590434673863 .noteText{fill:black;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1590434673863 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1590434673863 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1590434673863 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1590434673863 .mermaid-main-font{font-family:\"trebuchet ms\", verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 .section{stroke:none;opacity:0.2}#mermaid-1590434673863 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1590434673863 .section2{fill:#fff400}#mermaid-1590434673863 .section1,#mermaid-1590434673863 .section3{fill:#fff;opacity:0.2}#mermaid-1590434673863 .sectionTitle0{fill:#333}#mermaid-1590434673863 .sectionTitle1{fill:#333}#mermaid-1590434673863 .sectionTitle2{fill:#333}#mermaid-1590434673863 .sectionTitle3{fill:#333}#mermaid-1590434673863 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1590434673863 .grid .tick text{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 .grid path{stroke-width:0}#mermaid-1590434673863 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1590434673863 .task{stroke-width:2}#mermaid-1590434673863 .taskText{text-anchor:middle;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 .taskText:not([font-size]){font-size:11px}#mermaid-1590434673863 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1590434673863 .task.clickable{cursor:pointer}#mermaid-1590434673863 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673863 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673863 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1590434673863 .taskText0,#mermaid-1590434673863 .taskText1,#mermaid-1590434673863 .taskText2,#mermaid-1590434673863 .taskText3{fill:#fff}#mermaid-1590434673863 .task0,#mermaid-1590434673863 .task1,#mermaid-1590434673863 .task2,#mermaid-1590434673863 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1590434673863 .taskTextOutside0,#mermaid-1590434673863 .taskTextOutside2{fill:#000}#mermaid-1590434673863 .taskTextOutside1,#mermaid-1590434673863 .taskTextOutside3{fill:#000}#mermaid-1590434673863 .active0,#mermaid-1590434673863 .active1,#mermaid-1590434673863 .active2,#mermaid-1590434673863 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1590434673863 .activeText0,#mermaid-1590434673863 .activeText1,#mermaid-1590434673863 .activeText2,#mermaid-1590434673863 .activeText3{fill:#000 !important}#mermaid-1590434673863 .done0,#mermaid-1590434673863 .done1,#mermaid-1590434673863 .done2,#mermaid-1590434673863 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1590434673863 .doneText0,#mermaid-1590434673863 .doneText1,#mermaid-1590434673863 .doneText2,#mermaid-1590434673863 .doneText3{fill:#000 !important}#mermaid-1590434673863 .crit0,#mermaid-1590434673863 .crit1,#mermaid-1590434673863 .crit2,#mermaid-1590434673863 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1590434673863 .activeCrit0,#mermaid-1590434673863 .activeCrit1,#mermaid-1590434673863 .activeCrit2,#mermaid-1590434673863 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1590434673863 .doneCrit0,#mermaid-1590434673863 .doneCrit1,#mermaid-1590434673863 .doneCrit2,#mermaid-1590434673863 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1590434673863 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1590434673863 .milestoneText{font-style:italic}#mermaid-1590434673863 .doneCritText0,#mermaid-1590434673863 .doneCritText1,#mermaid-1590434673863 .doneCritText2,#mermaid-1590434673863 .doneCritText3{fill:#000 !important}#mermaid-1590434673863 .activeCritText0,#mermaid-1590434673863 .activeCritText1,#mermaid-1590434673863 .activeCritText2,#mermaid-1590434673863 .activeCritText3{fill:#000 !important}#mermaid-1590434673863 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 g.classGroup text{fill:#9370db;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1590434673863 g.classGroup text .title{font-weight:bolder}#mermaid-1590434673863 g.clickable{cursor:pointer}#mermaid-1590434673863 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590434673863 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590434673863 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590434673863 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1590434673863 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590434673863 .dashed-line{stroke-dasharray:3}#mermaid-1590434673863 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673863 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673863 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590434673863 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1590434673863 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673863 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673863 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673863 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1590434673863 .commit-id,#mermaid-1590434673863 .commit-msg,#mermaid-1590434673863 .branch-label{fill:lightgrey;color:lightgrey;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 .slice{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1590434673863 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1590434673863 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1590434673863 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1590434673863 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1590434673863 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1590434673863 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1590434673863 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1590434673863 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1590434673863 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1590434673863 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1590434673863 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: '\"trebuchet ms\", verdana, arial';--mermaid-font-family: \"Comic Sans MS\", \"Comic Sans\", cursive}\n\n:root { --mermaid-font-family: \"trebuchet ms\", verdana, arial;}</style><style>#mermaid-1590434673863 {\n    color: rgb(0, 0, 0);\n    font: normal normal 400 normal 16px / normal \"trebuchet ms\", verdana, arial;\n  }</style><g></g><g><line id=\"actor0\" x1=\"75\" y1=\"5\" x2=\"75\" y2=\"605\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"0\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">EventProcessorHost</tspan></text></g><g><line id=\"actor1\" x1=\"275\" y1=\"5\" x2=\"275\" y2=\"605\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"200\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">Azure Blob Storage</tspan></text></g><g><line id=\"actor2\" x1=\"475\" y1=\"5\" x2=\"475\" y2=\"605\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"400\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"475\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"475\" dy=\"0\">SimpleEventProcessor</tspan></text></g><g><line id=\"actor3\" x1=\"675\" y1=\"5\" x2=\"675\" y2=\"605\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"600\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"675\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"675\" dy=\"0\">AMQP</tspan></text></g><defs><marker id=\"arrowhead\" refX=\"5\" refY=\"2\" markerWidth=\"6\" markerHeight=\"4\" orient=\"auto\"><path d=\"M 0,0 V 4 L6,2 Z\"></path></marker></defs><defs><marker id=\"crosshead\" markerWidth=\"15\" markerHeight=\"8\" orient=\"auto\" refX=\"16\" refY=\"4\"><path fill=\"black\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 9,2 V 6 L16,4 Z\" style=\"stroke-dasharray: 0, 0;\"></path><path fill=\"none\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 0,1 L 6,7 M 6,1 L 0,7\" style=\"stroke-dasharray: 0, 0;\"></path></marker></defs><defs><marker id=\"sequencenumber\" refX=\"15\" refY=\"15\" markerWidth=\"60\" markerHeight=\"40\" orient=\"auto\"><circle cx=\"15\" cy=\"15\" r=\"6\"></circle></marker></defs><g><text x=\"175\" y=\"118\" class=\"messageText\" style=\"text-anchor: middle;\">FetchAttributesAsync</text><line x1=\"75\" y1=\"125\" x2=\"275\" y2=\"125\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"153\" class=\"messageText\" style=\"text-anchor: middle;\">DownloadTextAsync</text><line x1=\"75\" y1=\"160\" x2=\"275\" y2=\"160\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"213\" class=\"messageText\" style=\"text-anchor: middle;\">FetchAttributesAsync</text><line x1=\"75\" y1=\"220\" x2=\"275\" y2=\"220\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"248\" class=\"messageText\" style=\"text-anchor: middle;\">DownloadTextAsync</text><line x1=\"75\" y1=\"255\" x2=\"275\" y2=\"255\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"275\" y=\"283\" class=\"messageText\" style=\"text-anchor: middle;\">OpenAsync</text><line x1=\"75\" y1=\"290\" x2=\"475\" y2=\"290\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"318\" class=\"messageText\" style=\"text-anchor: middle;\">FetchAttributesAsync</text><line x1=\"75\" y1=\"325\" x2=\"275\" y2=\"325\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"175\" y=\"353\" class=\"messageText\" style=\"text-anchor: middle;\">DownloadTextAsync</text><line x1=\"75\" y1=\"360\" x2=\"275\" y2=\"360\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"375\" y=\"413\" class=\"messageText\" style=\"text-anchor: middle;\">BeginReceiveMessages</text><line x1=\"75\" y1=\"420\" x2=\"675\" y2=\"420\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"375\" y=\"448\" class=\"messageText\" style=\"text-anchor: middle;\">EndReceiveMessages</text><line x1=\"75\" y1=\"455\" x2=\"675\" y2=\"455\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><text x=\"275\" y=\"483\" class=\"messageText\" style=\"text-anchor: middle;\">OnReceiveAsync</text><line x1=\"75\" y1=\"490\" x2=\"475\" y2=\"490\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"black\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line></g><g><line x1=\"65\" y1=\"370\" x2=\"685\" y2=\"370\" class=\"loopLine\"></line><line x1=\"685\" y1=\"370\" x2=\"685\" y2=\"500\" class=\"loopLine\"></line><line x1=\"65\" y1=\"500\" x2=\"685\" y2=\"500\" class=\"loopLine\"></line><line x1=\"65\" y1=\"370\" x2=\"65\" y2=\"500\" class=\"loopLine\"></line><polygon points=\"65,370 115,370 115,383 106.6,390 65,390\" class=\"labelBox\"></polygon><text x=\"72.5\" y=\"385\" class=\"labelText\"><tspan x=\"72.5\">loop</tspan></text><text x=\"375\" y=\"385\" class=\"loopText\" style=\"text-anchor: middle;\"><tspan x=\"375\">[ polls ]</tspan></text></g><g><line x1=\"55\" y1=\"170\" x2=\"695\" y2=\"170\" class=\"loopLine\"></line><line x1=\"695\" y1=\"170\" x2=\"695\" y2=\"510\" class=\"loopLine\"></line><line x1=\"55\" y1=\"510\" x2=\"695\" y2=\"510\" class=\"loopLine\"></line><line x1=\"55\" y1=\"170\" x2=\"55\" y2=\"510\" class=\"loopLine\"></line><polygon points=\"55,170 105,170 105,183 96.6,190 55,190\" class=\"labelBox\"></polygon><text x=\"62.5\" y=\"185\" class=\"labelText\"><tspan x=\"62.5\">opt</tspan></text><text x=\"375\" y=\"185\" class=\"loopText\" style=\"text-anchor: middle;\"><tspan x=\"375\">[ Open Pump ]</tspan></text></g><g><line x1=\"45\" y1=\"75\" x2=\"705\" y2=\"75\" class=\"loopLine\"></line><line x1=\"705\" y1=\"75\" x2=\"705\" y2=\"520\" class=\"loopLine\"></line><line x1=\"45\" y1=\"520\" x2=\"705\" y2=\"520\" class=\"loopLine\"></line><line x1=\"45\" y1=\"75\" x2=\"45\" y2=\"520\" class=\"loopLine\"></line><polygon points=\"45,75 95,75 95,88 86.6,95 45,95\" class=\"labelBox\"></polygon><text x=\"52.5\" y=\"90\" class=\"labelText\"><tspan x=\"52.5\">loop</tspan></text><text x=\"375\" y=\"90\" class=\"loopText\" style=\"text-anchor: middle;\"><tspan x=\"375\">[ For each Lease owned by Host ]</tspan></text></g><g><rect x=\"0\" y=\"540\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"572.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"75\" dy=\"0\">EventProcessorHost</tspan></text></g><g><rect x=\"200\" y=\"540\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"275\" y=\"572.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"275\" dy=\"0\">Azure Blob Storage</tspan></text></g><g><rect x=\"400\" y=\"540\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"475\" y=\"572.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"475\" dy=\"0\">SimpleEventProcessor</tspan></text></g><g><rect x=\"600\" y=\"540\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"675\" y=\"572.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px;\"><tspan x=\"675\" dy=\"0\">AMQP</tspan></text></g></svg></div>\n<p>Overall there are 3 sections in Azure Event Hub</p>\n<ol>\n<li>Partition Manager - This takes care of Lease Management &#x26; Creation of Pumps </li>\n<li>Event Hub Partition Pump - This is responsible for pushing the events to the Event Processor</li>\n<li>AMQPPartitionReceiver - This handles the AMQP side of things when receiving a message.</li>\n</ol>","frontmatter":{"title":"Azure Event Hub SDK Internals - Part 1 (Overview & Control Flow)","date":"May 23, 2020","description":"In this post, we will take a look at how the Azure Event hub works internally, look at sequence diagrams and understand teh general architecture"}}},"pageContext":{"slug":"/event-hub/","previous":{"fields":{"slug":"/durable-task-6/"},"frontmatter":{"title":"Durable Task Framework Internals - Part 6 (Orchestration Execution Flow)"}},"next":{"fields":{"slug":"/event-hub-2/"},"frontmatter":{"title":"Azure Event Hub SDK Internals - Part 2 (Partition Manager & Lease Management)"}}}}}