<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><meta data-react-helmet="true" property="og:description" content="In this part we look at how the framework handles cancellations and middlewares"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="icon" href="/blog/icons/icon-48x48.png?v=fd6b8e1352aaa808d8b27a40db102c0c"/><link rel="manifest" href="/blog/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=fd6b8e1352aaa808d8b27a40db102c0c"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=fd6b8e1352aaa808d8b27a40db102c0c"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=fd6b8e1352aaa808d8b27a40db102c0c"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=fd6b8e1352aaa808d8b27a40db102c0c"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=fd6b8e1352aaa808d8b27a40db102c0c"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=fd6b8e1352aaa808d8b27a40db102c0c"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=fd6b8e1352aaa808d8b27a40db102c0c"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=fd6b8e1352aaa808d8b27a40db102c0c"/><title data-react-helmet="true">Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp; Middlewares) | Abhik&#x27;s Blog</title><meta data-react-helmet="true" name="description" content="In this part we look at how the framework handles cancellations and middlewares"/><meta data-react-helmet="true" property="og:title" content="Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp; Middlewares)"/><meta name="generator" content="Gatsby 2.20.12"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="complancoder"/><meta data-react-helmet="true" name="twitter:title" content="Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp; Middlewares)"/><meta data-react-helmet="true" name="twitter:description" content="In this part we look at how the framework handles cancellations and middlewares"/><meta data-react-helmet="true" name="linkedIn" content="https://www.linkedin.com/in/iamabhik/"/><style data-href="/blog/styles.781d48369f427189248e.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/blog/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/blog/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/blog/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/blog/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/blog/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/blog/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/blog/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/blog/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/blog/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/blog/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/blog/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/blog/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/blog/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/blog/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/blog/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/blog/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/blog/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/blog/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/blog/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/blog/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/blog/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/blog/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/blog/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/blog/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/blog/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/blog/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/blog/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/blog/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/blog/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/blog/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/blog/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/blog/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/blog/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/blog/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/blog/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/blog/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/blog/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/blog/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/blog/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/blog/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/blog/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/blog/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/blog/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/blog/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/blog/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/blog/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/blog/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/blog/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/blog/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/blog/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/blog/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/blog/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-js-603e003d35c7316a3610.js"/><link as="script" rel="preload" href="/blog/69ca9dfa785447e3d8b116b383997bcdc8df623a-e846e6165360833579bc.js"/><link as="script" rel="preload" href="/blog/commons-257f2cc47edbd46eb2b4.js"/><link as="script" rel="preload" href="/blog/app-2cb18ef149383859188d.js"/><link as="script" rel="preload" href="/blog/framework-624f79e66261973aaa49.js"/><link as="script" rel="preload" href="/blog/styles-55b12e3f12e70f5e0cab.js"/><link as="script" rel="preload" href="/blog/webpack-runtime-c593f8b747f91b29dbc3.js"/><link as="fetch" rel="preload" href="/blog/page-data\durable-task-4\page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data\app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;color:inherit" href="/blog/">Abhik&#x27;s Blog</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">Durable Task Framework Internals - Part 4 (Terminated Orchestrations &amp; Middlewares)</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">April 27, 2020</p></header><section><h3>Durable Task Framework Series</h3>
<p>This post is <strong>part 4</strong> of a series of posts on DTF.</p>
<ol>
<li><a href="https://abhikmitra.github.io/blog/durable-task/">Durable Task Framework Internals - Part 1 (Dataflow and Reliability)</a></li>
<li><a href="https://abhikmitra.github.io/blog/durable-task-2/">Durable Task Framework Internals - Part 2 (The curious case of Orchestrations)</a></li>
<li><a href="https://abhikmitra.github.io/blog/durable-task-3/">Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)</a></li>
<li><a href="https://abhikmitra.github.io/blog/durable-task-4/">Durable Task Framework Internals - Part 4 (Terminated Orchestrations &#x26; Middlewares)</a></li>
</ol>
<p>Do you think there is more that I should cover or something I should fix ? Please raise an <a href="https://github.com/abhikmitra/blog/issues">issue</a> and let me know.</p>
<hr>
<h3>Terminate an orchestration</h3>
<p>The Client can control the orchestration even though the Hub manages the orchestration. The Client can issue <code class="language-text">TerminateInstanceAsync</code> to terminate the ongoing orchestration.</p>
<div class="gatsby-highlight" data-language="csharp"><pre style="counter-reset: linenumber NaN" class="language-csharp line-numbers"><code class="language-csharp"><span class="token keyword">var</span> instance <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">CreateOrchestrationInstanceAsync</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>TestOrchestration<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"InstanceId5306"</span><span class="token punctuation">,</span> <span class="token string">"Test Input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">;</span>
Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">TerminateInstanceAsync</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Here is the sequence diagram as to what happens behind the scenes</p>
<div class="mermaid" data-processed="true"><svg id="mermaid-1587845640347" width="100%" xmlns="http://www.w3.org/2000/svg" height="100%" style="max-width:1250px;" viewBox="-50 -10 1250 702"><style>#mermaid-1587845640347 .label{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587845640347 .label text{fill:#333}#mermaid-1587845640347 .node rect,#mermaid-1587845640347 .node circle,#mermaid-1587845640347 .node ellipse,#mermaid-1587845640347 .node polygon,#mermaid-1587845640347 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587845640347 .node .label{text-align:center}#mermaid-1587845640347 .node.clickable{cursor:pointer}#mermaid-1587845640347 .arrowheadPath{fill:#333}#mermaid-1587845640347 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587845640347 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587845640347 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587845640347 .cluster text{fill:#333}#mermaid-1587845640347 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587845640347 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587845640347 text.actor{fill:#000;stroke:none}#mermaid-1587845640347 .actor-line{stroke:grey}#mermaid-1587845640347 .messageLine0{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1587845640347 .messageLine1{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1587845640347 #arrowhead{fill:#333}#mermaid-1587845640347 .sequenceNumber{fill:#fff}#mermaid-1587845640347 #sequencenumber{fill:#333}#mermaid-1587845640347 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587845640347 .messageText{fill:#333;stroke:none}#mermaid-1587845640347 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587845640347 .labelText{fill:#000;stroke:none}#mermaid-1587845640347 .loopText{fill:#000;stroke:none}#mermaid-1587845640347 .loopLine{stroke-width:2;stroke-dasharray:'2 2';stroke:#ccf}#mermaid-1587845640347 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587845640347 .noteText{fill:black;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587845640347 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587845640347 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587845640347 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587845640347 .mermaid-main-font{font-family:"trebuchet ms", verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 .section{stroke:none;opacity:0.2}#mermaid-1587845640347 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587845640347 .section2{fill:#fff400}#mermaid-1587845640347 .section1,#mermaid-1587845640347 .section3{fill:#fff;opacity:0.2}#mermaid-1587845640347 .sectionTitle0{fill:#333}#mermaid-1587845640347 .sectionTitle1{fill:#333}#mermaid-1587845640347 .sectionTitle2{fill:#333}#mermaid-1587845640347 .sectionTitle3{fill:#333}#mermaid-1587845640347 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587845640347 .grid .tick text{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 .grid path{stroke-width:0}#mermaid-1587845640347 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587845640347 .task{stroke-width:2}#mermaid-1587845640347 .taskText{text-anchor:middle;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 .taskText:not([font-size]){font-size:11px}#mermaid-1587845640347 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587845640347 .task.clickable{cursor:pointer}#mermaid-1587845640347 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587845640347 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587845640347 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587845640347 .taskText0,#mermaid-1587845640347 .taskText1,#mermaid-1587845640347 .taskText2,#mermaid-1587845640347 .taskText3{fill:#fff}#mermaid-1587845640347 .task0,#mermaid-1587845640347 .task1,#mermaid-1587845640347 .task2,#mermaid-1587845640347 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587845640347 .taskTextOutside0,#mermaid-1587845640347 .taskTextOutside2{fill:#000}#mermaid-1587845640347 .taskTextOutside1,#mermaid-1587845640347 .taskTextOutside3{fill:#000}#mermaid-1587845640347 .active0,#mermaid-1587845640347 .active1,#mermaid-1587845640347 .active2,#mermaid-1587845640347 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587845640347 .activeText0,#mermaid-1587845640347 .activeText1,#mermaid-1587845640347 .activeText2,#mermaid-1587845640347 .activeText3{fill:#000 !important}#mermaid-1587845640347 .done0,#mermaid-1587845640347 .done1,#mermaid-1587845640347 .done2,#mermaid-1587845640347 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587845640347 .doneText0,#mermaid-1587845640347 .doneText1,#mermaid-1587845640347 .doneText2,#mermaid-1587845640347 .doneText3{fill:#000 !important}#mermaid-1587845640347 .crit0,#mermaid-1587845640347 .crit1,#mermaid-1587845640347 .crit2,#mermaid-1587845640347 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587845640347 .activeCrit0,#mermaid-1587845640347 .activeCrit1,#mermaid-1587845640347 .activeCrit2,#mermaid-1587845640347 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587845640347 .doneCrit0,#mermaid-1587845640347 .doneCrit1,#mermaid-1587845640347 .doneCrit2,#mermaid-1587845640347 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587845640347 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587845640347 .milestoneText{font-style:italic}#mermaid-1587845640347 .doneCritText0,#mermaid-1587845640347 .doneCritText1,#mermaid-1587845640347 .doneCritText2,#mermaid-1587845640347 .doneCritText3{fill:#000 !important}#mermaid-1587845640347 .activeCritText0,#mermaid-1587845640347 .activeCritText1,#mermaid-1587845640347 .activeCritText2,#mermaid-1587845640347 .activeCritText3{fill:#000 !important}#mermaid-1587845640347 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 g.classGroup text{fill:#9370db;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587845640347 g.classGroup text .title{font-weight:bolder}#mermaid-1587845640347 g.clickable{cursor:pointer}#mermaid-1587845640347 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587845640347 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587845640347 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587845640347 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587845640347 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587845640347 .dashed-line{stroke-dasharray:3}#mermaid-1587845640347 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640347 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640347 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587845640347 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587845640347 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640347 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640347 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640347 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640347 .commit-id,#mermaid-1587845640347 .commit-msg,#mermaid-1587845640347 .branch-label{fill:lightgrey;color:lightgrey;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 .slice{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640347 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587845640347 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587845640347 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587845640347 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587845640347 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587845640347 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587845640347 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587845640347 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587845640347 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587845640347 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587845640347 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: '"trebuchet ms", verdana, arial';--mermaid-font-family: "Comic Sans MS", "Comic Sans", cursive}

:root { --mermaid-font-family: "trebuchet ms", verdana, arial;}</style><style>#mermaid-1587845640347 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal "trebuchet ms", verdana, arial;
  }</style><g></g><g><line id="actor0" x1="75" y1="5" x2="75" y2="691" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="75" dy="0">Client</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="691" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="275" dy="0">Orchestrator</tspan></text></g><g><line id="actor2" x1="475" y1="5" x2="475" y2="691" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="475" dy="0">Hub</tspan></text></g><g><line id="actor3" x1="675" y1="5" x2="675" y2="691" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="600" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="675" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="675" dy="0">TestOrchestration</tspan></text></g><g><line id="actor4" x1="875" y1="5" x2="875" y2="691" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="800" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="875" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="875" dy="0">Worker</tspan></text></g><g><line id="actor5" x1="1075" y1="5" x2="1075" y2="691" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1000" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1075" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="1075" dy="0">TaskActivity</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><g><text x="175" y="93" class="messageText" style="text-anchor: middle;">ExecutionStarted</text><line x1="75" y1="100" x2="275" y2="100" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="375" y="128" class="messageText" style="text-anchor: middle;">ExecutionStarted</text><line x1="275" y1="135" x2="475" y2="135" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="575" y="163" class="messageText" style="text-anchor: middle;">Orchestration Invoked</text><line x1="475" y1="170" x2="675" y2="170" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="675" y="198" class="messageText" style="text-anchor: middle;">TaskScheduled</text><line x1="475" y1="205" x2="875" y2="205" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="675" y="233" class="messageText" style="text-anchor: middle;">Task Scheduled</text><line x1="875" y1="240" x2="475" y2="240" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="775" y="268" class="messageText" style="text-anchor: middle;">Task Invoked</text><line x1="475" y1="275" x2="1075" y2="275" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="1070" y="277" fill="#EDF2AE" stroke="#666" width="10" height="200" rx="0" ry="0" class="activation0"></rect></g><g><rect x="0" y="285" fill="#EDF2AE" stroke="#666" width="150" height="52" rx="0" ry="0" class="note"></rect><text x="-4" y="309" class="noteText"><tspan x="16">After 5 seconds of </tspan></text><text x="-4" y="325" class="noteText"><tspan x="16"> waiting</tspan></text></g><g><text x="175" y="365" class="messageText" style="text-anchor: middle;">ExecutionTerminated</text><line x1="75" y1="372" x2="275" y2="372" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="375" y="400" class="messageText" style="text-anchor: middle;">ExecutionTerminated</text><line x1="275" y1="407" x2="475" y2="407" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="375" y="435" class="messageText" style="text-anchor: middle;">TaskCompleted</text><line x1="475" y1="442" x2="275" y2="442" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="772.5" y="470" class="messageText" style="text-anchor: middle;">Task Finished</text><line x1="1070" y1="477" x2="475" y2="477" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="375" y="505" class="messageText" style="text-anchor: middle;">TaskCompleted</text><line x1="275" y1="512" x2="475" y2="512" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><rect x="400" y="522" fill="#EDF2AE" stroke="#666" width="150" height="84" rx="0" ry="0" class="note"></rect><text x="396" y="546" class="noteText"><tspan x="416">Since the </tspan></text><text x="396" y="562" class="noteText"><tspan x="416"> orchestration is</tspan></text><text x="396" y="578" class="noteText"><tspan x="416"> already terminated </tspan></text><text x="396" y="594" class="noteText"><tspan x="416"> - No-Op</tspan></text></g><g><rect x="0" y="626" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="658.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="75" dy="0">Client</tspan></text></g><g><rect x="200" y="626" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="658.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="275" dy="0">Orchestrator</tspan></text></g><g><rect x="400" y="626" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="658.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="475" dy="0">Hub</tspan></text></g><g><rect x="600" y="626" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="675" y="658.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="675" dy="0">TestOrchestration</tspan></text></g><g><rect x="800" y="626" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="875" y="658.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="875" dy="0">Worker</tspan></text></g><g><rect x="1000" y="626" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1075" y="658.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="1075" dy="0">TaskActivity</tspan></text></g></svg></div>
<p>So the terminate request is again sent as a message in the queue. The orchestrator gets the event and puts it in the session state.
Whenever the Hub receives an event, it checks its existing list of old events from the session state and builds up the current state.
So whenever the next set of TaskCompletion events, it will all result in a No-Op. The termination is asynchronous. There isn’t any facility to cancel ongoing TaskActivities, and only new ones will not be triggered.</p>
<h3>Activity Middlewares</h3>
<p>The DTF Framework supports middlewares for plugging into the Activity and Orchestration execution flow. They are pretty simple to solve it and works how you would expect any middlewares to work.</p>
<div class="gatsby-highlight" data-language="csharp"><pre style="counter-reset: linenumber NaN" class="language-csharp line-numbers"><code class="language-csharp">hubWorker<span class="token punctuation">.</span><span class="token function">AddActivityDispatcherMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> activity <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetProperty</span><span class="token punctuation">&lt;</span><span class="token class-name">TaskActivity</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> instance <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetProperty</span><span class="token punctuation">&lt;</span><span class="token class-name">OrchestrationInstance</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Activity Details - "</span> <span class="token operator">+</span> activity<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" Id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span>InstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The delegate that you pass to <code class="language-text">AddActivityDispatcherMiddleware</code> is invoked just before the TaskActivity gets invoked</p>
<div class="mermaid" data-processed="true"><svg id="mermaid-1587845640346" width="100%" xmlns="http://www.w3.org/2000/svg" height="100%" style="max-width:650px;" viewBox="-50 -10 650 344"><style>#mermaid-1587845640346 .label{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);color:#333}#mermaid-1587845640346 .label text{fill:#333}#mermaid-1587845640346 .node rect,#mermaid-1587845640346 .node circle,#mermaid-1587845640346 .node ellipse,#mermaid-1587845640346 .node polygon,#mermaid-1587845640346 .node path{fill:#ECECFF;stroke:#9370db;stroke-width:1px}#mermaid-1587845640346 .node .label{text-align:center}#mermaid-1587845640346 .node.clickable{cursor:pointer}#mermaid-1587845640346 .arrowheadPath{fill:#333}#mermaid-1587845640346 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1587845640346 .edgeLabel{background-color:#e8e8e8;text-align:center}#mermaid-1587845640346 .cluster rect{fill:#ffffde;stroke:#aa3;stroke-width:1px}#mermaid-1587845640346 .cluster text{fill:#333}#mermaid-1587845640346 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1587845640346 .actor{stroke:#ccf;fill:#ECECFF}#mermaid-1587845640346 text.actor{fill:#000;stroke:none}#mermaid-1587845640346 .actor-line{stroke:grey}#mermaid-1587845640346 .messageLine0{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1587845640346 .messageLine1{stroke-width:1.5;stroke-dasharray:'2 2';stroke:#333}#mermaid-1587845640346 #arrowhead{fill:#333}#mermaid-1587845640346 .sequenceNumber{fill:#fff}#mermaid-1587845640346 #sequencenumber{fill:#333}#mermaid-1587845640346 #crosshead path{fill:#333 !important;stroke:#333 !important}#mermaid-1587845640346 .messageText{fill:#333;stroke:none}#mermaid-1587845640346 .labelBox{stroke:#ccf;fill:#ECECFF}#mermaid-1587845640346 .labelText{fill:#000;stroke:none}#mermaid-1587845640346 .loopText{fill:#000;stroke:none}#mermaid-1587845640346 .loopLine{stroke-width:2;stroke-dasharray:'2 2';stroke:#ccf}#mermaid-1587845640346 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1587845640346 .noteText{fill:black;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:14px}#mermaid-1587845640346 .activation0{fill:#f4f4f4;stroke:#666}#mermaid-1587845640346 .activation1{fill:#f4f4f4;stroke:#666}#mermaid-1587845640346 .activation2{fill:#f4f4f4;stroke:#666}#mermaid-1587845640346 .mermaid-main-font{font-family:"trebuchet ms", verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 .section{stroke:none;opacity:0.2}#mermaid-1587845640346 .section0{fill:rgba(102,102,255,0.49)}#mermaid-1587845640346 .section2{fill:#fff400}#mermaid-1587845640346 .section1,#mermaid-1587845640346 .section3{fill:#fff;opacity:0.2}#mermaid-1587845640346 .sectionTitle0{fill:#333}#mermaid-1587845640346 .sectionTitle1{fill:#333}#mermaid-1587845640346 .sectionTitle2{fill:#333}#mermaid-1587845640346 .sectionTitle3{fill:#333}#mermaid-1587845640346 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 .grid .tick{stroke:#d3d3d3;opacity:0.8;shape-rendering:crispEdges}#mermaid-1587845640346 .grid .tick text{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 .grid path{stroke-width:0}#mermaid-1587845640346 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1587845640346 .task{stroke-width:2}#mermaid-1587845640346 .taskText{text-anchor:middle;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 .taskText:not([font-size]){font-size:11px}#mermaid-1587845640346 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1587845640346 .task.clickable{cursor:pointer}#mermaid-1587845640346 .taskText.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587845640346 .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587845640346 .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163 !important;font-weight:bold}#mermaid-1587845640346 .taskText0,#mermaid-1587845640346 .taskText1,#mermaid-1587845640346 .taskText2,#mermaid-1587845640346 .taskText3{fill:#fff}#mermaid-1587845640346 .task0,#mermaid-1587845640346 .task1,#mermaid-1587845640346 .task2,#mermaid-1587845640346 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1587845640346 .taskTextOutside0,#mermaid-1587845640346 .taskTextOutside2{fill:#000}#mermaid-1587845640346 .taskTextOutside1,#mermaid-1587845640346 .taskTextOutside3{fill:#000}#mermaid-1587845640346 .active0,#mermaid-1587845640346 .active1,#mermaid-1587845640346 .active2,#mermaid-1587845640346 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1587845640346 .activeText0,#mermaid-1587845640346 .activeText1,#mermaid-1587845640346 .activeText2,#mermaid-1587845640346 .activeText3{fill:#000 !important}#mermaid-1587845640346 .done0,#mermaid-1587845640346 .done1,#mermaid-1587845640346 .done2,#mermaid-1587845640346 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1587845640346 .doneText0,#mermaid-1587845640346 .doneText1,#mermaid-1587845640346 .doneText2,#mermaid-1587845640346 .doneText3{fill:#000 !important}#mermaid-1587845640346 .crit0,#mermaid-1587845640346 .crit1,#mermaid-1587845640346 .crit2,#mermaid-1587845640346 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1587845640346 .activeCrit0,#mermaid-1587845640346 .activeCrit1,#mermaid-1587845640346 .activeCrit2,#mermaid-1587845640346 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1587845640346 .doneCrit0,#mermaid-1587845640346 .doneCrit1,#mermaid-1587845640346 .doneCrit2,#mermaid-1587845640346 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1587845640346 .milestone{transform:rotate(45deg) scale(0.8, 0.8)}#mermaid-1587845640346 .milestoneText{font-style:italic}#mermaid-1587845640346 .doneCritText0,#mermaid-1587845640346 .doneCritText1,#mermaid-1587845640346 .doneCritText2,#mermaid-1587845640346 .doneCritText3{fill:#000 !important}#mermaid-1587845640346 .activeCritText0,#mermaid-1587845640346 .activeCritText1,#mermaid-1587845640346 .activeCritText2,#mermaid-1587845640346 .activeCritText3{fill:#000 !important}#mermaid-1587845640346 .titleText{text-anchor:middle;font-size:18px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 g.classGroup text{fill:#9370db;stroke:none;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family);font-size:10px}#mermaid-1587845640346 g.classGroup text .title{font-weight:bolder}#mermaid-1587845640346 g.clickable{cursor:pointer}#mermaid-1587845640346 g.classGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587845640346 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587845640346 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587845640346 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1587845640346 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587845640346 .dashed-line{stroke-dasharray:3}#mermaid-1587845640346 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640346 #compositionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640346 #aggregationStart{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587845640346 #aggregationEnd{fill:#ECECFF;stroke:#9370db;stroke-width:1}#mermaid-1587845640346 #dependencyStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640346 #dependencyEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640346 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640346 #extensionEnd{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1587845640346 .commit-id,#mermaid-1587845640346 .commit-msg,#mermaid-1587845640346 .branch-label{fill:lightgrey;color:lightgrey;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 .pieTitleText{text-anchor:middle;font-size:25px;fill:#000;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 .slice{font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}#mermaid-1587845640346 g.stateGroup text{fill:#9370db;stroke:none;font-size:10px}#mermaid-1587845640346 g.stateGroup .state-title{font-weight:bolder;fill:#000}#mermaid-1587845640346 g.stateGroup rect{fill:#ECECFF;stroke:#9370db}#mermaid-1587845640346 g.stateGroup line{stroke:#9370db;stroke-width:1}#mermaid-1587845640346 .transition{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1587845640346 .stateGroup .composit{fill:white;border-bottom:1px}#mermaid-1587845640346 .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px}#mermaid-1587845640346 .state-note{stroke:#aa3;fill:#fff5ad}#mermaid-1587845640346 .state-note text{fill:black;stroke:none;font-size:10px}#mermaid-1587845640346 .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5}#mermaid-1587845640346 .stateLabel text{fill:#000;font-size:10px;font-weight:bold;font-family:'trebuchet ms', verdana, arial;font-family:var(--mermaid-font-family)}:root{--mermaid-font-family: '"trebuchet ms", verdana, arial';--mermaid-font-family: "Comic Sans MS", "Comic Sans", cursive}

:root { --mermaid-font-family: "trebuchet ms", verdana, arial;}</style><style>#mermaid-1587845640346 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal "trebuchet ms", verdana, arial;
  }</style><g></g><g><line id="actor0" x1="75" y1="5" x2="75" y2="333" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="75" dy="0">Hub</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="333" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="275" dy="0">Middleware</tspan></text></g><g><line id="actor2" x1="475" y1="5" x2="475" y2="333" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="475" dy="0">TaskActivity</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><g><rect x="0" y="75" fill="#EDF2AE" stroke="#666" width="150" height="68" rx="0" ry="0" class="note"></rect><text x="-4" y="99" class="noteText"><tspan x="16">Hub receives </tspan></text><text x="-4" y="115" class="noteText"><tspan x="16"> the TaskScheduled </tspan></text><text x="-4" y="131" class="noteText"><tspan x="16"> event</tspan></text></g><g><text x="175" y="171" class="messageText" style="text-anchor: middle;">Middleware Invoked</text><line x1="75" y1="178" x2="275" y2="178" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="175" y="206" class="messageText" style="text-anchor: middle;">Middleware Execution Complete</text><line x1="275" y1="213" x2="75" y2="213" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="275" y="241" class="messageText" style="text-anchor: middle;">Task Invoked</text><line x1="75" y1="248" x2="475" y2="248" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="0" y="268" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="300.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="75" dy="0">Hub</tspan></text></g><g><rect x="200" y="268" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="300.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="275" dy="0">Middleware</tspan></text></g><g><rect x="400" y="268" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="300.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px;"><tspan x="475" dy="0">TaskActivity</tspan></text></g></svg></div>
<p>The middlewares get invoked in the same thread as Tasks, and they individually do not have any reliability. There is no state marker to show middleware was run successfully, but the Task failed. Middlewares get invoked for all tasks irrespective if the Task had failed in its previous run or not. It is agnostic to the Task triggering the middleware.</p>
<p>Also, the middleware cannot be used to handle task failures. You cannot put a try-catch around the <code class="language-text">next()</code> call. The Exceptions thrown by the Task are caught and swallowed by the framework in the <em>TaskDispatcher</em> part of the code, and the middlewares do not receive it.</p>
<h4>Potential Gotcha!</h4>
<p>Middlewares, if they fail, will fail the Task as well. Interestingly , such failures <strong>do not trigger the <code class="language-text">TaskFailed</code> event</strong>. But since the TaskScheduled message is not removed from the queue, the Hub keeps retrying and gives up when the limit is reached. Since the TaskFailed event was not generated, Azure Table Storage would also not show that the Task had failed. </p>
<p>Here is an example when one task completes, and others fail due to a failure in the middleware. <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/blog/static/91116b4a7188b097891bc8fc56884dd4/96658/TableStore.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+ElEQVQY002NTU4CQRCF57puDHHjDTyEpyCjiTsTVAwrB4IYEzNdXdXd8wcCbgRWz+p2MmHx8l79fZXdzn5x/XDC1f0Rl7nqrld+VueHvn8a5iPdvxgfcfN4QNOs0XRb1O03suKrwWzl8LxgPC0EL0unzpgUlPJkbjF990mxjv66Cpgufdoryg3mnxZvHwRT7ZE1dQUvDLEGjkmzhZBJipmpROUl5eh1cAiO4XS/1nrTtRBmkDH42SswhBrWMkqjH8gOuSzN0DPqLA7MonIpi/Np1nbr4Wa7i8CqgtUP8YgisM//MqlHRD1MIAqLAO9D8i4C+5udAv8ATixg3fcEHYUAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Store"
        title="Store"
        src="/blog/static/91116b4a7188b097891bc8fc56884dd4/fcda8/TableStore.png"
        srcset="/blog/static/91116b4a7188b097891bc8fc56884dd4/12f09/TableStore.png 148w,
/blog/static/91116b4a7188b097891bc8fc56884dd4/e4a3f/TableStore.png 295w,
/blog/static/91116b4a7188b097891bc8fc56884dd4/fcda8/TableStore.png 590w,
/blog/static/91116b4a7188b097891bc8fc56884dd4/96658/TableStore.png 881w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span> </p>
<p>The store has all the data about <em>Task1</em> till it was scheduled. One would be excused for thinking that <em>Task1</em> was never picked up, and there is something wrong with DTF.</p>
<p>What happened was, our middleware threw an exception when it was run in the context of <em>Task1</em>, but in other cases, it passed. Hence there is no data for <em>Task1</em> failing. This behavior is something to keep in mind when debugging the failures.</p>
<h3>Orchestration Middlewares</h3>
<div class="gatsby-highlight" data-language="csharp"><pre style="counter-reset: linenumber NaN" class="language-csharp line-numbers"><code class="language-csharp"> hubWorker<span class="token punctuation">.</span><span class="token function">AddOrchestrationDispatcherMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> orchestration <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetProperty</span><span class="token punctuation">&lt;</span><span class="token class-name">TaskOrchestration</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> state <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetProperty</span><span class="token punctuation">&lt;</span><span class="token class-name">OrchestrationRuntimeState</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> instance <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetProperty</span><span class="token punctuation">&lt;</span><span class="token class-name">OrchestrationInstance</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"\n   orchestration Details - "</span> <span class="token operator">+</span> orchestration<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" Id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span>InstanceId <span class="token operator">+</span> <span class="token string">"state = "</span> <span class="token operator">+</span> state<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Count <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Orchestration Middlewares work and behave the same way as the TaskActivity middlewares. The middleware gets invoked <em>each time</em> the orchestration gets invoked. Similar to activity middlewares a try-catch would not be able to catch exceptions from Orchestrations.</p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwAC/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAARJ1hYp4LCVeK1I//8QAGxAAAgIDAQAAAAAAAAAAAAAAAQMAAhESITL/2gAIAQEAAQUCfDvlXm1NytZYQkrluHJqFnn/xAAZEQADAAMAAAAAAAAAAAAAAAAAARECEDH/2gAIAQMBAT8BqFIZd1//xAAZEQACAwEAAAAAAAAAAAAAAAAAAQIQETH/2gAIAQIBAT8BSHukeV//xAAaEAADAAMBAAAAAAAAAAAAAAAAARECIXFB/9oACAEBAAY/AsEPKmi2JDr0RbQulXo+n//EABsQAQADAQADAAAAAAAAAAAAAAEAETEhQYHB/9oACAEBAAE/IUWxewnY3JVVmrin9DObVUQ0lg/a7mE+Ubk7qJ7E/9oADAMBAAIAAwAAABBkH4P/xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAEDAQE/EGjc0Hp//8QAGBEBAAMBAAAAAAAAAAAAAAAAAQAQETH/2gAIAQIBAT8QTDISjJwr/8QAHBABAAMBAAMBAAAAAAAAAAAAAQARITFhcZFR/9oACAEBAAE/EMcN2Lf0irYHBlHHxyX/AEPXwR+7O1ar4fIpMxhScITZ1HD6fkaBjP3rBOiBeopkFUn/2Q==" alt="Abhik Mitra" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/blog/static/f693cb87ce63b88a182a754d2cdcea1a/99438/profile-pic.jpg 1x,
/blog/static/f693cb87ce63b88a182a754d2cdcea1a/aba1d/profile-pic.jpg 1.5x,
/blog/static/f693cb87ce63b88a182a754d2cdcea1a/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/blog/static/f693cb87ce63b88a182a754d2cdcea1a/99438/profile-pic.jpg 1x,
/blog/static/f693cb87ce63b88a182a754d2cdcea1a/aba1d/profile-pic.jpg 1.5x,
/blog/static/f693cb87ce63b88a182a754d2cdcea1a/b315d/profile-pic.jpg 2x" src="/blog/static/f693cb87ce63b88a182a754d2cdcea1a/99438/profile-pic.jpg" alt="Abhik Mitra" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Abhik Mitra</strong> <!-- -->who lives in Bangalore and loves building and learning new things.<!-- --> <a href="https://twitter.com/complancoder">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/blog/durable-task-3/">← <!-- -->Durable Task Framework Internals - Part 3 (Tracker Queue, Instance History, and JumpStart)</a></li><li></li></ul></nav></main><footer><hr/></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-164581916-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/durable-task-4/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-2cb18ef149383859188d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-603e003d35c7316a3610.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c720a9d310a7ee983590.js"],"component---src-pages-index-js":["/component---src-pages-index-js-605690f47d5f32fd4fd2.js"]};/*]]>*/</script><script src="/blog/webpack-runtime-c593f8b747f91b29dbc3.js" async=""></script><script src="/blog/styles-55b12e3f12e70f5e0cab.js" async=""></script><script src="/blog/framework-624f79e66261973aaa49.js" async=""></script><script src="/blog/app-2cb18ef149383859188d.js" async=""></script><script src="/blog/commons-257f2cc47edbd46eb2b4.js" async=""></script><script src="/blog/69ca9dfa785447e3d8b116b383997bcdc8df623a-e846e6165360833579bc.js" async=""></script><script src="/blog/component---src-templates-blog-post-js-603e003d35c7316a3610.js" async=""></script></body></html>