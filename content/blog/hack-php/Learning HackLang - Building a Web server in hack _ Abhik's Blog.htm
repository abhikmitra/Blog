<!DOCTYPE html>
<!-- saved from url=(0031)http://localhost:8000/hack-php/ -->
<html lang="en" data-react-helmet="lang"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="apple-touch-icon" sizes="256x256" href="http://localhost:8000/icons/icon-256x256.png?v=fd6b8e1352aaa808d8b27a40db102c0c"><meta name="note" content="environment=development"><link rel="icon" href="http://localhost:8000/icons/icon-48x48.png?v=fd6b8e1352aaa808d8b27a40db102c0c"><link rel="manifest" href="http://localhost:8000/manifest.webmanifest"><meta name="theme-color" content="#663399"><link rel="apple-touch-icon" sizes="48x48" href="http://localhost:8000/icons/icon-48x48.png?v=fd6b8e1352aaa808d8b27a40db102c0c"><link rel="apple-touch-icon" sizes="72x72" href="http://localhost:8000/icons/icon-72x72.png?v=fd6b8e1352aaa808d8b27a40db102c0c"><link rel="apple-touch-icon" sizes="96x96" href="http://localhost:8000/icons/icon-96x96.png?v=fd6b8e1352aaa808d8b27a40db102c0c"><link rel="apple-touch-icon" sizes="144x144" href="http://localhost:8000/icons/icon-144x144.png?v=fd6b8e1352aaa808d8b27a40db102c0c"><link rel="apple-touch-icon" sizes="192x192" href="http://localhost:8000/icons/icon-192x192.png?v=fd6b8e1352aaa808d8b27a40db102c0c"><link rel="alternate" type="application/rss+xml" href="http://localhost:8000/rss.xml"><link rel="apple-touch-icon" sizes="384x384" href="http://localhost:8000/icons/icon-384x384.png?v=fd6b8e1352aaa808d8b27a40db102c0c"><link rel="apple-touch-icon" sizes="512x512" href="http://localhost:8000/icons/icon-512x512.png?v=fd6b8e1352aaa808d8b27a40db102c0c"><title>Learning HackLang - Building a Web server in hack | Abhik's Blog</title><link rel="sitemap" type="application/xml" href="http://localhost:8000/sitemap.xml"><script src="./Learning HackLang - Building a Web server in hack _ Abhik&#39;s Blog_files/socket.io.js"></script><link type="text/css" rel="stylesheet" href="blob:http://localhost:8000/9c1c0ec3-c59e-4735-a352-b76c31cc76b3"><link type="text/css" rel="stylesheet" href="blob:http://localhost:8000/671cef16-96cc-41aa-a3af-bf7086b2ebe8"><link type="text/css" rel="stylesheet" href="blob:http://localhost:8000/2635a899-7873-415d-96c2-d4c160300b77"><meta property="og:type" content="website" data-react-helmet="true"><meta name="twitter:card" content="summary" data-react-helmet="true"><meta name="twitter:creator" content="complancoder" data-react-helmet="true"><meta name="linkedIn" content="https://www.linkedin.com/in/iamabhik/" data-react-helmet="true"><meta name="description" content="In this post, we will talk about Hack and how to create a Webserver in HackLang." data-react-helmet="true"><meta property="og:title" content="Learning HackLang - Building a Web server in hack" data-react-helmet="true"><meta property="og:description" content="In this post, we will talk about Hack and how to create a Webserver in HackLang." data-react-helmet="true"><meta name="twitter:title" content="Learning HackLang - Building a Web server in hack" data-react-helmet="true"><meta name="twitter:description" content="In this post, we will talk about Hack and how to create a Webserver in HackLang." data-react-helmet="true"></head><body cz-shortcut-listen="true"><div id="___gatsby"><div tabindex="-1" id="gatsby-focus-wrapper" style="outline: none;"><div style="margin-left: auto; margin-right: auto; max-width: 42rem; padding: 2.625rem 1.3125rem;"><header><h3 style="font-family: Montserrat, sans-serif; margin-top: 0px;"><a href="http://localhost:8000/" style="box-shadow: none; color: inherit;">Abhik's Blog</a></h3></header><main><article><header><h1 style="margin-top: 1.75rem; margin-bottom: 0px;">Learning HackLang - Building a Web server in hack</h1><p style="font-size: 0.83255rem; line-height: 1.75rem; display: block; margin-bottom: 1.75rem;">September 27, 2020</p></header><section><h2>Web Server in Hack</h2>
<p>When I started learning Hack, one of the problems I ran into was the lack of Open Source projects(Web Servers) in Hack. I was not able to find examples or a guide on how to set up a barebones web server. This post will breakdown the process of getting started building a small webserver. This assumes that you know the syntax and the concepts. The documentation is great when it comes to explaining the features of the language, so that’s out of scope for this post. </p>
<p>The completed project can be found <a href="https://github.com/abhikmitra/hack-memcache-mysql-web-server">here</a> </p>
<p>Do you think there is more that I should cover or something I should fix? Please raise an <a href="https://github.com/abhikmitra/blog/issues">issue</a> and let me know.</p>
<hr>
<p>Before starting hack, I had worked majorly on Typescript (Javascript), C#, and Java. If you have worked on those languages, this post will be more relevant as I draw a comparison with those stacks.</p>
<p><strong>Disclaimer</strong> - This post was a part of my Learning exercise, this should not be taken as best practice or the correct way to write code in Hack. If you are also trying to get your hands dirty with <a href="https://hacklang.org/">hacklang</a>, this should be useful</p>
<h3>Setting up the repo</h3>
<p>Before you start, I am assuming you have already gone through the Official <a href="https://docs.hhvm.com/hack/getting-started/getting-started">Getting Started</a> tutorial.</p>
<h4>Autoload</h4>
<p>This was a new concept for me. In NodeJs we explicitly require the files and the engine travels the interpreter and loads all the files. In C#, including files was never a problem since the IDE generates the project &amp; solution files. In Hack, you can go the “require each file” route but configuring Autoloader is the best practice. So you need to create a <code class="language-text">hh_autoload.json</code>. Steps are detailed <a href="https://docs.hhvm.com/hack/getting-started/starting-a-real-project">here</a>.</p>
<p>Now the file itself insufficient for the hack interpreter to autoload everything. There are two more steps that you need to be aware of. Firstly, when you add anything to composer.json the autoload files are generated inside the vendor folder as shown below  </p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;">
      <a class="gatsby-resp-image-link" href="http://localhost:8000/static/b6d50d9f2f386517c239821daf7c304e/47218/autoload.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 31.08108108108108%; position: relative; bottom: 0; left: 0; background-image: url(&#39;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABAklEQVQY03WQ6U7EIBRG+x52ZV8KdGHacTTRxPd/ps8LTTST6I8TCimHA03OB2JM4FxCCFUp38ZYpBihlIYUElqbSplPE8M4Tn/SHLcTISQwJp6EjHNIGrX1ECSfGEkYbZpGdF33L00KpcI8FQoqYoxDkcglD+6oStOakRg4Q9t2aGlzGV/aS9T3faWJfobTpUBU6YWoQu8sluBgtYARDIrQBKdSIzicEpVpHH6kTd4y9nWHtTO9m6d3coStlcEafB0rPon3PeKeNzyItzXgQWzewitZD/gV7idyPuFcqNIiK5RCSz9/3BbcF4/XdSbJjHuakan6jB6rMzCS18JhuK78DapRrdEFh0rKAAAAAElFTkSuQmCC&#39;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Autoload" title="Autoload" src="./Learning HackLang - Building a Web server in hack _ Abhik&#39;s Blog_files/autoload.png" srcset="/static/b6d50d9f2f386517c239821daf7c304e/12f09/autoload.png 148w,
/static/b6d50d9f2f386517c239821daf7c304e/e4a3f/autoload.png 295w,
/static/b6d50d9f2f386517c239821daf7c304e/fcda8/autoload.png 590w,
/static/b6d50d9f2f386517c239821daf7c304e/efc66/autoload.png 885w,
/static/b6d50d9f2f386517c239821daf7c304e/c83ae/autoload.png 1180w,
/static/b6d50d9f2f386517c239821daf7c304e/47218/autoload.png 1344w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span> </p>
<p>The autoload file is simply a huge dictionary that has a mapping between the class name(including the namespace) and their corresponding path. So when you use <code class="language-text">use HackFacebook\UiServer\Http</code> statement, the interpreter checks this file to figure out the actual location of the hack file. So you need to make sure this is updated, especially when you add new files or move stuff around.
The Hacklang doc says to use <code class="language-text">vendor/bin/hh-autoload</code> to regenerate the map. I used <code class="language-text">composer dump-autoload</code> to regenerate the file and it worked fine.</p>
<h4>Composer</h4>
<p>Composer is the PHP package management solution. If you are coming from Nodejs background, this is exactly like NPM with its <code class="language-text">package.json</code>(composer.json) and <code class="language-text">package-lock.json</code>(composer.lock) so no surprises there.</p>
<h4>hhconfig</h4>
<p>You would need a <code class="language-text">hhconfig</code> file. The <a href="https://github.com/abhikmitra/hack-memcache-mysql-web-server/blob/master/ui-server/.hhconfig">one I used</a> was also pretty barebones. Before you can use FixMe codes to override the hh<em>client errors you need to declare the allowed fixme</em>codes in the config. this is a recent change in June 2020. You can read more about this change <a href="https://hhvm.com/blog/2020/06/16/hhvm-4.62.html">here in HHVM releases</a>.</p>
<h4>config</h4>
<p>You would need a <a href="https://github.com/abhikmitra/hack-memcache-mysql-web-server/blob/master/ui-server/config.ini">config.ini</a>. It will have a config for your web server. Could be any name, you need to specify when you start your server.</p>
<h4>Debugging &amp; Development</h4>
<p>I used the <a href="https://github.com/slackhq/vscode-hack">vscode-hack</a> by Slack. It only works if the root is a Hack project. For example, if you open the top-level folder in the <a href="https://github.com/abhikmitra/hack-memcache-mysql-web-server">repo</a> through VScode the plugin won’t work. But instead, if you open the [ui-Server](<a href="https://github.com/abhikmitra/hack-memcache-mysql-web-server/tree/master/ui-server">https://github.com/abhikmitra/hack-memcache-mysql-web-server/tree/master/ui-server</a> , the plugin will work and you should be able to see red squiggly lines for errors.
So if you are starting on a hack project, make sure the root that you open in VS code has the hhconfig,hh_autload, and vendor. </p>
<p>Also, to get type errors in VS code you need to have hh_client daemon running. starting it is simple </p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">hh_client start</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Sometimes I saw it git frozen or the hints not working properly. A simple restart of the hh_client fixed the problem.</p>
<p>So now you all you need is to add an <a href="https://docs.hhvm.com/hack/getting-started/starting-a-real-project">entry point</a> and you should have a basic scaffolding for some Hack code. You can find the finished scaffolding <a href="https://github.com/abhikmitra/hack-memcache-mysql-web-server/tree/master/scaffolding-generic">here</a></p>
<h3>Creating the Webserver</h3>
<p>Now that we have a functioning repo setup, let’s look at how to create a web server.
The overall request flow looks like this. If you are from an <code class="language-text">ASP.NET</code> background the #1 part will look strange to you as that is something that the Framework takes care of and not something you think of.
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;">
      <a class="gatsby-resp-image-link" href="http://localhost:8000/static/7be07baa3c38e0b284a6af78bc1f1f21/29229/arch.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url(&#39;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA20lEQVQoz3VSCw7DIAj1/kdtmqx+WtsiMh/WRTdHQkJ4H6jUyBM551ZoPSSzQtY6CWHXmjkL5zEpsZgmQhz7LolIDb6TSt9uVpZlkXVd5TxP7RHdct+3LoIhRroA+C9ijLKHoOLruiSlpAZYBr38bGlAROq0AsTj0OkQgIgaBlrHWoPfvorL9qEMgo4oifHei3OuEkvTWqsEGEAI/Ch93bA8CTBw+HlXDAYnBF8Nh+9qh5kEzCBsB8wTrr5hD86O0TIlUtPXtslWsm3Y6wfDj+nst+mweln64TfDN6L5dqzPClPjAAAAAElFTkSuQmCC&#39;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Architecture" title="Architecture" src="./Learning HackLang - Building a Web server in hack _ Abhik&#39;s Blog_files/arch.png" srcset="/static/7be07baa3c38e0b284a6af78bc1f1f21/12f09/arch.png 148w,
/static/7be07baa3c38e0b284a6af78bc1f1f21/e4a3f/arch.png 295w,
/static/7be07baa3c38e0b284a6af78bc1f1f21/fcda8/arch.png 590w,
/static/7be07baa3c38e0b284a6af78bc1f1f21/efc66/arch.png 885w,
/static/7be07baa3c38e0b284a6af78bc1f1f21/29229/arch.png 1167w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
Another strange aspect was the router setup encourages that each controller only handles one action. So the same controller cannot handle multiple requests.</p>
<h4>Request Routing</h4>
<p>Here the framework itself does not do any routing and the user needs to be explicit about the routing. That is what Facebook has come up with a <code class="language-text">CodeGen</code> that generates the code for a router. Codegens seemed to be pretty common in the Hack ecosystem. That is why it is fairly common to have a scripts folder
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 330px;">
      <a class="gatsby-resp-image-link" href="./Learning HackLang - Building a Web server in hack _ Abhik&#39;s Blog_files/script.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 205.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url(&#39;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAApCAYAAAA1bQl+AAAACXBIWXMAAAsSAAALEgHS3X78AAAFQ0lEQVRIx5VXS28aZxRFXSSRukgrNVIUsI2ZGWZgeAxgjG0GTAAb8ANjsA1+xa9ajl21kZooTdRWXUSRIlWquuuuUvtHT79zyVCTmJgsLt/HN8yZ+zj33MFnmhYcJwXLiqBYXEQ2O4tyuYxKpYpCoYjl5RqSSQeapsMwwreaj4CpVBqxWBybm208flzG3t6+7FdWVrC/v68AkwiFtPEA+REOm/JlejqEQGACjx75lQVk9fsn5JzXdd24HZBg9C6Xm0M0amNtbR3b29totztq3cHTp5fI590B6FiAth2THHK/sJCXXBYKBVmZy0QiOX4OwyqHUQUYidgImwS1YKl9Kp2R86lgCCEBM6Eb5vs1PNJ8lq4hHo0gm05hJpXE2fETHB/s4fvLCzzZ68GJ2dCngwhrIVn7++mR5gukStBzVQRnKjAX6oiV27BKLRiFdeiusvwqrOI6Iu4KjLklaLkl+NU9j5xFWf3OsPnur73E5NZraIdv8XDrV9in72CfvUPq4ndkr/5A6OAN7tSe417jBe43X+Hrjdf4ZvNnfLn6EnfV+d36iyHzPWi9RqDzCg/avwjg3tt/UfvpL3Tf/IP2b3/D/eFPfFF5hjvLPyrgvhHwKwXO/b368yHzTThF2PllmPkG9Pk6HiaKCKTLCGarsk7NVGHM18QsdxVRFbqWLcOfLCCg7vUnh81nqqLEIhZmM2lVFAfnJ0fobDSRTsRVsSwkVMHi6jr3piqMEZoWY5FuMqGNbcdhKsqQJq7qX0e1oq6HhS6aZgysTw3zvY2gjUfsSCQK9jUJzn0sFruRuLe13wCQKkORuLy8kna7uLiA6xYQDE4Pev0zWs8WNbn+dHrL757KcD+2ONDDdDot4dJTWi6Xw/z8gjrPjAX0ESBFlmpTrVZRKj3G4mJJhGF2Nje2MAyFzJsY3sTEpGgidZCrB/bZIc+qEClTBwcHotjdbhdbW9tDIJ8BaEslGTLFlJrIecI9vaa4emBj0YaK3SezgXg8IUOJVaZlMjOi5l7Vx5op5N/2zo4QmsPp9PRMDad+6Lu7ezg7+1ZSQE4S+FMpEA8tS4mobvbbTYXIG73h5RGbXk9NBQd2nZ9DgATK5xOKKpYK3Vb5c4UynCfMIbuFe67Mbf9aUaK6iU4C6LoJ9UPOZwe93q6EubPTxdHRkar0loTPirdaLdnvqPSMmoQSMgeUYRjyRPLQ7w/I6nHSm88Mj+vk5NTIWe3TNFO9eiTRaERVmznodLbFQ3pKLzmfe72eeLi+3pSz3d1dSYOX6w+qbCqgmEq6pvgYlVzR5ubm1YMqElqpVJL8kT5ePtmqN+awT+gYZmZyoNhqIqq6JJ1iwWp6nGSY9IrryCrzg0qz2W4LiU9OToV3x8cnoo2t1qZqx0PU6w15EIHpxHWNvA7qM9/zMBT6v/k9b7y3MnpFj7xi0Dw+ftiSAx4Wi6YShzg2NjZFC6mJzB/zWKvVlJRVsLS0LNLGPq9Wl+Qa0zLkocdDEpuADJEvmVz5FtbpdIR3nU6fj43GipyzFVn1jwD7G1Om2uRkULjHED0+eua1JPNIAC/0j0KOxpPIuItysLq6JsPJ4yGFgvtmc0MAvUJ8WNnhkA2lHlZCHeoqhHV5JWZF6/W68I6cu20MDAHG42EUXEvUhhWlanMwZTIZqbI3pMYdVL5iMYpnz/gvII7Dw0NJOEXh/PwcV1ffqRn9dPAGOyrk4X8BYQNO0lA/DsvbKw9ZOS/5nlKTcyzKbaPAF3GyiMxXEFPF6XZ78tJOrjWbTeEd6cIOYm+zp5mWT+XzP8odA5GlAcHzAAAAAElFTkSuQmCC&#39;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Scripts" title="Scripts" src="./Learning HackLang - Building a Web server in hack _ Abhik&#39;s Blog_files/script.png" srcset="/static/8096378bc849c4d77f651d3db466daae/12f09/script.png 148w,
/static/8096378bc849c4d77f651d3db466daae/e4a3f/script.png 295w,
/static/8096378bc849c4d77f651d3db466daae/d9ecf/script.png 330w" sizes="(max-width: 330px) 100vw, 330px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span> </p>
<p>So to use the <a href="https://github.com/hhvm/hack-router-codegen">hack router codegen</a>, you need to create a file and provide the following details to your code gen</p>
<ul>
<li>Location of controllers</li>
<li>Controller base Interface - This is how the codegen finds which classes are controllers and which are not.</li>
<li>The name and the filename </li>
</ul>
<p>Once you run the Codegen, you will have something that looks like this.</p>
<div class="gatsby-highlight" data-language="hack"><pre style="counter-reset: linenumber NaN" class="language-hack line-numbers"><code class="language-hack">abstract class AutoGeneratedRouterBase
  extends \Facebook\HackRouter\BaseRouter&lt;classname&lt;\HackFacebook\UiServer\Controllers\IRoutableController&gt;&gt; {

  &lt;&lt;__Override&gt;&gt;
  final public function getRoutes(
  ): ImmMap&lt;\Facebook\HackRouter\HttpMethod, ImmMap&lt;string, classname&lt;\HackFacebook\UiServer\Controllers\IRoutableController&gt;&gt;&gt; {
    $map = ImmMap {
      \Facebook\HackRouter\HttpMethod::GET =&gt; ImmMap {
        '/' =&gt; \HackFacebook\UiServer\Controllers\Pages\HomePageController::class,
        '/login' =&gt;
          \HackFacebook\UiServer\Controllers\Pages\LoginPageController::class,
        '/signUp' =&gt;
          \HackFacebook\UiServer\Controllers\Pages\SignUpPageController::class,
      },
      \Facebook\HackRouter\HttpMethod::POST =&gt; ImmMap {
        '/login' =&gt;
          \HackFacebook\UiServer\Controllers\API\LoginPostController::class,
        '/signUp' =&gt;
          \HackFacebook\UiServer\Controllers\API\SignUpPostController::class,
      },
    };
    return $map;
  }
}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>This is simply a map of the route and the class. You can handroll this too using Facebook’s <a href="https://github.com/hhvm/hack-router">HackRouter</a> . The way the router figures out this mapping is through the interfaces that the controller implements. For example, if the class implements <code class="language-text">Facebook\HackRouter\SupportsGetRequests</code> that means the class will be used to get calls. Similarly, each controller needs to override <code class="language-text">getUriPattern</code>  for the codegen to understand which route does this controller serve.</p>
<h4>Controllers and Views</h4>
<p>We will now talk about Part 2 of the section. <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;">
      <a class="gatsby-resp-image-link" href="http://localhost:8000/static/7be07baa3c38e0b284a6af78bc1f1f21/29229/arch.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url(&#39;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA20lEQVQoz3VSCw7DIAj1/kdtmqx+WtsiMh/WRTdHQkJ4H6jUyBM551ZoPSSzQtY6CWHXmjkL5zEpsZgmQhz7LolIDb6TSt9uVpZlkXVd5TxP7RHdct+3LoIhRroA+C9ijLKHoOLruiSlpAZYBr38bGlAROq0AsTj0OkQgIgaBlrHWoPfvorL9qEMgo4oifHei3OuEkvTWqsEGEAI/Ch93bA8CTBw+HlXDAYnBF8Nh+9qh5kEzCBsB8wTrr5hD86O0TIlUtPXtslWsm3Y6wfDj+nst+mweln64TfDN6L5dqzPClPjAAAAAElFTkSuQmCC&#39;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Architecture" title="Architecture" src="./Learning HackLang - Building a Web server in hack _ Abhik&#39;s Blog_files/arch.png" srcset="/static/7be07baa3c38e0b284a6af78bc1f1f21/12f09/arch.png 148w,
/static/7be07baa3c38e0b284a6af78bc1f1f21/e4a3f/arch.png 295w,
/static/7be07baa3c38e0b284a6af78bc1f1f21/fcda8/arch.png 590w,
/static/7be07baa3c38e0b284a6af78bc1f1f21/efc66/arch.png 885w,
/static/7be07baa3c38e0b284a6af78bc1f1f21/29229/arch.png 1167w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span> </p>
<p>The way the controllers are structured in the <a href="https://github.com/abhikmitra/hack-memcache-mysql-web-server/tree/master/ui-server/src/controllers">example repo</a>
Controllers are separated in 2 folders</p>
<ul>
<li>
<p>API</p>
<ul>
<li>Can be Get or Post</li>
<li>Does not return a view</li>
</ul>
</li>
<li>
<p>Pages</p>
<ul>
<li>Can only be GET</li>
<li>Is associated with a view</li>
</ul>
</li>
</ul>
<p>I am not sure of the best practice here, I came up with the model based on how the code in HHVM doc site is structured. One of the idiosyncrasies of hack is that code containing XHP cannot be namespaced. </p>
<p>Now, I love namespaces and also the separation between view and logic. I tried to emulate the NodeJs model where we have controllers and the HTML view completely separate. I couldn’t find data on what exactly is the best practice here so I came up with the view controller separation.</p>
<p><strong>Controller</strong> - Has the business logic and is bound to view using the getView method that all Page controllers need to implement. This also allows controllers to be namespaced as there is no XHP here.</p>
<p><strong>Views</strong> - Has the XHP and they can have different inheritance hierarchy for complex layouts, very similar to how Jade/ views work in Node.JS.</p>
<p>You could choose a different model for your app. There is no restriction from the router/framework side.</p>
<h3>Handling Globals</h3>
<p>There are quite a few global values that you may need. The way I accessed them was to have separate <code class="language-text">globals.hack</code> which was typed and would get data off the globals. That way I could control the <code class="language-text">FixMe</code> proliferation and limit it to only 1 file. Also, I used this library called <code class="language-text">usox/hackttp</code> which allows us to create a Server request using</p>
<div class="gatsby-highlight" data-language="hack"><pre style="counter-reset: linenumber NaN" class="language-hack line-numbers"><code class="language-hack">$request = \Usox\HackTTP\create_server_request_from_globals();</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>without having to access the global variables. </p>
<p>You can see the completed project <a href="https://github.com/abhikmitra/hack-memcache-mysql-web-server">here</a>. I have put all the setup details in the readme. Should be fairly straightforward. Let me know what I should have improved in this scaffolding or if there is a gap in my understanding that I need to fill.</p></section><hr style="margin-bottom: 1.75rem;"><footer><div style="display: flex; margin-bottom: 4.375rem;"><div class=" gatsby-image-wrapper" style="position: relative; overflow: hidden; display: inline-block; width: 50px; height: 50px; margin-right: 0.875rem; margin-bottom: 0px; min-width: 50px; border-radius: 100%;"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwAC/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAARJ1hYp4LCVeK1I//8QAGxAAAgIDAQAAAAAAAAAAAAAAAQMAAhESITL/2gAIAQEAAQUCfDvlXm1NytZYQkrluHJqFnn/xAAZEQADAAMAAAAAAAAAAAAAAAAAARECEDH/2gAIAQMBAT8BqFIZd1//xAAZEQACAwEAAAAAAAAAAAAAAAAAAQIQETH/2gAIAQIBAT8BSHukeV//xAAaEAADAAMBAAAAAAAAAAAAAAAAARECIXFB/9oACAEBAAY/AsEPKmi2JDr0RbQulXo+n//EABsQAQADAQADAAAAAAAAAAAAAAEAETEhQYHB/9oACAEBAAE/IUWxewnY3JVVmrin9DObVUQ0lg/a7mE+Ubk7qJ7E/9oADAMBAAIAAwAAABBkH4P/xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAEDAQE/EGjc0Hp//8QAGBEBAAMBAAAAAAAAAAAAAAAAAQAQETH/2gAIAQIBAT8QTDISjJwr/8QAHBABAAMBAAMBAAAAAAAAAAAAAQARITFhcZFR/9oACAEBAAE/EMcN2Lf0irYHBlHHxyX/AEPXwR+7O1ar4fIpMxhScITZ1HD6fkaBjP3rBOiBeopkFUn/2Q==" alt="" style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; object-fit: cover; object-position: center center; opacity: 0; border-radius: 50%;"><picture><source srcset="/static/f693cb87ce63b88a182a754d2cdcea1a/99438/profile-pic.jpg 1x,
/static/f693cb87ce63b88a182a754d2cdcea1a/aba1d/profile-pic.jpg 1.5x,
/static/f693cb87ce63b88a182a754d2cdcea1a/b315d/profile-pic.jpg 2x"><img srcset="/static/f693cb87ce63b88a182a754d2cdcea1a/99438/profile-pic.jpg 1x,
/static/f693cb87ce63b88a182a754d2cdcea1a/aba1d/profile-pic.jpg 1.5x,
/static/f693cb87ce63b88a182a754d2cdcea1a/b315d/profile-pic.jpg 2x" src="./Learning HackLang - Building a Web server in hack _ Abhik&#39;s Blog_files/profile-pic.jpg" alt="Abhik Mitra" width="50" height="50" loading="lazy" style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; object-fit: cover; object-position: center center; opacity: 1; transition: none 0s ease 0s; border-radius: 50%;"></picture><noscript><picture><source srcset="/static/f693cb87ce63b88a182a754d2cdcea1a/99438/profile-pic.jpg 1x,
/static/f693cb87ce63b88a182a754d2cdcea1a/aba1d/profile-pic.jpg 1.5x,
/static/f693cb87ce63b88a182a754d2cdcea1a/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/f693cb87ce63b88a182a754d2cdcea1a/99438/profile-pic.jpg 1x,
/static/f693cb87ce63b88a182a754d2cdcea1a/aba1d/profile-pic.jpg 1.5x,
/static/f693cb87ce63b88a182a754d2cdcea1a/b315d/profile-pic.jpg 2x" src="/static/f693cb87ce63b88a182a754d2cdcea1a/99438/profile-pic.jpg" alt="Abhik Mitra" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong><a href="https://abhikmitra.github.io/">Abhik Mitra</a></strong> who lives in Bangalore and loves building and learning new things. <a href="https://www.linkedin.com/in/iamabhik/">You should follow him on LinkedIn</a></p></div></footer></article><nav><ul style="display: flex; flex-wrap: wrap; justify-content: space-between; list-style: none; padding: 0px;"><li><a rel="prev" href="http://localhost:8000/sys-des/">← Cracking the System Design Interview</a></li><li></li></ul></nav></main><footer><hr></footer></div></div><div id="gatsby-announcer" aria-live="assertive" aria-atomic="true" style="position: absolute; top: 0px; width: 1px; height: 1px; padding: 0px; overflow: hidden; clip: rect(0px, 0px, 0px, 0px); white-space: nowrap; border: 0px;">Navigated to Learning HackLang - Building a Web server in hack</div></div><script src="./Learning HackLang - Building a Web server in hack _ Abhik&#39;s Blog_files/polyfill.js" nomodule=""></script><script src="./Learning HackLang - Building a Web server in hack _ Abhik&#39;s Blog_files/commons.js"></script><div id="pocket-extension-root"><div class="pocket-egasyq"></div></div><div id="pocket-extension-styles"><style data-emotion="pocket"></style></div><div id="weava-permanent-marker" date="1601200736322"></div><div id="weava-ui-wrapper"><div class="weava-drop-area-wrapper"><div class="weava-drop-area"></div>
<div class="weava-drop-area-text">Drop here!</div>
</div></div></body></html>